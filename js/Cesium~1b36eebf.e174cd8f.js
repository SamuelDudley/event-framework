(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Cesium~1b36eebf"],{1331:function(e,t,a){"use strict";var i=a("77af"),n=a("2f63"),r=a("9f1d"),s=a("7d62"),o=a("e42d"),c=a("ac3b"),h=a("6ef5"),l=a("6dc0"),_=a("6c84"),u=a("a913"),d=a("3022"),f=a("03f1"),b=a("23b6"),p=a("3664");function m(){this._framebuffer=void 0,this._colorTexture=void 0,this._drawCommand=void 0}function g(e,t){var a=e._framebuffer,n=t.createViewportQuadCommand(p["a"],{framebuffer:a,renderState:l["a"].fromCache({viewport:new i["a"](0,0,256,256)})});e._drawCommand=n}function T(e,t){var a=new u["a"]({context:t,width:256,height:256,pixelFormat:o["a"].RGBA,pixelDatatype:h["a"].UNSIGNED_BYTE,sampler:new _["a"]({wrapS:b["a"].CLAMP_TO_EDGE,wrapT:b["a"].CLAMP_TO_EDGE,minificationFilter:f["a"].NEAREST,magnificationFilter:d["a"].NEAREST})});e._colorTexture=a;var i=new c["a"]({context:t,colorTextures:[a],destroyAttachments:!1});e._framebuffer=i}Object(r["a"])(m.prototype,{colorTexture:{get:function(){return this._colorTexture}}}),m.prototype.update=function(e){if(!Object(n["a"])(this._colorTexture)){var t=e.context;T(this,t),g(this,t),this._drawCommand.execute(t),this._framebuffer=this._framebuffer&&this._framebuffer.destroy(),this._drawCommand.shaderProgram=this._drawCommand.shaderProgram&&this._drawCommand.shaderProgram.destroy()}},m.prototype.isDestroyed=function(){return!1},m.prototype.destroy=function(){return this._colorTexture=this._colorTexture&&this._colorTexture.destroy(),Object(s["a"])(this)},t["a"]=m},"141c":function(e,t,a){"use strict";var i=a("0e25"),n={OPAQUE:0,TRANSLUCENT:1,OPAQUE_AND_TRANSLUCENT:2};t["a"]=Object(i["a"])(n)},"2cc3":function(e,t,a){"use strict";var i=a("670c"),n=a("be18"),r=a("a561"),s=a("2bb9"),o=a("abab"),c=a("2f63"),h=a("9f1d"),l=a("7d62"),_=a("e42d"),u=a("b997"),d=a("6ef5"),f=a("6c84"),b=a("a913"),p=a("3022"),m=a("03f1");function g(e,t,a){if(this._attributes=t,this._numberOfInstances=a,0!==t.length){var n=T(t),s=e.floatingPointTexture,o=n===d["a"].FLOAT&&!s,c=A(t,o),h=y(c,t,o),l=Math.floor(u["a"].maximumTextureSize/h),_=Math.min(a,l),f=h*_,b=Math.ceil(a/_),p=1/f,m=.5*p,g=1/b,O=.5*g;this._textureDimensions=new i["a"](f,b),this._textureStep=new r["a"](p,m,g,O),this._pixelDatatype=o?d["a"].UNSIGNED_BYTE:n,this._packFloats=o,this._offsets=c,this._stride=h,this._texture=void 0;var D=4*f*b;this._batchValues=n!==d["a"].FLOAT||o?new Uint8Array(D):new Float32Array(D),this._batchValuesDirty=!1}}function T(e){for(var t=!1,a=e.length,i=0;i<a;++i)if(e[i].componentDatatype!==o["a"].UNSIGNED_BYTE){t=!0;break}return t?d["a"].FLOAT:d["a"].UNSIGNED_BYTE}function O(e,t){var a=e[t].componentsPerAttribute;return 2===a?i["a"]:3===a?n["a"]:4===a?r["a"]:Number}function A(e,t){for(var a=new Array(e.length),i=0,n=e.length,r=0;r<n;++r){var s=e[r],c=s.componentDatatype;a[r]=i,c!==o["a"].UNSIGNED_BYTE&&t?i+=4:++i}return a}function y(e,t,a){var i=e.length,n=e[i-1],r=t[i-1],s=r.componentDatatype;return s!==o["a"].UNSIGNED_BYTE&&a?n+4:n+1}Object(h["a"])(g.prototype,{attributes:{get:function(){return this._attributes}},numberOfInstances:{get:function(){return this._numberOfInstances}}});var D=new r["a"];function v(e,t,a){var i=r["a"].unpack(e,t,D),n=r["a"].unpackFloat(i);i=r["a"].unpack(e,t+4,D);var s=r["a"].unpackFloat(i);i=r["a"].unpack(e,t+8,D);var o=r["a"].unpackFloat(i);i=r["a"].unpack(e,t+12,D);var c=r["a"].unpackFloat(i);return r["a"].fromElements(n,s,o,c,a)}function x(e,t,a){var i=r["a"].packFloat(e.x,D);r["a"].pack(i,t,a),i=r["a"].packFloat(e.y,i),r["a"].pack(i,t,a+4),i=r["a"].packFloat(e.z,i),r["a"].pack(i,t,a+8),i=r["a"].packFloat(e.w,i),r["a"].pack(i,t,a+12)}var S=new r["a"];g.prototype.getBatchedAttribute=function(e,t,a){var i,n=this._attributes,s=this._offsets[t],o=this._stride,h=4*o*e+4*s;i=this._packFloats&&n[t].componentDatatype!==d["a"].UNSIGNED_BYTE?v(this._batchValues,h,S):r["a"].unpack(this._batchValues,h,S);var l=O(n,t);return Object(c["a"])(l.fromCartesian4)?l.fromCartesian4(i,a):Object(c["a"])(l.clone)?l.clone(i,a):i.x};var E=[void 0,void 0,new i["a"],new n["a"],new r["a"]],C=new r["a"];function I(e,t){var a=e._textureDimensions;e._texture=new b["a"]({context:t,pixelFormat:_["a"].RGBA,pixelDatatype:e._pixelDatatype,width:a.x,height:a.y,sampler:new f["a"]({minificationFilter:m["a"].NEAREST,magnificationFilter:p["a"].NEAREST}),flipY:!1})}function N(e){var t=e._textureDimensions;e._texture.copyFrom({width:t.x,height:t.y,arrayBufferView:e._batchValues})}function R(e){var t=e._stride;return 1===e._textureDimensions.y?"uniform vec4 batchTextureStep; \nvec2 computeSt(float batchId) \n{ \n    float stepX = batchTextureStep.x; \n    float centerX = batchTextureStep.y; \n    float numberOfAttributes = float("+t+"); \n    return vec2(centerX + (batchId * numberOfAttributes * stepX), 0.5); \n} \n":"uniform vec4 batchTextureStep; \nuniform vec2 batchTextureDimensions; \nvec2 computeSt(float batchId) \n{ \n    float stepX = batchTextureStep.x; \n    float centerX = batchTextureStep.y; \n    float stepY = batchTextureStep.z; \n    float centerY = batchTextureStep.w; \n    float numberOfAttributes = float("+t+"); \n    float xId = mod(batchId * numberOfAttributes, batchTextureDimensions.x); \n    float yId = floor(batchId * numberOfAttributes / batchTextureDimensions.x); \n    return vec2(centerX + (xId * stepX), centerY + (yId * stepY)); \n} \n"}function P(e){return 1===e?"float":"vec"+e}function L(e){return 1===e?".x":2===e?".xy":3===e?".xyz":""}function B(e,t){var a=e._attributes,i=a[t],n=i.componentsPerAttribute,r=i.functionName,s=P(n),c=L(n),h=e._offsets[t],l=s+" "+r+"(float batchId) \n{ \n    vec2 st = computeSt(batchId); \n    st.x += batchTextureStep.x * float("+h+"); \n";return e._packFloats&&i.componentDatatype!==d["a"].UNSIGNED_BYTE?l+="vec4 textureValue; \ntextureValue.x = czm_unpackFloat(texture2D(batchTexture, st)); \ntextureValue.y = czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x, 0.0))); \ntextureValue.z = czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x * 2.0, 0.0))); \ntextureValue.w = czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x * 3.0, 0.0))); \n":l+="    vec4 textureValue = texture2D(batchTexture, st); \n",l+="    "+s+" value = textureValue"+c+"; \n",e._pixelDatatype!==d["a"].UNSIGNED_BYTE||i.componentDatatype!==o["a"].UNSIGNED_BYTE||i.normalize?e._pixelDatatype===d["a"].FLOAT&&i.componentDatatype===o["a"].UNSIGNED_BYTE&&i.normalize&&(l+="value /= 255.0; \n"):l+="value *= 255.0; \n",l+="    return value; \n} \n",l}g.prototype.setBatchedAttribute=function(e,t,a){var i=this._attributes,n=E[i[t].componentsPerAttribute],s=this.getBatchedAttribute(e,t,n),o=O(this._attributes,t),h=Object(c["a"])(o.equals)?o.equals(s,a):s===a;if(!h){var l=C;l.x=Object(c["a"])(a.x)?a.x:a,l.y=Object(c["a"])(a.y)?a.y:0,l.z=Object(c["a"])(a.z)?a.z:0,l.w=Object(c["a"])(a.w)?a.w:0;var _=this._offsets[t],u=this._stride,f=4*u*e+4*_;this._packFloats&&i[t].componentDatatype!==d["a"].UNSIGNED_BYTE?x(l,this._batchValues,f):r["a"].pack(l,this._batchValues,f),this._batchValuesDirty=!0}},g.prototype.update=function(e){Object(c["a"])(this._texture)&&!this._batchValuesDirty||0===this._attributes.length||(this._batchValuesDirty=!1,Object(c["a"])(this._texture)||I(this,e.context),N(this))},g.prototype.getUniformMapCallback=function(){var e=this;return function(t){if(0===e._attributes.length)return t;var a={batchTexture:function(){return e._texture},batchTextureDimensions:function(){return e._textureDimensions},batchTextureStep:function(){return e._textureStep}};return Object(s["a"])(t,a)}},g.prototype.getVertexShaderCallback=function(){var e=this._attributes;if(0===e.length)return function(e){return e};var t="uniform sampler2D batchTexture; \n";t+=R(this)+"\n";for(var a=e.length,i=0;i<a;++i)t+=B(this,i);return function(e){var a=e.indexOf("void main"),i=e.substring(0,a),n=e.substring(a);return i+"\n"+t+"\n"+n}},g.prototype.isDestroyed=function(){return!1},g.prototype.destroy=function(){return this._texture=this._texture&&this._texture.destroy(),Object(l["a"])(this)},t["a"]=g},"30d2":function(e,t,a){"use strict";var i=a("0e25"),n=a("daa2"),r={ZERO:n["a"].ZERO,ONE:n["a"].ONE,SOURCE_COLOR:n["a"].SRC_COLOR,ONE_MINUS_SOURCE_COLOR:n["a"].ONE_MINUS_SRC_COLOR,DESTINATION_COLOR:n["a"].DST_COLOR,ONE_MINUS_DESTINATION_COLOR:n["a"].ONE_MINUS_DST_COLOR,SOURCE_ALPHA:n["a"].SRC_ALPHA,ONE_MINUS_SOURCE_ALPHA:n["a"].ONE_MINUS_SRC_ALPHA,DESTINATION_ALPHA:n["a"].DST_ALPHA,ONE_MINUS_DESTINATION_ALPHA:n["a"].ONE_MINUS_DST_ALPHA,CONSTANT_COLOR:n["a"].CONSTANT_COLOR,ONE_MINUS_CONSTANT_COLOR:n["a"].ONE_MINUS_CONSTANT_COLOR,CONSTANT_ALPHA:n["a"].CONSTANT_ALPHA,ONE_MINUS_CONSTANT_ALPHA:n["a"].ONE_MINUS_CONSTANT_ALPHA,SOURCE_ALPHA_SATURATE:n["a"].SRC_ALPHA_SATURATE};t["a"]=Object(i["a"])(r)},"3e44":function(e,t,a){"use strict";var i=a("77af"),n=a("670c"),r=a("be18"),s=a("a561"),o=a("bef8"),c=a("bd8d"),h=a("71ce"),l=a("535a"),_=a("2f63"),u=a("9f1d"),d=a("aee6"),f=a("52f0"),b=a("6dfc"),p=a("d4ed"),m=a("2d75"),g=a("f61d"),T=a("a307"),O=a("0c80"),A=a("05e5");function y(e,t){e=Object(l["a"])(e,l["a"].EMPTY_OBJECT);var a=e.translucencyByDistance,i=e.pixelOffsetScaleByDistance,s=e.scaleByDistance,o=e.distanceDisplayCondition;Object(_["a"])(a)&&(a=b["a"].clone(a)),Object(_["a"])(i)&&(i=b["a"].clone(i)),Object(_["a"])(s)&&(s=b["a"].clone(s)),Object(_["a"])(o)&&(o=d["a"].clone(o)),this._show=Object(l["a"])(e.show,!0),this._position=r["a"].clone(Object(l["a"])(e.position,r["a"].ZERO)),this._actualPosition=r["a"].clone(this._position),this._pixelOffset=n["a"].clone(Object(l["a"])(e.pixelOffset,n["a"].ZERO)),this._translate=new n["a"](0,0),this._eyeOffset=r["a"].clone(Object(l["a"])(e.eyeOffset,r["a"].ZERO)),this._heightReference=Object(l["a"])(e.heightReference,m["a"].NONE),this._verticalOrigin=Object(l["a"])(e.verticalOrigin,A["a"].CENTER),this._horizontalOrigin=Object(l["a"])(e.horizontalOrigin,g["a"].CENTER),this._scale=Object(l["a"])(e.scale,1),this._color=c["a"].clone(Object(l["a"])(e.color,c["a"].WHITE)),this._rotation=Object(l["a"])(e.rotation,0),this._alignedAxis=r["a"].clone(Object(l["a"])(e.alignedAxis,r["a"].ZERO)),this._width=e.width,this._height=e.height,this._scaleByDistance=s,this._translucencyByDistance=a,this._pixelOffsetScaleByDistance=i,this._sizeInMeters=Object(l["a"])(e.sizeInMeters,!1),this._distanceDisplayCondition=o,this._disableDepthTestDistance=e.disableDepthTestDistance,this._id=e.id,this._collection=Object(l["a"])(e.collection,t),this._pickId=void 0,this._pickPrimitive=Object(l["a"])(e._pickPrimitive,this),this._billboardCollection=t,this._dirty=!1,this._index=-1,this._batchIndex=void 0,this._imageIndex=-1,this._imageIndexPromise=void 0,this._imageId=void 0,this._image=void 0,this._imageSubRegion=void 0,this._imageWidth=void 0,this._imageHeight=void 0,this._labelDimensions=void 0,this._labelHorizontalOrigin=void 0,this._labelTranslate=void 0;var u=e.image,f=e.imageId;Object(_["a"])(u)&&(Object(_["a"])(f)||(f="string"===typeof u?u:Object(_["a"])(u.src)?u.src:Object(h["a"])()),this._imageId=f,this._image=u),Object(_["a"])(e.imageSubRegion)&&(this._imageId=f,this._imageSubRegion=e.imageSubRegion),Object(_["a"])(this._billboardCollection._textureAtlas)&&this._loadImage(),this._actualClampedPosition=void 0,this._removeCallbackFunc=void 0,this._mode=T["a"].SCENE3D,this._clusterShow=!0,this._outlineColor=c["a"].clone(Object(l["a"])(e.outlineColor,c["a"].BLACK)),this._outlineWidth=Object(l["a"])(e.outlineWidth,0),this._updateClamping()}var D=y.SHOW_INDEX=0,v=y.POSITION_INDEX=1,x=y.PIXEL_OFFSET_INDEX=2,S=y.EYE_OFFSET_INDEX=3,E=y.HORIZONTAL_ORIGIN_INDEX=4,C=y.VERTICAL_ORIGIN_INDEX=5,I=y.SCALE_INDEX=6,N=y.IMAGE_INDEX_INDEX=7,R=y.COLOR_INDEX=8,P=y.ROTATION_INDEX=9,L=y.ALIGNED_AXIS_INDEX=10,B=y.SCALE_BY_DISTANCE_INDEX=11,U=y.TRANSLUCENCY_BY_DISTANCE_INDEX=12,w=y.PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX=13,j=y.DISTANCE_DISPLAY_CONDITION=14,M=y.DISABLE_DEPTH_DISTANCE=15;y.TEXTURE_COORDINATE_BOUNDS=16;var F=y.SDF_INDEX=17;function V(e,t){var a=e._billboardCollection;Object(_["a"])(a)&&(a._updateBillboard(e,t),e._dirty=!0)}y.NUMBER_OF_PROPERTIES=18,Object(u["a"])(y.prototype,{show:{get:function(){return this._show},set:function(e){this._show!==e&&(this._show=e,V(this,D))}},position:{get:function(){return this._position},set:function(e){var t=this._position;r["a"].equals(t,e)||(r["a"].clone(e,t),r["a"].clone(e,this._actualPosition),this._updateClamping(),V(this,v))}},heightReference:{get:function(){return this._heightReference},set:function(e){var t=this._heightReference;e!==t&&(this._heightReference=e,this._updateClamping(),V(this,v))}},pixelOffset:{get:function(){return this._pixelOffset},set:function(e){var t=this._pixelOffset;n["a"].equals(t,e)||(n["a"].clone(e,t),V(this,x))}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(e){var t=this._scaleByDistance;b["a"].equals(t,e)||(this._scaleByDistance=b["a"].clone(e,t),V(this,B))}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(e){var t=this._translucencyByDistance;b["a"].equals(t,e)||(this._translucencyByDistance=b["a"].clone(e,t),V(this,U))}},pixelOffsetScaleByDistance:{get:function(){return this._pixelOffsetScaleByDistance},set:function(e){var t=this._pixelOffsetScaleByDistance;b["a"].equals(t,e)||(this._pixelOffsetScaleByDistance=b["a"].clone(e,t),V(this,w))}},eyeOffset:{get:function(){return this._eyeOffset},set:function(e){var t=this._eyeOffset;r["a"].equals(t,e)||(r["a"].clone(e,t),V(this,S))}},horizontalOrigin:{get:function(){return this._horizontalOrigin},set:function(e){this._horizontalOrigin!==e&&(this._horizontalOrigin=e,V(this,E))}},verticalOrigin:{get:function(){return this._verticalOrigin},set:function(e){this._verticalOrigin!==e&&(this._verticalOrigin=e,V(this,C))}},scale:{get:function(){return this._scale},set:function(e){this._scale!==e&&(this._scale=e,V(this,I))}},color:{get:function(){return this._color},set:function(e){var t=this._color;c["a"].equals(t,e)||(c["a"].clone(e,t),V(this,R))}},rotation:{get:function(){return this._rotation},set:function(e){this._rotation!==e&&(this._rotation=e,V(this,P))}},alignedAxis:{get:function(){return this._alignedAxis},set:function(e){var t=this._alignedAxis;r["a"].equals(t,e)||(r["a"].clone(e,t),V(this,L))}},width:{get:function(){return Object(l["a"])(this._width,this._imageWidth)},set:function(e){this._width!==e&&(this._width=e,V(this,N))}},height:{get:function(){return Object(l["a"])(this._height,this._imageHeight)},set:function(e){this._height!==e&&(this._height=e,V(this,N))}},sizeInMeters:{get:function(){return this._sizeInMeters},set:function(e){this._sizeInMeters!==e&&(this._sizeInMeters=e,V(this,R))}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){d["a"].equals(e,this._distanceDisplayCondition)||(this._distanceDisplayCondition=d["a"].clone(e,this._distanceDisplayCondition),V(this,j))}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(e){this._disableDepthTestDistance!==e&&(this._disableDepthTestDistance=e,V(this,M))}},id:{get:function(){return this._id},set:function(e){this._id=e,Object(_["a"])(this._pickId)&&(this._pickId.object.id=e)}},pickPrimitive:{get:function(){return this._pickPrimitive},set:function(e){this._pickPrimitive=e,Object(_["a"])(this._pickId)&&(this._pickId.object.primitive=e)}},pickId:{get:function(){return this._pickId}},image:{get:function(){return this._imageId},set:function(e){Object(_["a"])(e)?"string"===typeof e?this.setImage(e,e):e instanceof p["a"]?this.setImage(e.url,e):Object(_["a"])(e.src)?this.setImage(e.src,e):this.setImage(Object(h["a"])(),e):(this._imageIndex=-1,this._imageSubRegion=void 0,this._imageId=void 0,this._image=void 0,this._imageIndexPromise=void 0,V(this,N))}},ready:{get:function(){return-1!==this._imageIndex}},_clampedPosition:{get:function(){return this._actualClampedPosition},set:function(e){this._actualClampedPosition=r["a"].clone(e,this._actualClampedPosition),V(this,v)}},clusterShow:{get:function(){return this._clusterShow},set:function(e){this._clusterShow!==e&&(this._clusterShow=e,V(this,D))}},outlineColor:{get:function(){return this._outlineColor},set:function(e){var t=this._outlineColor;c["a"].equals(t,e)||(c["a"].clone(e,t),V(this,F))}},outlineWidth:{get:function(){return this._outlineWidth},set:function(e){this._outlineWidth!==e&&(this._outlineWidth=e,V(this,F))}}}),y.prototype.getPickId=function(e){return Object(_["a"])(this._pickId)||(this._pickId=e.createPickId({primitive:this._pickPrimitive,collection:this._collection,id:this._id})),this._pickId},y.prototype._updateClamping=function(){y._updateClamping(this._billboardCollection,this)};var k=new o["a"],H=new r["a"];y._updateClamping=function(e,t){var a=e._scene;if(Object(_["a"])(a)&&Object(_["a"])(a.globe)){var i=a.globe,n=i.ellipsoid,s=i._surface,c=a.frameState.mode,h=c!==t._mode;if(t._mode=c,(t._heightReference===m["a"].NONE||h)&&Object(_["a"])(t._removeCallbackFunc)&&(t._removeCallbackFunc(),t._removeCallbackFunc=void 0,t._clampedPosition=void 0),t._heightReference!==m["a"].NONE&&Object(_["a"])(t._position)){var l=n.cartesianToCartographic(t._position);if(Object(_["a"])(l)){Object(_["a"])(t._removeCallbackFunc)&&t._removeCallbackFunc(),t._removeCallbackFunc=s.updateHeight(l,d),o["a"].clone(l,k);var u=i.getHeight(l);Object(_["a"])(u)&&(k.height=u),n.cartographicToCartesian(k,H),d(H)}else t._actualClampedPosition=void 0}}function d(e){if(t._heightReference===m["a"].RELATIVE_TO_GROUND)if(t._mode===T["a"].SCENE3D){var a=n.cartesianToCartographic(e,k);a.height+=l.height,n.cartographicToCartesian(a,e)}else e.x+=l.height;t._clampedPosition=r["a"].clone(e,t._clampedPosition)}},y.prototype._loadImage=function(){var e,t=this._billboardCollection._textureAtlas,a=this._imageId,n=this._image,r=this._imageSubRegion;if(Object(_["a"])(n)&&(e=t.addImage(a,n)),Object(_["a"])(r)&&(e=t.addSubRegion(a,r)),this._imageIndexPromise=e,Object(_["a"])(e)){var s=this;e.then((function(e){if(s._imageId===a&&s._image===n&&i["a"].equals(s._imageSubRegion,r)){var o=t.textureCoordinates[e];s._imageWidth=t.texture.width*o.width,s._imageHeight=t.texture.height*o.height,s._imageIndex=e,s._ready=!0,s._image=void 0,s._imageIndexPromise=void 0,V(s,N)}})).otherwise((function(e){console.error("Error loading image for billboard: "+e),s._imageIndexPromise=void 0}))}},y.prototype.setImage=function(e,t){this._imageId!==e&&(this._imageIndex=-1,this._imageSubRegion=void 0,this._imageId=e,this._image=t,Object(_["a"])(this._billboardCollection._textureAtlas)&&this._loadImage())},y.prototype.setImageSubRegion=function(e,t){this._imageId===e&&i["a"].equals(this._imageSubRegion,t)||(this._imageIndex=-1,this._imageId=e,this._imageSubRegion=i["a"].clone(t),Object(_["a"])(this._billboardCollection._textureAtlas)&&this._loadImage())},y.prototype._setTranslate=function(e){var t=this._translate;n["a"].equals(t,e)||(n["a"].clone(e,t),V(this,x))},y.prototype._getActualPosition=function(){return Object(_["a"])(this._clampedPosition)?this._clampedPosition:this._actualPosition},y.prototype._setActualPosition=function(e){Object(_["a"])(this._clampedPosition)||r["a"].clone(e,this._actualPosition),V(this,v)};var W=new s["a"];y._computeActualPosition=function(e,t,a,i){return Object(_["a"])(e._clampedPosition)?(a.mode!==e._mode&&e._updateClamping(),e._clampedPosition):a.mode===T["a"].SCENE3D?t:(f["a"].multiplyByPoint(i,t,W),O["a"].computeActualWgs84Position(a,W))};var X=new r["a"];y._computeScreenSpacePosition=function(e,t,a,i,r,s){var o=f["a"].multiplyByPoint(e,t,X),c=O["a"].wgs84WithEyeOffsetToWindowCoordinates(r,o,a,s);if(Object(_["a"])(c))return n["a"].add(c,i,c),c};var G=new n["a"](0,0);y.prototype.computeScreenSpacePosition=function(e,t){var a=this._billboardCollection;Object(_["a"])(t)||(t=new n["a"]),n["a"].clone(this._pixelOffset,G),n["a"].add(G,this._translate,G);var i=a.modelMatrix,r=this._position;if(Object(_["a"])(this._clampedPosition)&&(r=this._clampedPosition,e.mode!==T["a"].SCENE3D)){var s=e.mapProjection,o=s.ellipsoid,c=s.unproject(r,k);r=o.cartographicToCartesian(c,X),i=f["a"].IDENTITY}var h=y._computeScreenSpacePosition(i,r,this._eyeOffset,G,e,t);return h},y.getScreenSpaceBoundingBox=function(e,t,a){var n=e.width,r=e.height,s=e.scale;n*=s,r*=s;var o=t.x;e.horizontalOrigin===g["a"].RIGHT?o-=n:e.horizontalOrigin===g["a"].CENTER&&(o-=.5*n);var c=t.y;return e.verticalOrigin===A["a"].BOTTOM||e.verticalOrigin===A["a"].BASELINE?c-=r:e.verticalOrigin===A["a"].CENTER&&(c-=.5*r),Object(_["a"])(a)||(a=new i["a"]),a.x=o,a.y=c,a.width=n,a.height=r,a},y.prototype.equals=function(e){return this===e||Object(_["a"])(e)&&this._id===e._id&&r["a"].equals(this._position,e._position)&&this._imageId===e._imageId&&this._show===e._show&&this._scale===e._scale&&this._verticalOrigin===e._verticalOrigin&&this._horizontalOrigin===e._horizontalOrigin&&this._heightReference===e._heightReference&&i["a"].equals(this._imageSubRegion,e._imageSubRegion)&&c["a"].equals(this._color,e._color)&&n["a"].equals(this._pixelOffset,e._pixelOffset)&&n["a"].equals(this._translate,e._translate)&&r["a"].equals(this._eyeOffset,e._eyeOffset)&&b["a"].equals(this._scaleByDistance,e._scaleByDistance)&&b["a"].equals(this._translucencyByDistance,e._translucencyByDistance)&&b["a"].equals(this._pixelOffsetScaleByDistance,e._pixelOffsetScaleByDistance)&&d["a"].equals(this._distanceDisplayCondition,e._distanceDisplayCondition)&&this._disableDepthTestDistance===e._disableDepthTestDistance},y.prototype._destroy=function(){Object(_["a"])(this._customData)&&(this._billboardCollection._scene.globe._surface.removeTileCustomData(this._customData),this._customData=void 0),Object(_["a"])(this._removeCallbackFunc)&&(this._removeCallbackFunc(),this._removeCallbackFunc=void 0),this.image=void 0,this._pickId=this._pickId&&this._pickId.destroy(),this._billboardCollection=void 0},t["a"]=y},"61aa":function(e,t,a){"use strict";var i=a("be18"),n=a("bd8d"),r=a("abab"),s=a("535a"),o=a("2f63"),c=a("9f1d"),h=a("45c5"),l=a("7d62"),_=a("129b"),u=a("52f0"),d=a("b82e"),f=a("283e"),b=a("d289"),p=a("b08e"),m=a("6596"),g=a("5af0"),T=a("9889"),O=a("b80d"),A=a("ce35"),y=a("e349");function D(e,t,a,i,n){this._tileset=e,this._tile=t,this._resource=a,this._model=void 0,this._batchTable=void 0,this._features=void 0,this._batchIdAttributeName=void 0,this._diffuseAttributeOrUniformName={},this._rtcCenterTransform=void 0,this._contentModelMatrix=void 0,this.featurePropertiesDirty=!1,R(this,i,n)}D._deprecationWarning=h["a"],Object(c["a"])(D.prototype,{featuresLength:{get:function(){return this._batchTable.featuresLength}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return this._model.trianglesLength}},geometryByteLength:{get:function(){return this._model.geometryByteLength}},texturesByteLength:{get:function(){return this._model.texturesByteLength}},batchTableByteLength:{get:function(){return this._batchTable.memorySizeInBytes}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._model.readyPromise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});var v=Uint32Array.BYTES_PER_ELEMENT;function x(e){var t=y["a"].getAttributeOrUniformBySemantic(e,"_BATCHID");return Object(o["a"])(t)||(t=y["a"].getAttributeOrUniformBySemantic(e,"BATCHID"),Object(o["a"])(t)&&D._deprecationWarning("b3dm-legacy-batchid","The glTF in this b3dm uses the semantic `BATCHID`. Application-specific semantics should be prefixed with an underscore: `_BATCHID`.")),t}function S(e){return function(t,a){var i=e._batchTable,n=!Object(o["a"])(e._tileset.classificationType),r=e._model.gltf;Object(o["a"])(r)&&(e._batchIdAttributeName=x(r),e._diffuseAttributeOrUniformName[a]=y["a"].getDiffuseAttributeOrUniform(r,a));var s=i.getVertexShaderCallback(n,e._batchIdAttributeName,e._diffuseAttributeOrUniformName[a]);return Object(o["a"])(s)?s(t):t}}function E(e){return function(t,a){var i=e._batchTable,n=!Object(o["a"])(e._tileset.classificationType),r=e._model.gltf;Object(o["a"])(r)&&(e._diffuseAttributeOrUniformName[a]=y["a"].getDiffuseAttributeOrUniform(r,a));var s=i.getFragmentShaderCallback(n,e._diffuseAttributeOrUniformName[a]);return Object(o["a"])(s)?s(t):t}}function C(e){return function(){return e._batchTable.getPickId()}}function I(e){return function(t){var a=e._batchTable,i=a.getClassificationFragmentShaderCallback();return Object(o["a"])(i)?i(t):t}}function N(e){return function(t,a){e._model.updateCommands(t,a)}}function R(e,t,a){var n=e._tileset,c=e._tile,h=e._resource,l=Object(s["a"])(a,0);a=l;var g=new Uint8Array(t),y=new DataView(t);a+=v;var x=y.getUint32(a,!0);if(1!==x)throw new f["a"]("Only Batched 3D Model version 1 is supported.  Version "+x+" is not.");a+=v;var R=y.getUint32(a,!0);a+=v;var P=y.getUint32(a,!0);a+=v;var L=y.getUint32(a,!0);a+=v;var B=y.getUint32(a,!0);a+=v;var U,w,j=y.getUint32(a,!0);if(a+=v,B>=570425344?(a-=2*v,U=P,B=L,j=0,P=0,L=0,D._deprecationWarning("b3dm-legacy-header","This b3dm header is using the legacy format [batchLength] [batchTableByteLength]. The new format is [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength] from https://github.com/AnalyticalGraphicsInc/3d-tiles/tree/master/specification/TileFormats/Batched3DModel.")):j>=570425344&&(a-=v,U=B,B=P,j=L,P=0,L=0,D._deprecationWarning("b3dm-legacy-header","This b3dm header is using the legacy format [batchTableJsonByteLength] [batchTableBinaryByteLength] [batchLength]. The new format is [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength] from https://github.com/AnalyticalGraphicsInc/3d-tiles/tree/master/specification/TileFormats/Batched3DModel.")),0===P)w={BATCH_LENGTH:Object(s["a"])(U,0)};else{var M=Object(_["a"])(g,a,P);w=JSON.parse(M),a+=P}var F=new Uint8Array(t,a,L);a+=L;var V,k,H,W=new T["a"](w,F);if(U=W.getGlobalProperty("BATCH_LENGTH"),W.featuresLength=U,B>0){var X=Object(_["a"])(g,a,B);V=JSON.parse(X),a+=B,j>0&&(k=new Uint8Array(t,a,j),k=new Uint8Array(k),a+=j)}Object(o["a"])(n.classificationType)&&(H=N(e));var G=new m["a"](e,U,V,k,H);e._batchTable=G;var z,Y=l+R-a;if(0===Y)throw new f["a"]("glTF byte length must be greater than 0.");a%4===0?z=new Uint8Array(t,a,Y):(D._deprecationWarning("b3dm-glb-unaligned","The embedded glb is not aligned to a 4-byte boundary."),z=new Uint8Array(g.subarray(a,a+Y)));var q={content:e,primitive:n};e._rtcCenterTransform=u["a"].IDENTITY;var Z=W.getGlobalProperty("RTC_CENTER",r["a"].FLOAT,3);Object(o["a"])(Z)&&(e._rtcCenterTransform=u["a"].fromTranslation(i["a"].fromArray(Z))),e._contentModelMatrix=u["a"].multiply(c.computedTransform,e._rtcCenterTransform,new u["a"]),Object(o["a"])(n.classificationType)?e._model=new O["a"]({gltf:z,cull:!1,basePath:h,requestType:d["a"].TILES3D,modelMatrix:e._contentModelMatrix,upAxis:n._gltfUpAxis,forwardAxis:p["a"].X,debugWireframe:n.debugWireframe,vertexShaderLoaded:S(e),classificationShaderLoaded:I(e),uniformMapLoaded:G.getUniformMapCallback(),pickIdLoaded:C(e),classificationType:n._classificationType,batchTable:G}):e._model=new A["a"]({gltf:z,cull:!1,releaseGltfJson:!0,opaquePass:b["a"].CESIUM_3D_TILE,basePath:h,requestType:d["a"].TILES3D,modelMatrix:e._contentModelMatrix,upAxis:n._gltfUpAxis,forwardAxis:p["a"].X,shadows:n.shadows,debugWireframe:n.debugWireframe,incrementallyLoadTextures:!1,vertexShaderLoaded:S(e),fragmentShaderLoaded:E(e),uniformMapLoaded:G.getUniformMapCallback(),pickIdLoaded:C(e),addBatchIdToGeneratedShaders:U>0,pickObject:q,imageBasedLightingFactor:n.imageBasedLightingFactor,lightColor:n.lightColor,luminanceAtZenith:n.luminanceAtZenith,sphericalHarmonicCoefficients:n.sphericalHarmonicCoefficients,specularEnvironmentMaps:n.specularEnvironmentMaps})}function P(e){var t=e.featuresLength;if(!Object(o["a"])(e._features)&&t>0){for(var a=new Array(t),i=0;i<t;++i)a[i]=new g["a"](e,i);e._features=a}}D.prototype.hasProperty=function(e,t){return this._batchTable.hasProperty(e,t)},D.prototype.getFeature=function(e){return P(this),this._features[e]},D.prototype.applyDebugSettings=function(e,t){t=e?t:n["a"].WHITE,0===this.featuresLength?this._model.color=t:this._batchTable.setAllColor(t)},D.prototype.applyStyle=function(e){if(0===this.featuresLength){var t=Object(o["a"])(e)&&Object(o["a"])(e.color),a=Object(o["a"])(e)&&Object(o["a"])(e.show);this._model.color=t?e.color.evaluateColor(void 0,this._model.color):n["a"].clone(n["a"].WHITE,this._model.color),this._model.show=!a||e.show.evaluate(void 0)}else this._batchTable.applyStyle(e)},D.prototype.update=function(e,t){var a=t.commandList.length;this._batchTable.update(e,t),this._contentModelMatrix=u["a"].multiply(this._tile.computedTransform,this._rtcCenterTransform,this._contentModelMatrix),this._model.modelMatrix=this._contentModelMatrix,this._model.shadows=this._tileset.shadows,this._model.imageBasedLightingFactor=this._tileset.imageBasedLightingFactor,this._model.lightColor=this._tileset.lightColor,this._model.luminanceAtZenith=this._tileset.luminanceAtZenith,this._model.sphericalHarmonicCoefficients=this._tileset.sphericalHarmonicCoefficients,this._model.specularEnvironmentMaps=this._tileset.specularEnvironmentMaps,this._model.debugWireframe=this._tileset.debugWireframe;var i=this._tileset.clippingPlanes;this._model.clippingPlanesOriginMatrix=this._tileset.clippingPlanesOriginMatrix,Object(o["a"])(i)&&this._tile.clippingPlanesDirty&&(this._model._clippingPlanes=i.enabled&&this._tile._isClipped?i:void 0),Object(o["a"])(i)&&Object(o["a"])(this._model._clippingPlanes)&&this._model._clippingPlanes!==i&&(this._model._clippingPlanes=i),this._model.update(t);var n=t.commandList.length;a<n&&(t.passes.render||t.passes.pick)&&!Object(o["a"])(e.classificationType)&&this._batchTable.addDerivedCommands(t,a)},D.prototype.isDestroyed=function(){return!1},D.prototype.destroy=function(){return this._model=this._model&&this._model.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Object(l["a"])(this)},t["a"]=D},"6f00":function(e,t,a){"use strict";var i=a("0e25"),n=a("daa2"),r={ADD:n["a"].FUNC_ADD,SUBTRACT:n["a"].FUNC_SUBTRACT,REVERSE_SUBTRACT:n["a"].FUNC_REVERSE_SUBTRACT,MIN:n["a"].MIN,MAX:n["a"].MAX};t["a"]=Object(i["a"])(r)},"8f7c":function(e,t,a){"use strict";var i,n,r=a("c8d1"),s=a("cef5"),o=a("670c"),c=a("be18"),h=a("bd8d"),l=a("abab"),_=a("535a"),u=a("2f63"),d=a("9f1d"),f=a("7d62"),b=a("6cbd"),p=a("0123"),m=a("93da"),g=a("52f0"),T=a("daa2"),O=a("f20a"),A=a("8b68"),y=a("b997"),D=a("a894"),v=a("d289"),x=a("6dc0"),S=a("e90c"),E=a("5770"),C=a("9d80"),I=a("6d53"),N=a("d3d4"),R=a("3e44"),P=a("b7c8"),L=a("141c"),B=a("2d75"),U=a("f61d"),w=a("a307"),j=a("d9a9"),M=a("7eb3"),F=a("05e5"),V=R["a"].SHOW_INDEX,k=R["a"].POSITION_INDEX,H=R["a"].PIXEL_OFFSET_INDEX,W=R["a"].EYE_OFFSET_INDEX,X=R["a"].HORIZONTAL_ORIGIN_INDEX,G=R["a"].VERTICAL_ORIGIN_INDEX,z=R["a"].SCALE_INDEX,Y=R["a"].IMAGE_INDEX_INDEX,q=R["a"].COLOR_INDEX,Z=R["a"].ROTATION_INDEX,Q=R["a"].ALIGNED_AXIS_INDEX,K=R["a"].SCALE_BY_DISTANCE_INDEX,J=R["a"].TRANSLUCENCY_BY_DISTANCE_INDEX,$=R["a"].PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX,ee=R["a"].DISTANCE_DISPLAY_CONDITION,te=R["a"].DISABLE_DEPTH_DISTANCE,ae=R["a"].TEXTURE_COORDINATE_BOUNDS,ie=R["a"].SDF_INDEX,ne=R["a"].NUMBER_OF_PROPERTIES,re={positionHighAndScale:0,positionLowAndRotation:1,compressedAttribute0:2,compressedAttribute1:3,compressedAttribute2:4,eyeOffset:5,scaleByDistance:6,pixelOffsetScaleByDistance:7,compressedAttribute3:8,textureCoordinateBoundsOrLabelTranslate:9,a_batchId:10,sdf:11},se={direction:0,positionHighAndScale:1,positionLowAndRotation:2,compressedAttribute0:3,compressedAttribute1:4,compressedAttribute2:5,eyeOffset:6,scaleByDistance:7,pixelOffsetScaleByDistance:8,compressedAttribute3:9,textureCoordinateBoundsOrLabelTranslate:10,a_batchId:11,sdf:12};function oe(e){e=Object(_["a"])(e,_["a"].EMPTY_OBJECT),this._scene=e.scene,this._batchTable=e.batchTable,this._textureAtlas=void 0,this._textureAtlasGUID=void 0,this._destroyTextureAtlas=!0,this._sp=void 0,this._spTranslucent=void 0,this._rsOpaque=void 0,this._rsTranslucent=void 0,this._vaf=void 0,this._billboards=[],this._billboardsToUpdate=[],this._billboardsToUpdateIndex=0,this._billboardsRemoved=!1,this._createVertexArray=!1,this._shaderRotation=!1,this._compiledShaderRotation=!1,this._shaderAlignedAxis=!1,this._compiledShaderAlignedAxis=!1,this._shaderScaleByDistance=!1,this._compiledShaderScaleByDistance=!1,this._shaderTranslucencyByDistance=!1,this._compiledShaderTranslucencyByDistance=!1,this._shaderPixelOffsetScaleByDistance=!1,this._compiledShaderPixelOffsetScaleByDistance=!1,this._shaderDistanceDisplayCondition=!1,this._compiledShaderDistanceDisplayCondition=!1,this._shaderDisableDepthDistance=!1,this._compiledShaderDisableDepthDistance=!1,this._shaderClampToGround=!1,this._compiledShaderClampToGround=!1,this._propertiesChanged=new Uint32Array(ne),this._maxSize=0,this._maxEyeOffset=0,this._maxScale=1,this._maxPixelOffset=0,this._allHorizontalCenter=!0,this._allVerticalCenter=!0,this._allSizedInMeters=!0,this._baseVolume=new s["a"],this._baseVolumeWC=new s["a"],this._baseVolume2D=new s["a"],this._boundingVolume=new s["a"],this._boundingVolumeDirty=!1,this._colorCommands=[],this.modelMatrix=g["a"].clone(Object(_["a"])(e.modelMatrix,g["a"].IDENTITY)),this._modelMatrix=g["a"].clone(g["a"].IDENTITY),this.debugShowBoundingVolume=Object(_["a"])(e.debugShowBoundingVolume,!1),this.debugShowTextureAtlas=Object(_["a"])(e.debugShowTextureAtlas,!1),this.blendOption=Object(_["a"])(e.blendOption,L["a"].OPAQUE_AND_TRANSLUCENT),this._blendOption=void 0,this._mode=w["a"].SCENE3D,this._buffersUsage=[A["a"].STATIC_DRAW,A["a"].STATIC_DRAW,A["a"].STATIC_DRAW,A["a"].STATIC_DRAW,A["a"].STATIC_DRAW,A["a"].STATIC_DRAW,A["a"].STATIC_DRAW,A["a"].STATIC_DRAW,A["a"].STATIC_DRAW,A["a"].STATIC_DRAW,A["a"].STATIC_DRAW,A["a"].STATIC_DRAW,A["a"].STATIC_DRAW,A["a"].STATIC_DRAW,A["a"].STATIC_DRAW,A["a"].STATIC_DRAW],this._highlightColor=h["a"].clone(h["a"].WHITE);var t=this;this._uniforms={u_atlas:function(){return t._textureAtlas.texture},u_highlightColor:function(){return t._highlightColor}};var a=this._scene;Object(u["a"])(a)&&Object(u["a"])(a.terrainProviderChanged)&&(this._removeCallbackFunc=a.terrainProviderChanged.addEventListener((function(){for(var e=this._billboards,t=e.length,a=0;a<t;++a)e[a]._updateClamping()}),this))}function ce(e){for(var t=e.length,a=0;a<t;++a)e[a]&&e[a]._destroy()}function he(e){if(e._billboardsRemoved){e._billboardsRemoved=!1;for(var t=[],a=e._billboards,i=a.length,n=0,r=0;n<i;++n){var s=a[n];s&&(s._index=r++,t.push(s))}e._billboards=t}}function le(e){var t=16384,a=e.cache.billboardCollection_indexBufferBatched;if(Object(u["a"])(a))return a;for(var i=6*t-6,n=new Uint16Array(i),r=0,s=0;r<i;r+=6,s+=4)n[r]=s,n[r+1]=s+1,n[r+2]=s+2,n[r+3]=s+0,n[r+4]=s+2,n[r+5]=s+3;return a=O["a"].createIndexBuffer({context:e,typedArray:n,usage:A["a"].STATIC_DRAW,indexDatatype:p["a"].UNSIGNED_SHORT}),a.vertexArrayDestroyable=!1,e.cache.billboardCollection_indexBufferBatched=a,a}function _e(e){var t=e.cache.billboardCollection_indexBufferInstanced;return Object(u["a"])(t)?t:(t=O["a"].createIndexBuffer({context:e,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:A["a"].STATIC_DRAW,indexDatatype:p["a"].UNSIGNED_SHORT}),t.vertexArrayDestroyable=!1,e.cache.billboardCollection_indexBufferInstanced=t,t)}function ue(e){var t=e.cache.billboardCollection_vertexBufferInstanced;return Object(u["a"])(t)?t:(t=O["a"].createVertexBuffer({context:e,typedArray:new Float32Array([0,0,1,0,1,1,0,1]),usage:A["a"].STATIC_DRAW}),t.vertexArrayDestroyable=!1,e.cache.billboardCollection_vertexBufferInstanced=t,t)}function de(e,t,a,n,r,s){var o=[{index:i.positionHighAndScale,componentsPerAttribute:4,componentDatatype:l["a"].FLOAT,usage:a[k]},{index:i.positionLowAndRotation,componentsPerAttribute:4,componentDatatype:l["a"].FLOAT,usage:a[k]},{index:i.compressedAttribute0,componentsPerAttribute:4,componentDatatype:l["a"].FLOAT,usage:a[H]},{index:i.compressedAttribute1,componentsPerAttribute:4,componentDatatype:l["a"].FLOAT,usage:a[J]},{index:i.compressedAttribute2,componentsPerAttribute:4,componentDatatype:l["a"].FLOAT,usage:a[q]},{index:i.eyeOffset,componentsPerAttribute:4,componentDatatype:l["a"].FLOAT,usage:a[W]},{index:i.scaleByDistance,componentsPerAttribute:4,componentDatatype:l["a"].FLOAT,usage:a[K]},{index:i.pixelOffsetScaleByDistance,componentsPerAttribute:4,componentDatatype:l["a"].FLOAT,usage:a[$]},{index:i.compressedAttribute3,componentsPerAttribute:4,componentDatatype:l["a"].FLOAT,usage:a[ee]},{index:i.textureCoordinateBoundsOrLabelTranslate,componentsPerAttribute:4,componentDatatype:l["a"].FLOAT,usage:a[ae]}];n&&o.push({index:i.direction,componentsPerAttribute:2,componentDatatype:l["a"].FLOAT,vertexBuffer:ue(e)}),Object(u["a"])(r)&&o.push({index:i.a_batchId,componentsPerAttribute:1,componentDatatyps:l["a"].FLOAT,bufferUsage:A["a"].STATIC_DRAW}),s&&o.push({index:i.sdf,componentsPerAttribute:2,componentDatatype:l["a"].FLOAT,usage:a[ie]});var c=n?t:4*t;return new C["a"](e,o,c,n)}Object(d["a"])(oe.prototype,{length:{get:function(){return he(this),this._billboards.length}},textureAtlas:{get:function(){return this._textureAtlas},set:function(e){this._textureAtlas!==e&&(this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._textureAtlas=e,this._createVertexArray=!0)}},destroyTextureAtlas:{get:function(){return this._destroyTextureAtlas},set:function(e){this._destroyTextureAtlas=e}}}),oe.prototype.add=function(e){var t=new R["a"](e,this);return t._index=this._billboards.length,this._billboards.push(t),this._createVertexArray=!0,t},oe.prototype.remove=function(e){return!!this.contains(e)&&(this._billboards[e._index]=null,this._billboardsRemoved=!0,this._createVertexArray=!0,e._destroy(),!0)},oe.prototype.removeAll=function(){ce(this._billboards),this._billboards=[],this._billboardsToUpdate=[],this._billboardsToUpdateIndex=0,this._billboardsRemoved=!1,this._createVertexArray=!0},oe.prototype._updateBillboard=function(e,t){e._dirty||(this._billboardsToUpdate[this._billboardsToUpdateIndex++]=e),++this._propertiesChanged[t]},oe.prototype.contains=function(e){return Object(u["a"])(e)&&e._billboardCollection===this},oe.prototype.get=function(e){return he(this),this._billboards[e]},oe.prototype.computeNewBuffersUsage=function(){for(var e=this._buffersUsage,t=!1,a=this._propertiesChanged,i=0;i<ne;++i){var n=0===a[i]?A["a"].STATIC_DRAW:A["a"].STREAM_DRAW;t=t||e[i]!==n,e[i]=n}return t};var fe=new b["a"];function be(e,t,a,n,r){var o,c=n[i.positionHighAndScale],h=n[i.positionLowAndRotation],l=r._getActualPosition();e._mode===w["a"].SCENE3D&&(s["a"].expand(e._baseVolume,l,e._baseVolume),e._boundingVolumeDirty=!0),b["a"].fromCartesian(l,fe);var _=r.scale,u=r.rotation;0!==u&&(e._shaderRotation=!0),e._maxScale=Math.max(e._maxScale,_);var d=fe.high,f=fe.low;e._instanced?(o=r._index,c(o,d.x,d.y,d.z,_),h(o,f.x,f.y,f.z,u)):(o=4*r._index,c(o+0,d.x,d.y,d.z,_),c(o+1,d.x,d.y,d.z,_),c(o+2,d.x,d.y,d.z,_),c(o+3,d.x,d.y,d.z,_),h(o+0,f.x,f.y,f.z,u),h(o+1,f.x,f.y,f.z,u),h(o+2,f.x,f.y,f.z,u),h(o+3,f.x,f.y,f.z,u))}var pe=new o["a"],me=32768,ge=65536,Te=4096,Oe=256,Ae=128,ye=32,De=8,ve=4,xe=1/256,Se=0,Ee=2,Ce=3,Ie=1;function Ne(e,t,a,n,s){var o,c=n[i.compressedAttribute0],h=s.pixelOffset,l=h.x,_=h.y,u=s._translate,d=u.x,f=u.y;e._maxPixelOffset=Math.max(e._maxPixelOffset,Math.abs(l+d),Math.abs(-_+f));var b=s.horizontalOrigin,p=s._verticalOrigin,g=s.show&&s.clusterShow;0===s.color.alpha&&(g=!1),p===F["a"].BASELINE&&(p=F["a"].BOTTOM),e._allHorizontalCenter=e._allHorizontalCenter&&b===U["a"].CENTER,e._allVerticalCenter=e._allVerticalCenter&&p===F["a"].CENTER;var T=0,O=0,A=0,y=0,D=s._imageIndex;if(-1!==D){var v=a[D];T=v.x,O=v.y,A=v.width,y=v.height}var x=T+A,S=O+y,E=Math.floor(m["a"].clamp(l,-me,me)+me)*Ae;E+=(b+1)*ye,E+=(p+1)*De,E+=(g?1:0)*ve;var C=Math.floor(m["a"].clamp(_,-me,me)+me)*Oe,I=Math.floor(m["a"].clamp(d,-me,me)+me)*Oe,N=(m["a"].clamp(f,-me,me)+me)*xe,R=Math.floor(N),P=Math.floor((N-R)*Oe);C+=R,I+=P,pe.x=T,pe.y=O;var L=r["a"].compressTextureCoordinates(pe);pe.x=x;var B=r["a"].compressTextureCoordinates(pe);pe.y=S;var w=r["a"].compressTextureCoordinates(pe);pe.x=T;var j=r["a"].compressTextureCoordinates(pe);e._instanced?(o=s._index,c(o,E,C,I,L)):(o=4*s._index,c(o+0,E+Se,C,I,L),c(o+1,E+Ee,C,I,B),c(o+2,E+Ce,C,I,w),c(o+3,E+Ie,C,I,j))}function Re(e,t,a,n,s){var o,h=n[i.compressedAttribute1],l=s.alignedAxis;c["a"].equals(l,c["a"].ZERO)||(e._shaderAlignedAxis=!0);var d=0,f=1,b=1,p=1,g=s.translucencyByDistance;Object(u["a"])(g)&&(d=g.near,f=g.nearValue,b=g.far,p=g.farValue,1===f&&1===p||(e._shaderTranslucencyByDistance=!0));var T=0,O=s._imageIndex;if(-1!==O){var A=a[O];T=A.width}var y=e._textureAtlas.texture.width,D=Math.round(Object(_["a"])(s.width,y*T));e._maxSize=Math.max(e._maxSize,D);var v=m["a"].clamp(D,0,ge),x=0;Math.abs(c["a"].magnitudeSquared(l)-1)<m["a"].EPSILON6&&(x=r["a"].octEncodeFloat(l)),f=m["a"].clamp(f,0,1),f=1===f?255:255*f|0,v=v*Oe+f,p=m["a"].clamp(p,0,1),p=1===p?255:255*p|0,x=x*Oe+p,e._instanced?(o=s._index,h(o,v,x,d,b)):(o=4*s._index,h(o+0,v,x,d,b),h(o+1,v,x,d,b),h(o+2,v,x,d,b),h(o+3,v,x,d,b))}function Pe(e,t,a,n,r){var s,o=n[i.compressedAttribute2],l=r.color,d=Object(u["a"])(e._batchTable)?h["a"].WHITE:r.getPickId(t).color,f=r.sizeInMeters?1:0,b=Math.abs(c["a"].magnitudeSquared(r.alignedAxis)-1)<m["a"].EPSILON6?1:0;e._allSizedInMeters=e._allSizedInMeters&&1===f;var p=0,g=r._imageIndex;if(-1!==g){var T=a[g];p=T.height}var O=e._textureAtlas.texture.dimensions,A=Math.round(Object(_["a"])(r.height,O.y*p));e._maxSize=Math.max(e._maxSize,A);var y=Object(_["a"])(r._labelHorizontalOrigin,-2);y+=2;var D=A*ve+y,v=h["a"].floatToByte(l.red),x=h["a"].floatToByte(l.green),S=h["a"].floatToByte(l.blue),E=v*ge+x*Oe+S;v=h["a"].floatToByte(d.red),x=h["a"].floatToByte(d.green),S=h["a"].floatToByte(d.blue);var C=v*ge+x*Oe+S,I=h["a"].floatToByte(l.alpha)*ge+h["a"].floatToByte(d.alpha)*Oe;I+=2*f+b,e._instanced?(s=r._index,o(s,E,C,I,D)):(s=4*r._index,o(s+0,E,C,I,D),o(s+1,E,C,I,D),o(s+2,E,C,I,D),o(s+3,E,C,I,D))}function Le(e,t,a,n,s){var o,c=n[i.eyeOffset],h=s.eyeOffset,l=h.z;if(s._heightReference!==B["a"].NONE&&(l*=1.005),e._maxEyeOffset=Math.max(e._maxEyeOffset,Math.abs(h.x),Math.abs(h.y),Math.abs(l)),e._instanced){var _=0,u=0,d=s._imageIndex;if(-1!==d){var f=a[d];_=f.width,u=f.height}pe.x=_,pe.y=u;var b=r["a"].compressTextureCoordinates(pe);o=s._index,c(o,h.x,h.y,l,b)}else o=4*s._index,c(o+0,h.x,h.y,l,0),c(o+1,h.x,h.y,l,0),c(o+2,h.x,h.y,l,0),c(o+3,h.x,h.y,l,0)}function Be(e,t,a,n,r){var s,o=n[i.scaleByDistance],c=0,h=1,l=1,_=1,d=r.scaleByDistance;Object(u["a"])(d)&&(c=d.near,h=d.nearValue,l=d.far,_=d.farValue,1===h&&1===_||(e._shaderScaleByDistance=!0)),e._instanced?(s=r._index,o(s,c,h,l,_)):(s=4*r._index,o(s+0,c,h,l,_),o(s+1,c,h,l,_),o(s+2,c,h,l,_),o(s+3,c,h,l,_))}function Ue(e,t,a,n,r){var s,o=n[i.pixelOffsetScaleByDistance],c=0,h=1,l=1,_=1,d=r.pixelOffsetScaleByDistance;Object(u["a"])(d)&&(c=d.near,h=d.nearValue,l=d.far,_=d.farValue,1===h&&1===_||(e._shaderPixelOffsetScaleByDistance=!0)),e._instanced?(s=r._index,o(s,c,h,l,_)):(s=4*r._index,o(s+0,c,h,l,_),o(s+1,c,h,l,_),o(s+2,c,h,l,_),o(s+3,c,h,l,_))}function we(e,t,a,n,r){var s,o=n[i.compressedAttribute3],c=0,h=Number.MAX_VALUE,l=r.distanceDisplayCondition;Object(u["a"])(l)&&(c=l.near,h=l.far,c*=c,h*=h,e._shaderDistanceDisplayCondition=!0);var d,f,b=r.disableDepthTestDistance,p=r.heightReference===B["a"].CLAMP_TO_GROUND&&e._scene.context.depthTexture;if(Object(u["a"])(b)||(b=p?5e3:0),b*=b,(p||b>0)&&(e._shaderDisableDepthDistance=!0,b===Number.POSITIVE_INFINITY&&(b=-1)),Object(u["a"])(r._labelDimensions))f=r._labelDimensions.x,d=r._labelDimensions.y;else{var g=0,T=0,O=r._imageIndex;if(-1!==O){var A=a[O];g=A.height,T=A.width}d=Math.round(Object(_["a"])(r.height,e._textureAtlas.texture.dimensions.y*g));var y=e._textureAtlas.texture.width;f=Math.round(Object(_["a"])(r.width,y*T))}var D=Math.floor(m["a"].clamp(f,0,Te)),v=Math.floor(m["a"].clamp(d,0,Te)),x=D*Te+v;e._instanced?(s=r._index,o(s,c,h,b,x)):(s=4*r._index,o(s+0,c,h,b,x),o(s+1,c,h,b,x),o(s+2,c,h,b,x),o(s+3,c,h,b,x))}function je(e,t,a,n,r){var s;r.heightReference===B["a"].CLAMP_TO_GROUND&&(e._shaderClampToGround=e._scene.context.depthTexture);var o=n[i.textureCoordinateBoundsOrLabelTranslate];if(y["a"].maximumVertexTextureImageUnits>0){var c=0,h=0;return Object(u["a"])(r._labelTranslate)&&(c=r._labelTranslate.x,h=r._labelTranslate.y),void(e._instanced?(s=r._index,o(s,c,h,0,0)):(s=4*r._index,o(s+0,c,h,0,0),o(s+1,c,h,0,0),o(s+2,c,h,0,0),o(s+3,c,h,0,0)))}var l=0,_=0,d=0,f=0,b=r._imageIndex;if(-1!==b){var p=a[b];l=p.x,_=p.y,d=p.width,f=p.height}var m=l+d,g=_+f;e._instanced?(s=r._index,o(s,l,_,m,g)):(s=4*r._index,o(s+0,l,_,m,g),o(s+1,l,_,m,g),o(s+2,l,_,m,g),o(s+3,l,_,m,g))}function Me(e,t,a,n,r){if(Object(u["a"])(e._batchTable)){var s,o=n[i.a_batchId],c=r._batchIndex;e._instanced?(s=r._index,o(s,c)):(s=4*r._index,o(s+0,c),o(s+1,c),o(s+2,c),o(s+3,c))}}function Fe(e,t,a,n,r){if(e._sdf){var s,o=n[i.sdf],c=r.outlineColor,l=r.outlineWidth,_=h["a"].floatToByte(c.red),u=h["a"].floatToByte(c.green),d=h["a"].floatToByte(c.blue),f=_*ge+u*Oe+d,b=l/j["a"].RADIUS,p=h["a"].floatToByte(c.alpha)*ge+h["a"].floatToByte(b)*Oe;e._instanced?(s=r._index,o(s,f,p)):(s=4*r._index,o(s+0,f+Se,p),o(s+1,f+Ee,p),o(s+2,f+Ce,p),o(s+3,f+Ie,p))}}function Ve(e,t,a,i,n){be(e,t,a,i,n),Ne(e,t,a,i,n),Re(e,t,a,i,n),Pe(e,t,a,i,n),Le(e,t,a,i,n),Be(e,t,a,i,n),Ue(e,t,a,i,n),we(e,t,a,i,n),je(e,t,a,i,n),Me(e,t,a,i,n),Fe(e,t,a,i,n)}function ke(e,t,a,i,n,r){var o;i.mode===w["a"].SCENE3D?(o=e._baseVolume,e._boundingVolumeDirty=!0):o=e._baseVolume2D;for(var c=[],h=0;h<a;++h){var l=t[h],_=l.position,d=R["a"]._computeActualPosition(l,_,i,n);Object(u["a"])(d)&&(l._setActualPosition(d),r?c.push(d):s["a"].expand(o,d,o))}r&&s["a"].fromPoints(c,o)}function He(e,t){var a=t.mode,i=e._billboards,n=e._billboardsToUpdate,r=e._modelMatrix;e._createVertexArray||e._mode!==a||a!==w["a"].SCENE3D&&!g["a"].equals(r,e.modelMatrix)?(e._mode=a,g["a"].clone(e.modelMatrix,r),e._createVertexArray=!0,a!==w["a"].SCENE3D&&a!==w["a"].SCENE2D&&a!==w["a"].COLUMBUS_VIEW||ke(e,i,i.length,t,r,!0)):a===w["a"].MORPHING?ke(e,i,i.length,t,r,!0):a!==w["a"].SCENE2D&&a!==w["a"].COLUMBUS_VIEW||ke(e,n,e._billboardsToUpdateIndex,t,r,!1)}function We(e,t,a){var i=1;e._allSizedInMeters&&0===e._maxPixelOffset||(i=t.camera.getPixelSize(a,t.context.drawingBufferWidth,t.context.drawingBufferHeight));var n=i*e._maxScale*e._maxSize*2;e._allHorizontalCenter&&e._allVerticalCenter&&(n*=.5);var r=i*e._maxPixelOffset+e._maxEyeOffset;a.radius+=n+r}function Xe(e,t){var a;a="uniform sampler2D billboard_texture; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n    gl_FragColor = texture2D(billboard_texture, v_textureCoordinates); \n} \n";var i=t.createViewportQuadCommand(a,{uniformMap:{billboard_texture:function(){return e._textureAtlas.texture}}});return i.pass=v["a"].OVERLAY,i}var Ge=[];oe.prototype.update=function(e){he(this);var t=this._billboards,a=t.length,r=e.context;this._instanced=r.instancedArrays,i=this._instanced?se:re,n=this._instanced?_e:le;var o=this._textureAtlas;if(!Object(u["a"])(o)){o=this._textureAtlas=new M["a"]({context:r});for(var c=0;c<a;++c)t[c]._loadImage()}var h=o.textureCoordinates;if(0!==h.length){He(this,e),t=this._billboards,a=t.length;var l,_=this._billboardsToUpdate,d=this._billboardsToUpdateIndex,f=this._propertiesChanged,b=o.guid,p=this._createVertexArray||this._textureAtlasGUID!==b;this._textureAtlasGUID=b;var m=e.passes,O=m.pick;if(p||!O&&this.computeNewBuffersUsage()){this._createVertexArray=!1;for(var A=0;A<ne;++A)f[A]=0;if(this._vaf=this._vaf&&this._vaf.destroy(),a>0){this._vaf=de(r,a,this._buffersUsage,this._instanced,this._batchTable,this._sdf),l=this._vaf.writers;for(var C=0;C<a;++C){var R=this._billboards[C];R._dirty=!1,Ve(this,r,h,l,R)}this._vaf.commit(n(r))}this._billboardsToUpdateIndex=0}else if(d>0){var B=Ge;B.length=0,(f[k]||f[Z]||f[z])&&B.push(be),(f[Y]||f[H]||f[X]||f[G]||f[V])&&(B.push(Ne),this._instanced&&B.push(Le)),(f[Y]||f[Q]||f[J])&&(B.push(Re),B.push(Pe)),(f[Y]||f[q])&&B.push(Pe),f[W]&&B.push(Le),f[K]&&B.push(Be),f[$]&&B.push(Ue),(f[ee]||f[te]||f[Y]||f[k])&&B.push(we),(f[Y]||f[k])&&B.push(je),f[ie]&&B.push(Fe);var U=B.length;if(l=this._vaf.writers,d/a>.1){for(var F=0;F<d;++F){var ae=_[F];ae._dirty=!1;for(var oe=0;oe<U;++oe)B[oe](this,r,h,l,ae)}this._vaf.commit(n(r))}else{for(var ce=0;ce<d;++ce){var ue=_[ce];ue._dirty=!1;for(var fe=0;fe<U;++fe)B[fe](this,r,h,l,ue);this._instanced?this._vaf.subCommit(ue._index,1):this._vaf.subCommit(4*ue._index,4)}this._vaf.endSubCommits()}this._billboardsToUpdateIndex=0}if(d>1.5*a&&(_.length=a),Object(u["a"])(this._vaf)&&Object(u["a"])(this._vaf.va)){var pe;this._boundingVolumeDirty&&(this._boundingVolumeDirty=!1,s["a"].transform(this._baseVolume,this.modelMatrix,this._baseVolumeWC));var me=g["a"].IDENTITY;e.mode===w["a"].SCENE3D?(me=this.modelMatrix,pe=s["a"].clone(this._baseVolumeWC,this._boundingVolume)):pe=s["a"].clone(this._baseVolume2D,this._boundingVolume),We(this,e,pe);var ge,Te,Oe,Ae,ye,De=this._blendOption!==this.blendOption;if(this._blendOption=this.blendOption,De){this._blendOption===L["a"].OPAQUE||this._blendOption===L["a"].OPAQUE_AND_TRANSLUCENT?this._rsOpaque=x["a"].fromCache({depthTest:{enabled:!0,func:T["a"].LESS},depthMask:!0}):this._rsOpaque=void 0;var ve=this._blendOption===L["a"].TRANSLUCENT;this._blendOption===L["a"].TRANSLUCENT||this._blendOption===L["a"].OPAQUE_AND_TRANSLUCENT?this._rsTranslucent=x["a"].fromCache({depthTest:{enabled:!0,func:ve?T["a"].LEQUAL:T["a"].LESS},depthMask:ve,blending:P["a"].ALPHA_BLEND}):this._rsTranslucent=void 0}this._shaderDisableDepthDistance=this._shaderDisableDepthDistance||0!==e.minimumDisableDepthTestDistance;var xe=y["a"].maximumVertexTextureImageUnits>0;if(De||this._shaderRotation!==this._compiledShaderRotation||this._shaderAlignedAxis!==this._compiledShaderAlignedAxis||this._shaderScaleByDistance!==this._compiledShaderScaleByDistance||this._shaderTranslucencyByDistance!==this._compiledShaderTranslucencyByDistance||this._shaderPixelOffsetScaleByDistance!==this._compiledShaderPixelOffsetScaleByDistance||this._shaderDistanceDisplayCondition!==this._compiledShaderDistanceDisplayCondition||this._shaderDisableDepthDistance!==this._compiledShaderDisableDepthDistance||this._shaderClampToGround!==this._compiledShaderClampToGround||this._sdf!==this._compiledSDF){ge=N["a"],Te=I["a"],ye=[],Object(u["a"])(this._batchTable)&&(ye.push("VECTOR_TILE"),ge=this._batchTable.getVertexShaderCallback(!1,"a_batchId",void 0)(ge),Te=this._batchTable.getFragmentShaderCallback(!1,void 0)(Te)),Oe=new E["a"]({defines:ye,sources:[ge]}),this._instanced&&Oe.defines.push("INSTANCED"),this._shaderRotation&&Oe.defines.push("ROTATION"),this._shaderAlignedAxis&&Oe.defines.push("ALIGNED_AXIS"),this._shaderScaleByDistance&&Oe.defines.push("EYE_DISTANCE_SCALING"),this._shaderTranslucencyByDistance&&Oe.defines.push("EYE_DISTANCE_TRANSLUCENCY"),this._shaderPixelOffsetScaleByDistance&&Oe.defines.push("EYE_DISTANCE_PIXEL_OFFSET"),this._shaderDistanceDisplayCondition&&Oe.defines.push("DISTANCE_DISPLAY_CONDITION"),this._shaderDisableDepthDistance&&Oe.defines.push("DISABLE_DEPTH_DISTANCE"),this._shaderClampToGround&&(xe?Oe.defines.push("VERTEX_DEPTH_CHECK"):Oe.defines.push("FRAGMENT_DEPTH_CHECK"));var Se=1-j["a"].CUTOFF;this._sdf&&Oe.defines.push("SDF");var Ee=Object(u["a"])(this._batchTable)?"VECTOR_TILE":"";this._blendOption===L["a"].OPAQUE_AND_TRANSLUCENT&&(Ae=new E["a"]({defines:["OPAQUE",Ee],sources:[Te]}),this._shaderClampToGround&&(xe?Ae.defines.push("VERTEX_DEPTH_CHECK"):Ae.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(Ae.defines.push("SDF"),Ae.defines.push("SDF_EDGE "+Se)),this._sp=S["a"].replaceCache({context:r,shaderProgram:this._sp,vertexShaderSource:Oe,fragmentShaderSource:Ae,attributeLocations:i}),Ae=new E["a"]({defines:["TRANSLUCENT",Ee],sources:[Te]}),this._shaderClampToGround&&(xe?Ae.defines.push("VERTEX_DEPTH_CHECK"):Ae.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(Ae.defines.push("SDF"),Ae.defines.push("SDF_EDGE "+Se)),this._spTranslucent=S["a"].replaceCache({context:r,shaderProgram:this._spTranslucent,vertexShaderSource:Oe,fragmentShaderSource:Ae,attributeLocations:i})),this._blendOption===L["a"].OPAQUE&&(Ae=new E["a"]({defines:[Ee],sources:[Te]}),this._shaderClampToGround&&(xe?Ae.defines.push("VERTEX_DEPTH_CHECK"):Ae.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(Ae.defines.push("SDF"),Ae.defines.push("SDF_EDGE "+Se)),this._sp=S["a"].replaceCache({context:r,shaderProgram:this._sp,vertexShaderSource:Oe,fragmentShaderSource:Ae,attributeLocations:i})),this._blendOption===L["a"].TRANSLUCENT&&(Ae=new E["a"]({defines:[Ee],sources:[Te]}),this._shaderClampToGround&&(xe?Ae.defines.push("VERTEX_DEPTH_CHECK"):Ae.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(Ae.defines.push("SDF"),Ae.defines.push("SDF_EDGE "+Se)),this._spTranslucent=S["a"].replaceCache({context:r,shaderProgram:this._spTranslucent,vertexShaderSource:Oe,fragmentShaderSource:Ae,attributeLocations:i})),this._compiledShaderRotation=this._shaderRotation,this._compiledShaderAlignedAxis=this._shaderAlignedAxis,this._compiledShaderScaleByDistance=this._shaderScaleByDistance,this._compiledShaderTranslucencyByDistance=this._shaderTranslucencyByDistance,this._compiledShaderPixelOffsetScaleByDistance=this._shaderPixelOffsetScaleByDistance,this._compiledShaderDistanceDisplayCondition=this._shaderDistanceDisplayCondition,this._compiledShaderDisableDepthDistance=this._shaderDisableDepthDistance,this._compiledShaderClampToGround=this._shaderClampToGround,this._compiledSDF=this._sdf}var Ce=e.commandList;if(m.render||m.pick){var Ie,Me=this._colorCommands,ke=this._blendOption===L["a"].OPAQUE,ze=this._blendOption===L["a"].OPAQUE_AND_TRANSLUCENT,Ye=this._vaf.va,qe=Ye.length,Ze=this._uniforms;Object(u["a"])(this._batchTable)?(Ze=this._batchTable.getUniformMapCallback()(Ze),Ie=this._batchTable.getPickId()):Ie="v_pickColor",Me.length=qe;for(var Qe=ze?2*qe:qe,Ke=0;Ke<Qe;++Ke){var Je=Me[Ke];Object(u["a"])(Je)||(Je=Me[Ke]=new D["a"]);var $e=ke||ze&&Ke%2===0;Je.pass=$e||!ze?v["a"].OPAQUE:v["a"].TRANSLUCENT,Je.owner=this;var et=ze?Math.floor(Ke/2):Ke;Je.boundingVolume=pe,Je.modelMatrix=me,Je.count=Ye[et].indicesCount,Je.shaderProgram=$e?this._sp:this._spTranslucent,Je.uniformMap=Ze,Je.vertexArray=Ye[et].va,Je.renderState=$e?this._rsOpaque:this._rsTranslucent,Je.debugShowBoundingVolume=this.debugShowBoundingVolume,Je.pickId=Ie,this._instanced&&(Je.count=6,Je.instanceCount=a),Ce.push(Je)}this.debugShowTextureAtlas&&(Object(u["a"])(this.debugCommand)||(this.debugCommand=Xe(this,e.context)),Ce.push(this.debugCommand))}}}},oe.prototype.isDestroyed=function(){return!1},oe.prototype.destroy=function(){return Object(u["a"])(this._removeCallbackFunc)&&(this._removeCallbackFunc(),this._removeCallbackFunc=void 0),this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._sp=this._sp&&this._sp.destroy(),this._spTranslucent=this._spTranslucent&&this._spTranslucent.destroy(),this._vaf=this._vaf&&this._vaf.destroy(),ce(this._billboards),Object(f["a"])(this)},t["a"]=oe},b08e:function(e,t,a){"use strict";var i=a("0e25"),n=a("93da"),r=a("df07"),s=a("52f0"),o={X:0,Y:1,Z:2,Y_UP_TO_Z_UP:s["a"].fromRotationTranslation(r["a"].fromRotationX(n["a"].PI_OVER_TWO)),Z_UP_TO_Y_UP:s["a"].fromRotationTranslation(r["a"].fromRotationX(-n["a"].PI_OVER_TWO)),X_UP_TO_Z_UP:s["a"].fromRotationTranslation(r["a"].fromRotationY(-n["a"].PI_OVER_TWO)),Z_UP_TO_X_UP:s["a"].fromRotationTranslation(r["a"].fromRotationY(n["a"].PI_OVER_TWO)),X_UP_TO_Y_UP:s["a"].fromRotationTranslation(r["a"].fromRotationZ(n["a"].PI_OVER_TWO)),Y_UP_TO_X_UP:s["a"].fromRotationTranslation(r["a"].fromRotationZ(-n["a"].PI_OVER_TWO)),fromName:function(e){return o[e]}};t["a"]=Object(i["a"])(o)},b7c8:function(e,t,a){"use strict";var i=a("0e25"),n=a("6f00"),r=a("30d2"),s={DISABLED:Object(i["a"])({enabled:!1}),ALPHA_BLEND:Object(i["a"])({enabled:!0,equationRgb:n["a"].ADD,equationAlpha:n["a"].ADD,functionSourceRgb:r["a"].SOURCE_ALPHA,functionSourceAlpha:r["a"].ONE,functionDestinationRgb:r["a"].ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:r["a"].ONE_MINUS_SOURCE_ALPHA}),PRE_MULTIPLIED_ALPHA_BLEND:Object(i["a"])({enabled:!0,equationRgb:n["a"].ADD,equationAlpha:n["a"].ADD,functionSourceRgb:r["a"].ONE,functionSourceAlpha:r["a"].ONE,functionDestinationRgb:r["a"].ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:r["a"].ONE_MINUS_SOURCE_ALPHA}),ADDITIVE_BLEND:Object(i["a"])({enabled:!0,equationRgb:n["a"].ADD,equationAlpha:n["a"].ADD,functionSourceRgb:r["a"].SOURCE_ALPHA,functionSourceAlpha:r["a"].ONE,functionDestinationRgb:r["a"].ONE,functionDestinationAlpha:r["a"].ONE})};t["a"]=Object(i["a"])(s)},c078:function(e,t,a){"use strict";var i=a("383a"),n=a("7229"),r=a("8dfe"),s=a("535a"),o=a("2f63"),c=a("9f1d"),h=a("21d7"),l=a("93da"),_=a("eace"),u=a("d4ed"),d=a("283e"),f=a("a89b"),b=a("d3a0"),p=a("a58e"),m=a("0e25"),g={AERIAL:"Aerial",AERIAL_WITH_LABELS:"AerialWithLabels",AERIAL_WITH_LABELS_ON_DEMAND:"AerialWithLabelsOnDemand",ROAD:"Road",ROAD_ON_DEMAND:"RoadOnDemand",CANVAS_DARK:"CanvasDark",CANVAS_LIGHT:"CanvasLight",CANVAS_GRAY:"CanvasGray",ORDNANCE_SURVEY:"OrdnanceSurvey",COLLINS_BART:"CollinsBart"},T=Object(m["a"])(g),O=a("1360"),A=a("64ac");function y(e){e=Object(s["a"])(e,s["a"].EMPTY_OBJECT),this._key=i["a"].getKey(e.key),this._resource=u["a"].createIfNeeded(e.url),this._resource.appendForwardSlash(),this._tileProtocol=e.tileProtocol,this._mapStyle=Object(s["a"])(e.mapStyle,T.AERIAL),this._culture=Object(s["a"])(e.culture,""),this._tileDiscardPolicy=e.tileDiscardPolicy,Object(o["a"])(this._tileDiscardPolicy)||(this._tileDiscardPolicy=new O["a"]),this._proxy=e.proxy,this._credit=new r["a"]('<a href="http://www.bing.com"><img src="'+y.logoUrl+'" title="Bing Imagery"/></a>'),this.defaultGamma=1,this._tilingScheme=new b["a"]({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2,ellipsoid:e.ellipsoid}),this._tileWidth=void 0,this._tileHeight=void 0,this._maximumLevel=void 0,this._imageUrlTemplate=void 0,this._imageUrlSubdomains=void 0,this._errorEvent=new h["a"],this._ready=!1,this._readyPromise=p["a"].defer();var t=this._tileProtocol;if(Object(o["a"])(t))t.length>0&&":"===t[t.length-1]&&(t=t.substr(0,t.length-1));else{var a=document.location.protocol;t="http:"===a?"http":"https"}var n,c=this._resource.getDerivedResource({url:"REST/v1/Imagery/Metadata/"+this._mapStyle,queryParameters:{incl:"ImageryProviders",key:this._key,uriScheme:t}}),m=this;function g(e){if(1===e.resourceSets.length){var t=e.resourceSets[0].resources[0];m._tileWidth=t.imageWidth,m._tileHeight=t.imageHeight,m._maximumLevel=t.zoomMax-1,m._imageUrlSubdomains=t.imageUrlSubdomains,m._imageUrlTemplate=t.imageUrl;var a=m._attributionList=t.imageryProviders;a||(a=m._attributionList=[]);for(var i=0,s=a.length;i<s;++i){var o=a[i];if(o.credit instanceof r["a"])break;o.credit=new r["a"](o.attribution);for(var c=o.coverageAreas,h=0,u=o.coverageAreas.length;h<u;++h){var d=c[h],b=d.bbox;d.bbox=new _["a"](l["a"].toRadians(b[1]),l["a"].toRadians(b[0]),l["a"].toRadians(b[3]),l["a"].toRadians(b[2]))}}m._ready=!0,m._readyPromise.resolve(!0),f["a"].handleSuccess(n)}else A()}function A(e){var t="An error occurred while accessing "+c.url+".";n=f["a"].handleError(n,m,m._errorEvent,t,void 0,void 0,void 0,v),m._readyPromise.reject(new d["a"](t))}var D=c.url;function v(){var e=c.fetchJsonp("jsonp");y._metadataCache[D]=e,e.then(g).otherwise(A)}var x=y._metadataCache[D];Object(o["a"])(x)?x.then(g).otherwise(A):v()}Object(c["a"])(y.prototype,{url:{get:function(){return this._resource.url}},proxy:{get:function(){return this._resource.proxy}},key:{get:function(){return this._key}},mapStyle:{get:function(){return this._mapStyle}},culture:{get:function(){return this._culture}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return this._maximumLevel}},minimumLevel:{get:function(){return 0}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!1}}});var D=new _["a"];function v(e,t,a,i,n){var r=e._imageUrlTemplate,s=e._imageUrlSubdomains,o=(t+a+i)%s.length;return e._resource.getDerivedResource({url:r,request:n,templateValues:{quadkey:y.tileXYToQuadKey(t,a,i),subdomain:s[o],culture:e._culture},queryParameters:{n:"z"}})}y.prototype.getTileCredits=function(e,t,a){var i=this._tilingScheme.tileXYToRectangle(e,t,a,D),n=S(this._attributionList,a,i);return n},y.prototype.requestImage=function(e,t,a,i){var n=A["a"].loadImage(this,v(this,e,t,a,i));if(Object(o["a"])(n))return n.otherwise((function(e){return Object(o["a"])(e.blob)&&0===e.blob.size?O["a"].EMPTY_IMAGE:p["a"].reject(e)}))},y.prototype.pickFeatures=function(e,t,a,i,n){},y.tileXYToQuadKey=function(e,t,a){for(var i="",n=a;n>=0;--n){var r=1<<n,s=0;0!==(e&r)&&(s|=1),0!==(t&r)&&(s|=2),i+=s}return i},y.quadKeyToTileXY=function(e){for(var t=0,a=0,i=e.length-1,n=i;n>=0;--n){var r=1<<n,s=+e[i-n];0!==(1&s)&&(t|=r),0!==(2&s)&&(a|=r)}return{x:t,y:a,level:i}},y._logoUrl=void 0,Object(c["a"])(y,{logoUrl:{get:function(){return Object(o["a"])(y._logoUrl)||(y._logoUrl=Object(n["a"])("Assets/Images/bing_maps_credit.png")),y._logoUrl},set:function(e){y._logoUrl=e}}});var x=new _["a"];function S(e,t,a){++t;for(var i=[],n=0,r=e.length;n<r;++n){for(var s=e[n],c=s.coverageAreas,h=!1,l=0,u=s.coverageAreas.length;!h&&l<u;++l){var d=c[l];if(t>=d.zoomMin&&t<=d.zoomMax){var f=_["a"].intersection(a,d.bbox,x);Object(o["a"])(f)&&(h=!0)}}h&&i.push(s.credit)}return i}y._metadataCache={};t["a"]=y}}]);