(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Cesium~66537c81"],{"2a1b":function(e,t,a){"use strict";var r=a("670c"),i=a("be18"),n=a("bef8"),s=a("abab"),o=a("535a"),h=a("2f63"),u=a("9f1d"),c=a("6cbd"),d=a("c888"),m=a("93da"),_=a("52f0"),p=a("eace"),l=a("f806"),f=a("5770"),w=a("3a8e"),g=a("001c");function C(e,t,a,r){this._projectionExtentDefines={eastMostYhighDefine:"",eastMostYlowDefine:"",westMostYhighDefine:"",westMostYlowDefine:""},this._useFloatBatchTable=r;var i=new y;i.requiresTextureCoordinates=e,i.requiresEC=!a.flat;var n=new y;if(n.requiresTextureCoordinates=e,a instanceof w["a"])i.requiresNormalEC=!a.flat;else{var s=a.material.shaderSource+"\n"+a.fragmentShaderSource;i.normalEC=-1!==s.indexOf("materialInput.normalEC")||-1!==s.indexOf("czm_getDefaultMaterial"),i.positionToEyeEC=-1!==s.indexOf("materialInput.positionToEyeEC"),i.tangentToEyeMatrix=-1!==s.indexOf("materialInput.tangentToEyeMatrix"),i.st=-1!==s.indexOf("materialInput.st")}this._colorShaderDependencies=i,this._pickShaderDependencies=n,this._appearance=a,this._extentsCulling=e,this._planarExtents=t}C.prototype.createFragmentShader=function(e){var t=this._appearance,a=this._colorShaderDependencies,r=[];e||this._planarExtents||r.push("SPHERICAL"),a.requiresEC&&r.push("REQUIRES_EC"),a.requiresWC&&r.push("REQUIRES_WC"),a.requiresTextureCoordinates&&r.push("TEXTURE_COORDINATES"),this._extentsCulling&&r.push("CULL_FRAGMENTS"),a.requiresNormalEC&&r.push("NORMAL_EC"),t instanceof w["a"]&&r.push("PER_INSTANCE_COLOR"),a.normalEC&&r.push("USES_NORMAL_EC"),a.positionToEyeEC&&r.push("USES_POSITION_TO_EYE_EC"),a.tangentToEyeMatrix&&r.push("USES_TANGENT_TO_EYE"),a.st&&r.push("USES_ST"),t.flat&&r.push("FLAT");var i="";return t instanceof w["a"]||(i=t.material.shaderSource),new f["a"]({defines:r,sources:[i,g["a"]]})},C.prototype.createPickFragmentShader=function(e){var t=this._pickShaderDependencies,a=["PICK"];return e||this._planarExtents||a.push("SPHERICAL"),t.requiresEC&&a.push("REQUIRES_EC"),t.requiresWC&&a.push("REQUIRES_WC"),t.requiresTextureCoordinates&&a.push("TEXTURE_COORDINATES"),this._extentsCulling&&a.push("CULL_FRAGMENTS"),new f["a"]({defines:a,sources:[g["a"]],pickColorQualifier:"varying"})},C.prototype.createVertexShader=function(e,t,a,r){return b(this._colorShaderDependencies,this._planarExtents,a,e,t,this._appearance,r,this._useFloatBatchTable,this._projectionExtentDefines)},C.prototype.createPickVertexShader=function(e,t,a,r){return b(this._pickShaderDependencies,this._planarExtents,a,e,t,void 0,r,this._useFloatBatchTable,this._projectionExtentDefines)};var v=new i["a"],S=new n["a"],x={high:0,low:0};function b(e,t,a,r,i,n,s,o,u){var d=r.slice();if(""===u.eastMostYhighDefine){var _=S;_.longitude=m["a"].PI,_.latitude=0,_.height=0;var p=s.project(_,v),l=c["a"].encode(p.x,x);u.eastMostYhighDefine="EAST_MOST_X_HIGH "+l.high.toFixed((l.high+"").length+1),u.eastMostYlowDefine="EAST_MOST_X_LOW "+l.low.toFixed((l.low+"").length+1);var g=S;g.longitude=-m["a"].PI,g.latitude=0,g.height=0;var C=s.project(g,v);l=c["a"].encode(C.x,x),u.westMostYhighDefine="WEST_MOST_X_HIGH "+l.high.toFixed((l.high+"").length+1),u.westMostYlowDefine="WEST_MOST_X_LOW "+l.low.toFixed((l.low+"").length+1)}return a&&(d.push(u.eastMostYhighDefine),d.push(u.eastMostYlowDefine),d.push(u.westMostYhighDefine),d.push(u.westMostYlowDefine)),Object(h["a"])(n)&&n instanceof w["a"]&&d.push("PER_INSTANCE_COLOR"),e.requiresTextureCoordinates&&(d.push("TEXTURE_COORDINATES"),t||a||d.push("SPHERICAL"),a&&d.push("COLUMBUS_VIEW_2D")),o||d.push("UINT8_PACKING"),new f["a"]({defines:d,sources:[i]})}function y(){this._requiresEC=!1,this._requiresWC=!1,this._requiresNormalEC=!1,this._requiresTextureCoordinates=!1,this._usesNormalEC=!1,this._usesPositionToEyeEC=!1,this._usesTangentToEyeMat=!1,this._usesSt=!1}function E(e,t,a){return Math.abs((t.y-e.y)*a.x-(t.x-e.x)*a.y+t.x*e.y-t.y*e.x)/r["a"].distance(t,e)}Object(u["a"])(y.prototype,{requiresEC:{get:function(){return this._requiresEC},set:function(e){this._requiresEC=e||this._requiresEC}},requiresWC:{get:function(){return this._requiresWC},set:function(e){this._requiresWC=e||this._requiresWC,this.requiresEC=this._requiresWC}},requiresNormalEC:{get:function(){return this._requiresNormalEC},set:function(e){this._requiresNormalEC=e||this._requiresNormalEC,this.requiresEC=this._requiresNormalEC}},requiresTextureCoordinates:{get:function(){return this._requiresTextureCoordinates},set:function(e){this._requiresTextureCoordinates=e||this._requiresTextureCoordinates,this.requiresWC=this._requiresTextureCoordinates}},normalEC:{set:function(e){this.requiresNormalEC=e,this._usesNormalEC=e},get:function(){return this._usesNormalEC}},tangentToEyeMatrix:{set:function(e){this.requiresWC=e,this.requiresNormalEC=e,this._usesTangentToEyeMat=e},get:function(){return this._usesTangentToEyeMat}},positionToEyeEC:{set:function(e){this.requiresEC=e,this._usesPositionToEyeEC=e},get:function(){return this._usesPositionToEyeEC}},st:{set:function(e){this.requiresTextureCoordinates=e,this._usesSt=e},get:function(){return this._usesSt}}});var O=[new r["a"],new r["a"],new r["a"],new r["a"]];function M(e,t){var a=O,i=r["a"].unpack(t,0,a[0]),n=r["a"].unpack(t,2,a[1]),o=r["a"].unpack(t,4,a[2]);e.uMaxVmax=new d["a"]({componentDatatype:s["a"].FLOAT,componentsPerAttribute:4,normalize:!1,value:[n.x,n.y,o.x,o.y]});var h=1/E(i,n,o),u=1/E(i,o,n);e.uvMinAndExtents=new d["a"]({componentDatatype:s["a"].FLOAT,componentsPerAttribute:4,normalize:!1,value:[i.x,i.y,h,u]})}function A(e,t,a){var r=Math.abs(e),i=Math.floor(r/1e3);r-=1e3*i;var n=Math.floor(r/10);r-=10*n;var o=Math.floor(10*r);r-=.1*o;var h=Math.floor(1e3*r);e<0&&(i=255-i),a[t]=new d["a"]({componentDatatype:s["a"].UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!1,value:[i,n,o,h]})}function D(e,t,a){var r=Math.abs(e),i=Math.floor(r/1e6);r-=1e6*i;var n=Math.floor(r/1e4);r-=1e4*n;var o=Math.floor(r/100);r-=100*o;var h=Math.floor(r);e<0&&(i=255-i),a[t]=new d["a"]({componentDatatype:s["a"].UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!1,value:[i,n,o,h]})}function P(e,t,a){var r=Math.abs(e),i=Math.floor(r/1e4);r-=1e4*i;var n=Math.floor(r/100);r-=100*n;var o=Math.floor(r);r-=o;var h=Math.floor(r/.001);e<0&&(i=255-i),a[t]=new d["a"]({componentDatatype:s["a"].UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!1,value:[i,n,o,h]})}var L=new n["a"],T=new i["a"],N=new i["a"],F=new i["a"],z={high:0,low:0};function I(e,t,a,r){var i=L;i.height=0,i.longitude=e.west,i.latitude=e.south;var n=t.project(i,T);i.latitude=e.north;var o=t.project(i,N);i.longitude=e.east,i.latitude=e.south;var h,u=t.project(i,F);if(!r)return h=c["a"].encode(n.x,z),D(h.high,"planes2D_HIGH_x",a),A(h.low,"planes2D_LOW_x",a),h=c["a"].encode(n.y,z),D(h.high,"planes2D_HIGH_y",a),A(h.low,"planes2D_LOW_y",a),h=c["a"].encode(o.y,z),D(h.high,"planes2D_HIGH_z",a),A(h.low,"planes2D_LOW_z",a),h=c["a"].encode(u.x,z),D(h.high,"planes2D_HIGH_w",a),void A(h.low,"planes2D_LOW_w",a);var m=[0,0,0,0],_=[0,0,0,0];h=c["a"].encode(n.x,z),m[0]=h.high,_[0]=h.low,h=c["a"].encode(n.y,z),m[1]=h.high,_[1]=h.low,h=c["a"].encode(o.y,z),m[2]=h.high,_[2]=h.low,h=c["a"].encode(u.x,z),m[3]=h.high,_[3]=h.low,a.planes2D_HIGH=new d["a"]({componentDatatype:s["a"].FLOAT,componentsPerAttribute:4,normalize:!1,value:m}),a.planes2D_LOW=new d["a"]({componentDatatype:s["a"].FLOAT,componentsPerAttribute:4,normalize:!1,value:_})}var j=new _["a"],W=new _["a"],R=new i["a"],V=new n["a"],H=[new n["a"],new n["a"],new n["a"],new n["a"],new n["a"],new n["a"],new n["a"],new n["a"]];function B(e,t,a,r,s,o){var h=p["a"].center(e,V);h.height=a;var u=n["a"].toCartesian(h,t,R),c=l["a"].eastNorthUpToFixedFrame(u,t,j),d=_["a"].inverse(c,W),m=e.west,f=e.east,w=e.north,g=e.south,C=H;C[0].latitude=g,C[0].longitude=m,C[1].latitude=w,C[1].longitude=m,C[2].latitude=w,C[2].longitude=f,C[3].latitude=g,C[3].longitude=f;var v=.5*(m+f),S=.5*(w+g);C[4].latitude=g,C[4].longitude=v,C[5].latitude=w,C[5].longitude=v,C[6].latitude=S,C[6].longitude=m,C[7].latitude=S,C[7].longitude=f;for(var x=Number.POSITIVE_INFINITY,b=Number.NEGATIVE_INFINITY,y=Number.POSITIVE_INFINITY,E=Number.NEGATIVE_INFINITY,O=0;O<8;O++){C[O].height=a;var M=n["a"].toCartesian(C[O],t,R);_["a"].multiplyByPoint(d,M,M),M.z=0,x=Math.min(x,M.x),b=Math.max(b,M.x),y=Math.min(y,M.y),E=Math.max(E,M.y)}var A=r;A.x=x,A.y=y,A.z=0,_["a"].multiplyByPoint(c,A,A);var D=s;D.x=b,D.y=y,D.z=0,_["a"].multiplyByPoint(c,D,D),i["a"].subtract(D,A,s);var P=o;P.x=x,P.y=E,P.z=0,_["a"].multiplyByPoint(c,P,P),i["a"].subtract(P,A,o)}var U=new i["a"],k=new i["a"],G=new c["a"];C.getPlanarTextureCoordinateAttributes=function(e,t,a,r,n,h){var u=T,m=U,_=k;B(e,a,Object(o["a"])(h,0),u,m,_);var p={};M(p,t);var l=c["a"].fromCartesian(u,G);if(!n){var f=l.high;D(f.x,"southWest_HIGH_x",p),D(f.y,"southWest_HIGH_y",p),D(f.z,"southWest_HIGH_z",p);var w=l.low;return A(w.x,"southWest_LOW_x",p),A(w.y,"southWest_LOW_y",p),A(w.z,"southWest_LOW_z",p),P(m.x,"eastward_x",p),P(m.y,"eastward_y",p),P(m.z,"eastward_z",p),P(_.x,"northward_x",p),P(_.y,"northward_y",p),P(_.z,"northward_z",p),I(e,r,p,!1),p}return p.southWest_HIGH=new d["a"]({componentDatatype:s["a"].FLOAT,componentsPerAttribute:3,normalize:!1,value:i["a"].pack(l.high,[0,0,0])}),p.southWest_LOW=new d["a"]({componentDatatype:s["a"].FLOAT,componentsPerAttribute:3,normalize:!1,value:i["a"].pack(l.low,[0,0,0])}),p.eastward=new d["a"]({componentDatatype:s["a"].FLOAT,componentsPerAttribute:3,normalize:!1,value:i["a"].pack(m,[0,0,0])}),p.northward=new d["a"]({componentDatatype:s["a"].FLOAT,componentsPerAttribute:3,normalize:!1,value:i["a"].pack(_,[0,0,0])}),I(e,r,p,!0),p};var q=new i["a"];function Y(e,t,a,r){var i=L;i.latitude=e,i.longitude=t,i.height=0;var s=n["a"].toCartesian(i,a,q),o=Math.sqrt(s.x*s.x+s.y*s.y),h=m["a"].fastApproximateAtan2(o,s.z),u=m["a"].fastApproximateAtan2(s.x,s.y);return r.x=h,r.y=u,r}var X=new r["a"];function K(e){return Math.max(e.width,e.height)>C.MAX_WIDTH_FOR_PLANAR_EXTENTS}C.getSphericalExtentGeometryInstanceAttributes=function(e,t,a,r,i){var n=Y(e.south,e.west,a,X),o=n.x,h=n.y,u=Y(e.north,e.east,a,X),c=u.x,_=u.y,p=0;h>_&&(p=m["a"].PI-h,h=-m["a"].PI,_+=p),o-=m["a"].EPSILON5,h-=m["a"].EPSILON5,c+=m["a"].EPSILON5,_+=m["a"].EPSILON5;var l=1/(_-h),f=1/(c-o),w={sphericalExtents:new d["a"]({componentDatatype:s["a"].FLOAT,componentsPerAttribute:4,normalize:!1,value:[o,h,f,l]}),longitudeRotation:new d["a"]({componentDatatype:s["a"].FLOAT,componentsPerAttribute:1,normalize:!1,value:[p]})};return M(w,t),I(e,r,w,i),w},C.hasAttributesForTextureCoordinatePlanes=function(e){var t=Object(h["a"])(e.southWest_HIGH)&&Object(h["a"])(e.southWest_LOW)&&Object(h["a"])(e.northward)&&Object(h["a"])(e.eastward)&&Object(h["a"])(e.planes2D_HIGH)&&Object(h["a"])(e.planes2D_LOW)&&Object(h["a"])(e.uMaxVmax)&&Object(h["a"])(e.uvMinAndExtents),a=Object(h["a"])(e.southWest_HIGH_x)&&Object(h["a"])(e.southWest_LOW_x)&&Object(h["a"])(e.southWest_HIGH_y)&&Object(h["a"])(e.southWest_LOW_y)&&Object(h["a"])(e.southWest_HIGH_z)&&Object(h["a"])(e.southWest_LOW_z)&&Object(h["a"])(e.northward_x)&&Object(h["a"])(e.eastward_x)&&Object(h["a"])(e.northward_y)&&Object(h["a"])(e.eastward_y)&&Object(h["a"])(e.northward_z)&&Object(h["a"])(e.eastward_z)&&Object(h["a"])(e.planes2D_HIGH_x)&&Object(h["a"])(e.planes2D_LOW_x)&&Object(h["a"])(e.planes2D_HIGH_y)&&Object(h["a"])(e.planes2D_LOW_y)&&Object(h["a"])(e.planes2D_HIGH_z)&&Object(h["a"])(e.planes2D_LOW_z)&&Object(h["a"])(e.planes2D_HIGH_w)&&Object(h["a"])(e.planes2D_LOW_w)&&Object(h["a"])(e.uMaxVmax)&&Object(h["a"])(e.uvMinAndExtents);return t||a},C.hasAttributesForSphericalExtents=function(e){var t=Object(h["a"])(e.sphericalExtents)&&Object(h["a"])(e.longitudeRotation)&&Object(h["a"])(e.planes2D_HIGH)&&Object(h["a"])(e.planes2D_LOW)&&Object(h["a"])(e.uMaxVmax)&&Object(h["a"])(e.uvMinAndExtents),a=Object(h["a"])(e.sphericalExtents)&&Object(h["a"])(e.longitudeRotation)&&Object(h["a"])(e.planes2D_HIGH_x)&&Object(h["a"])(e.planes2D_LOW_x)&&Object(h["a"])(e.planes2D_HIGH_y)&&Object(h["a"])(e.planes2D_LOW_y)&&Object(h["a"])(e.planes2D_HIGH_z)&&Object(h["a"])(e.planes2D_LOW_z)&&Object(h["a"])(e.planes2D_HIGH_w)&&Object(h["a"])(e.planes2D_LOW_w)&&Object(h["a"])(e.uMaxVmax)&&Object(h["a"])(e.uvMinAndExtents);return t||a},C.shouldUseSphericalCoordinates=function(e){return K(e)},C.MAX_WIDTH_FOR_PLANAR_EXTENTS=m["a"].toRadians(1),t["a"]=C},"569f":function(e,t,a){"use strict";var r=a("77af"),i=a("cef5"),n=a("b081"),s=a("670c"),o=a("be18"),h=a("a561"),u=a("bef8"),c=a("dc1c"),d=a("bd8d"),m=a("9541"),_=a("2bb9"),p=a("2384"),l=a("535a"),f=a("2f63"),w=a("9f1d"),g=a("7d62"),C=a("5e57"),v=a("d940"),S=a("66bf"),x=a("93da"),b=a("52f0"),y=a("c34a"),E=a("4e1a"),O=a("e42d"),M=a("0260"),A=a("98f6"),D=a("daa2"),P=a("f845"),L=a("b997"),T=a("9ab9"),N=a("a894"),F=a("ac3b"),z=a("d289"),I=a("00f8"),j=a("6ef5"),W=a("8a65"),R=a("3550"),V=a("6dc0"),H=a("6c84"),B=a("a913"),U=a("3022"),k=a("03f1"),G=a("23b6"),q=a("9dbf"),Y=a("29ab"),X=a("c965"),K=a("3a8e"),Q=a("894b"),Z=a("5770");function J(){}J.getShadowCastShaderKeyword=function(e,t,a,r){return"castShadow "+e+" "+t+" "+a+" "+r},J.createShadowCastVertexShader=function(e,t,a){var r=e.defines.slice(0),i=e.sources.slice(0);r.push("SHADOW_MAP"),a&&r.push("GENERATE_POSITION");var n=Z["a"].findPositionVarying(e),s=Object(f["a"])(n);if(t&&!s){for(var o=i.length,h=0;h<o;++h)i[h]=Z["a"].replaceMain(i[h],"czm_shadow_cast_main");var u="varying vec3 v_positionEC; \nvoid main() \n{ \n    czm_shadow_cast_main(); \n    v_positionEC = (czm_inverseProjection * gl_Position).xyz; \n}";i.push(u)}return new Z["a"]({defines:r,sources:i})},J.createShadowCastFragmentShader=function(e,t,a,r){var i=e.defines.slice(0),n=e.sources.slice(0),s=Z["a"].findPositionVarying(e),o=Object(f["a"])(s);o||(s="v_positionEC");for(var h=n.length,u=0;u<h;++u)n[u]=Z["a"].replaceMain(n[u],"czm_shadow_cast_main");var c="";return t&&(o||(c+="varying vec3 v_positionEC; \n"),c+="uniform vec4 shadowMap_lightPositionEC; \n"),c+=r?"void main() \n{ \n":"void main() \n{ \n    czm_shadow_cast_main(); \n    if (gl_FragColor.a == 0.0) \n    { \n       discard; \n    } \n",c+=t?"    float distance = length("+s+"); \n    if (distance >= shadowMap_lightPositionEC.w) \n    { \n        discard; \n    } \n    distance /= shadowMap_lightPositionEC.w; // radius \n    gl_FragColor = czm_packDepth(distance); \n":a?"    gl_FragColor = vec4(1.0); \n":"    gl_FragColor = czm_packDepth(gl_FragCoord.z); \n",c+="} \n",n.push(c),new Z["a"]({defines:i,sources:n})},J.getShadowReceiveShaderKeyword=function(e,t,a,r){var i=e._usesDepthTexture,n=e._polygonOffsetSupported,s=e._isPointLight,o=e._isSpotLight,h=e._numberOfCascades>1,u=e.debugCascadeColors,c=e.softShadows;return"receiveShadow "+i+n+s+o+h+u+c+t+a+r},J.createShadowReceiveVertexShader=function(e,t,a){var r=e.defines.slice(0),i=e.sources.slice(0);return r.push("SHADOW_MAP"),t&&(a?r.push("GENERATE_POSITION_AND_NORMAL"):r.push("GENERATE_POSITION")),new Z["a"]({defines:r,sources:i})},J.createShadowReceiveFragmentShader=function(e,t,a,r,i){for(var n=Z["a"].findNormalVarying(e),s=!r&&Object(f["a"])(n)||r&&i,o=Z["a"].findPositionVarying(e),h=Object(f["a"])(o),u=t._usesDepthTexture,c=t._polygonOffsetSupported,d=t._isPointLight,m=t._isSpotLight,_=t._numberOfCascades>1,p=t.debugCascadeColors,l=t.softShadows,w=d?t._pointBias:r?t._terrainBias:t._primitiveBias,g=e.defines.slice(0),C=e.sources.slice(0),v=C.length,S=0;S<v;++S)C[S]=Z["a"].replaceMain(C[S],"czm_shadow_receive_main");d?g.push("USE_CUBE_MAP_SHADOW"):u&&g.push("USE_SHADOW_DEPTH_TEXTURE"),l&&!d&&g.push("USE_SOFT_SHADOWS"),_&&a&&r&&(s?g.push("ENABLE_VERTEX_LIGHTING"):g.push("ENABLE_DAYNIGHT_SHADING")),a&&w.normalShading&&s&&(g.push("USE_NORMAL_SHADING"),w.normalShadingSmooth>0&&g.push("USE_NORMAL_SHADING_SMOOTH"));var x,b="";return b+=d?"uniform samplerCube shadowMap_textureCube; \n":"uniform sampler2D shadowMap_texture; \n",x=h?"    return vec4("+o+", 1.0); \n":"#ifndef LOG_DEPTH \n    return czm_windowToEyeCoordinates(gl_FragCoord); \n#else \n    return vec4(v_logPositionEC, 1.0); \n#endif \n",b+="uniform mat4 shadowMap_matrix; \nuniform vec3 shadowMap_lightDirectionEC; \nuniform vec4 shadowMap_lightPositionEC; \nuniform vec4 shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness; \nuniform vec4 shadowMap_texelSizeDepthBiasAndNormalShadingSmooth; \n#ifdef LOG_DEPTH \nvarying vec3 v_logPositionEC; \n#endif \nvec4 getPositionEC() \n{ \n"+x+"} \nvec3 getNormalEC() \n{ \n"+(s?"    return normalize("+n+"); \n":"    return vec3(1.0); \n")+"} \nvoid applyNormalOffset(inout vec4 positionEC, vec3 normalEC, float nDotL) \n{ \n"+(w.normalOffset&&s?"    float normalOffset = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.x; \n    float normalOffsetScale = 1.0 - nDotL; \n    vec3 offset = normalOffset * normalOffsetScale * normalEC; \n    positionEC.xyz += offset; \n":"")+"} \n",b+="void main() \n{ \n    czm_shadow_receive_main(); \n    vec4 positionEC = getPositionEC(); \n    vec3 normalEC = getNormalEC(); \n    float depth = -positionEC.z; \n",b+="    czm_shadowParameters shadowParameters; \n    shadowParameters.texelStepSize = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.xy; \n    shadowParameters.depthBias = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.z; \n    shadowParameters.normalShadingSmooth = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.w; \n    shadowParameters.darkness = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.w; \n",r?b+="    shadowParameters.depthBias *= max(depth * 0.01, 1.0); \n":c||(b+="    shadowParameters.depthBias *= mix(1.0, 100.0, depth * 0.0015); \n"),b+=d?"    vec3 directionEC = positionEC.xyz - shadowMap_lightPositionEC.xyz; \n    float distance = length(directionEC); \n    directionEC = normalize(directionEC); \n    float radius = shadowMap_lightPositionEC.w; \n    // Stop early if the fragment is beyond the point light radius \n    if (distance > radius) \n    { \n        return; \n    } \n    vec3 directionWC  = czm_inverseViewRotation * directionEC; \n    shadowParameters.depth = distance / radius; \n    shadowParameters.nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0); \n    shadowParameters.texCoords = directionWC; \n    float visibility = czm_shadowVisibility(shadowMap_textureCube, shadowParameters); \n":m?"    vec3 directionEC = normalize(positionEC.xyz - shadowMap_lightPositionEC.xyz); \n    float nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    vec4 shadowPosition = shadowMap_matrix * positionEC; \n    // Spot light uses a perspective projection, so perform the perspective divide \n    shadowPosition /= shadowPosition.w; \n    // Stop early if the fragment is not in the shadow bounds \n    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \n    { \n        return; \n    } \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    shadowParameters.nDotL = nDotL; \n    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \n":_?"    float maxDepth = shadowMap_cascadeSplits[1].w; \n    // Stop early if the eye depth exceeds the last cascade \n    if (depth > maxDepth) \n    { \n        return; \n    } \n    // Get the cascade based on the eye-space depth \n    vec4 weights = czm_cascadeWeights(depth); \n    // Apply normal offset \n    float nDotL = clamp(dot(normalEC, shadowMap_lightDirectionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    // Transform position into the cascade \n    vec4 shadowPosition = czm_cascadeMatrix(weights) * positionEC; \n    // Get visibility \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    shadowParameters.nDotL = nDotL; \n    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \n    // Fade out shadows that are far away \n    float shadowMapMaximumDistance = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.z; \n    float fade = max((depth - shadowMapMaximumDistance * 0.8) / (shadowMapMaximumDistance * 0.2), 0.0); \n    visibility = mix(visibility, 1.0, fade); \n"+(p?"    // Draw cascade colors for debugging \n    gl_FragColor *= czm_cascadeColor(weights); \n":""):"    float nDotL = clamp(dot(normalEC, shadowMap_lightDirectionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    vec4 shadowPosition = shadowMap_matrix * positionEC; \n    // Stop early if the fragment is not in the shadow bounds \n    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \n    { \n        return; \n    } \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    shadowParameters.nDotL = nDotL; \n    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \n",b+="    gl_FragColor.rgb *= visibility; \n} \n",C.push(b),new Z["a"]({defines:g,sources:C})};var $=J;function ee(e){e=Object(l["a"])(e,l["a"].EMPTY_OBJECT);var t=e.context;this._enabled=Object(l["a"])(e.enabled,!0),this._softShadows=Object(l["a"])(e.softShadows,!1),this._normalOffset=Object(l["a"])(e.normalOffset,!0),this.dirty=!0,this.fromLightSource=Object(l["a"])(e.fromLightSource,!0),this.darkness=Object(l["a"])(e.darkness,.3),this._darkness=this.darkness,this.maximumDistance=Object(l["a"])(e.maximumDistance,5e3),this._outOfView=!1,this._outOfViewPrevious=!1,this._needsUpdate=!0;var a,r=!0;(C["a"].isInternetExplorer()||C["a"].isEdge()||(C["a"].isChrome()||C["a"].isFirefox())&&C["a"].isWindows()&&!t.depthTexture)&&(r=!1),this._polygonOffsetSupported=r,this._terrainBias={polygonOffset:r,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:.5,normalShading:!0,normalShadingSmooth:.3,depthBias:1e-4},this._primitiveBias={polygonOffset:r,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:.1,normalShading:!0,normalShadingSmooth:.05,depthBias:2e-5},this._pointBias={polygonOffset:!1,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:0,normalShading:!0,normalShadingSmooth:.1,depthBias:5e-4},this._depthAttachment=void 0,this._colorAttachment=void 0,this._shadowMapMatrix=new b["a"],this._shadowMapTexture=void 0,this._lightDirectionEC=new o["a"],this._lightPositionEC=new h["a"],this._distance=0,this._lightCamera=e.lightCamera,this._shadowMapCamera=new Ee,this._shadowMapCullingVolume=void 0,this._sceneCamera=void 0,this._boundingSphere=new i["a"],this._isPointLight=Object(l["a"])(e.isPointLight,!1),this._pointLightRadius=Object(l["a"])(e.pointLightRadius,100),this._cascadesEnabled=!this._isPointLight&&Object(l["a"])(e.cascadesEnabled,!0),this._numberOfCascades=this._cascadesEnabled?Object(l["a"])(e.numberOfCascades,4):0,this._fitNearFar=!0,this._maximumCascadeDistances=[25,150,700,Number.MAX_VALUE],this._textureSize=new s["a"],this._isSpotLight=!1,this._cascadesEnabled?this._shadowMapCamera.frustum=new y["a"]:Object(f["a"])(this._lightCamera.frustum.fov)&&(this._isSpotLight=!0),this._cascadeSplits=[new h["a"],new h["a"]],this._cascadeMatrices=[new b["a"],new b["a"],new b["a"],new b["a"]],this._cascadeDistances=new h["a"],a=this._isPointLight?6:this._cascadesEnabled?this._numberOfCascades:1,this._passes=new Array(a);for(var n=0;n<a;++n)this._passes[n]=new te(t);this.debugShow=!1,this.debugFreezeFrame=!1,this._debugFreezeFrame=!1,this._debugCascadeColors=!1,this._debugLightFrustum=void 0,this._debugCameraFrustum=void 0,this._debugCascadeFrustums=new Array(this._numberOfCascades),this._debugShadowViewCommand=void 0,this._usesDepthTexture=t.depthTexture,this._isPointLight&&(this._usesDepthTexture=!1),this._primitiveRenderState=void 0,this._terrainRenderState=void 0,this._pointRenderState=void 0,re(this),this._clearCommand=new P["a"]({depth:1,color:new d["a"]}),this._clearPassState=new I["a"](t),this._size=Object(l["a"])(e.size,2048),this.size=this._size}function te(e){this.camera=new Ee,this.passState=new I["a"](e),this.framebuffer=void 0,this.textureOffsets=void 0,this.commandList=[],this.cullingVolume=void 0}function ae(e,t){return V["a"].fromCache({cull:{enabled:!0,face:Y["a"].BACK},depthTest:{enabled:!0},colorMask:{red:e,green:e,blue:e,alpha:e},depthMask:!0,polygonOffset:{enabled:t.polygonOffset,factor:t.polygonOffsetFactor,units:t.polygonOffsetUnits}})}function re(e){var t=!e._usesDepthTexture;e._primitiveRenderState=ae(t,e._primitiveBias),e._terrainRenderState=ae(t,e._terrainBias),e._pointRenderState=ae(t,e._pointBias)}function ie(e){for(var t=e._passes.length,a=0;a<t;++a){var r=e._passes[a],i=r.framebuffer;Object(f["a"])(i)&&!i.isDestroyed()&&i.destroy(),r.framebuffer=void 0}e._depthAttachment=e._depthAttachment&&e._depthAttachment.destroy(),e._colorAttachment=e._colorAttachment&&e._colorAttachment.destroy()}function ne(){return new H["a"]({wrapS:G["a"].CLAMP_TO_EDGE,wrapT:G["a"].CLAMP_TO_EDGE,minificationFilter:k["a"].NEAREST,magnificationFilter:U["a"].NEAREST})}function se(e,t){for(var a=new W["a"]({context:t,width:e._textureSize.x,height:e._textureSize.y,format:R["a"].DEPTH_COMPONENT16}),r=new B["a"]({context:t,width:e._textureSize.x,height:e._textureSize.y,pixelFormat:O["a"].RGBA,pixelDatatype:j["a"].UNSIGNED_BYTE,sampler:ne()}),i=new F["a"]({context:t,depthRenderbuffer:a,colorTextures:[r],destroyAttachments:!1}),n=e._passes.length,s=0;s<n;++s){var o=e._passes[s];o.framebuffer=i,o.passState.framebuffer=i}e._shadowMapTexture=r,e._depthAttachment=a,e._colorAttachment=r}function oe(e,t){for(var a=new B["a"]({context:t,width:e._textureSize.x,height:e._textureSize.y,pixelFormat:O["a"].DEPTH_STENCIL,pixelDatatype:j["a"].UNSIGNED_INT_24_8,sampler:ne()}),r=new F["a"]({context:t,depthStencilTexture:a,destroyAttachments:!1}),i=e._passes.length,n=0;n<i;++n){var s=e._passes[n];s.framebuffer=r,s.passState.framebuffer=r}e._shadowMapTexture=a,e._depthAttachment=a}function he(e,t){for(var a=new W["a"]({context:t,width:e._textureSize.x,height:e._textureSize.y,format:R["a"].DEPTH_COMPONENT16}),r=new T["a"]({context:t,width:e._textureSize.x,height:e._textureSize.y,pixelFormat:O["a"].RGBA,pixelDatatype:j["a"].UNSIGNED_BYTE,sampler:ne()}),i=[r.negativeX,r.negativeY,r.negativeZ,r.positiveX,r.positiveY,r.positiveZ],n=0;n<6;++n){var s=new F["a"]({context:t,depthRenderbuffer:a,colorTextures:[i[n]],destroyAttachments:!1}),o=e._passes[n];o.framebuffer=s,o.passState.framebuffer=s}e._shadowMapTexture=r,e._depthAttachment=a,e._colorAttachment=r}function ue(e,t){e._isPointLight?he(e,t):e._usesDepthTexture?oe(e,t):se(e,t)}function ce(e,t){e._usesDepthTexture&&e._passes[0].framebuffer.status!==D["a"].FRAMEBUFFER_COMPLETE&&(e._usesDepthTexture=!1,re(e),ie(e),ue(e,t))}function de(e,t){Object(f["a"])(e._passes[0].framebuffer)&&e._shadowMapTexture.width===e._textureSize.x||(ie(e),ue(e,t),ce(e,t),me(e,t))}function me(e,t,a){a=Object(l["a"])(a,0),(e._isPointLight||0===a)&&(e._clearCommand.framebuffer=e._passes[a].framebuffer,e._clearCommand.execute(t,e._clearPassState))}function _e(e,t){e._size=t;var a=e._passes,i=a.length,n=e._textureSize;if(e._isPointLight){t=L["a"].maximumCubeMapSize>=t?t:L["a"].maximumCubeMapSize,n.x=t,n.y=t;var s=new r["a"](0,0,t,t);a[0].passState.viewport=s,a[1].passState.viewport=s,a[2].passState.viewport=s,a[3].passState.viewport=s,a[4].passState.viewport=s,a[5].passState.viewport=s}else 1===i?(t=L["a"].maximumTextureSize>=t?t:L["a"].maximumTextureSize,n.x=t,n.y=t,a[0].passState.viewport=new r["a"](0,0,t,t)):4===i&&(t=L["a"].maximumTextureSize>=2*t?t:L["a"].maximumTextureSize/2,n.x=2*t,n.y=2*t,a[0].passState.viewport=new r["a"](0,0,t,t),a[1].passState.viewport=new r["a"](t,0,t,t),a[2].passState.viewport=new r["a"](0,t,t,t),a[3].passState.viewport=new r["a"](t,t,t,t));e._clearPassState.viewport=new r["a"](0,0,n.x,n.y);for(var o=0;o<i;++o){var h=a[o],u=h.passState.viewport,c=u.x/n.x,d=u.y/n.y,m=u.width/n.x,_=u.height/n.y;h.textureOffsets=new b["a"](m,0,0,c,0,_,0,d,0,0,1,0,0,0,0,1)}}ee.MAXIMUM_DISTANCE=2e4,ee.prototype.debugCreateRenderStates=function(){re(this)},Object(w["a"])(ee.prototype,{enabled:{get:function(){return this._enabled},set:function(e){this.dirty=this._enabled!==e,this._enabled=e}},normalOffset:{get:function(){return this._normalOffset},set:function(e){this.dirty=this._normalOffset!==e,this._normalOffset=e,this._terrainBias.normalOffset=e,this._primitiveBias.normalOffset=e,this._pointBias.normalOffset=e}},softShadows:{get:function(){return this._softShadows},set:function(e){this.dirty=this._softShadows!==e,this._softShadows=e}},size:{get:function(){return this._size},set:function(e){_e(this,e)}},outOfView:{get:function(){return this._outOfView}},shadowMapCullingVolume:{get:function(){return this._shadowMapCullingVolume}},passes:{get:function(){return this._passes}},isPointLight:{get:function(){return this._isPointLight}},debugCascadeColors:{get:function(){return this._debugCascadeColors},set:function(e){this.dirty=this._debugCascadeColors!==e,this._debugCascadeColors=e}}});var pe=new r["a"];function le(e,t){var a;a=e._isPointLight?"uniform samplerCube shadowMap_textureCube; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n    vec2 uv = v_textureCoordinates; \n    vec3 dir; \n \n    if (uv.y < 0.5) \n    { \n        if (uv.x < 0.333) \n        { \n            dir.x = -1.0; \n            dir.y = uv.x * 6.0 - 1.0; \n            dir.z = uv.y * 4.0 - 1.0; \n        } \n        else if (uv.x < 0.666) \n        { \n            dir.y = -1.0; \n            dir.x = uv.x * 6.0 - 3.0; \n            dir.z = uv.y * 4.0 - 1.0; \n        } \n        else \n        { \n            dir.z = -1.0; \n            dir.x = uv.x * 6.0 - 5.0; \n            dir.y = uv.y * 4.0 - 1.0; \n        } \n    } \n    else \n    { \n        if (uv.x < 0.333) \n        { \n            dir.x = 1.0; \n            dir.y = uv.x * 6.0 - 1.0; \n            dir.z = uv.y * 4.0 - 3.0; \n        } \n        else if (uv.x < 0.666) \n        { \n            dir.y = 1.0; \n            dir.x = uv.x * 6.0 - 3.0; \n            dir.z = uv.y * 4.0 - 3.0; \n        } \n        else \n        { \n            dir.z = 1.0; \n            dir.x = uv.x * 6.0 - 5.0; \n            dir.y = uv.y * 4.0 - 3.0; \n        } \n    } \n \n    float shadow = czm_unpackDepth(textureCube(shadowMap_textureCube, dir)); \n    gl_FragColor = vec4(vec3(shadow), 1.0); \n} \n":"uniform sampler2D shadowMap_texture; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n"+(e._usesDepthTexture?"    float shadow = texture2D(shadowMap_texture, v_textureCoordinates).r; \n":"    float shadow = czm_unpackDepth(texture2D(shadowMap_texture, v_textureCoordinates)); \n")+"    gl_FragColor = vec4(vec3(shadow), 1.0); \n} \n";var r=t.createViewportQuadCommand(a,{uniformMap:{shadowMap_texture:function(){return e._shadowMapTexture},shadowMap_textureCube:function(){return e._shadowMapTexture}}});return r.pass=z["a"].OVERLAY,r}function fe(e,t){var a=t.context,i=t.context.drawingBufferWidth,n=t.context.drawingBufferHeight,s=.3*Math.min(i,n),o=pe;o.x=i-s,o.y=0,o.width=s,o.height=s;var h=e._debugShadowViewCommand;Object(f["a"])(h)||(h=le(e,a),e._debugShadowViewCommand=h),Object(f["a"])(h.renderState)&&r["a"].equals(h.renderState.viewport,o)||(h.renderState=V["a"].fromCache({viewport:r["a"].clone(o)})),t.commandList.push(e._debugShadowViewCommand)}var we=new Array(8);we[0]=new h["a"](-1,-1,-1,1),we[1]=new h["a"](1,-1,-1,1),we[2]=new h["a"](1,1,-1,1),we[3]=new h["a"](-1,1,-1,1),we[4]=new h["a"](-1,-1,1,1),we[5]=new h["a"](1,-1,1,1),we[6]=new h["a"](1,1,1,1),we[7]=new h["a"](-1,1,1,1);for(var ge=new b["a"],Ce=new Array(8),ve=0;ve<8;++ve)Ce[ve]=new h["a"];function Se(e,t){var a=new v["a"]({geometry:new n["a"]({minimum:new o["a"](-.5,-.5,-.5),maximum:new o["a"](.5,.5,.5)}),attributes:{color:m["a"].fromColor(t)}}),r=new v["a"]({geometry:new A["a"]({radius:.5}),attributes:{color:m["a"].fromColor(t)}});return new Q["a"]({geometryInstances:[a,r],appearance:new K["a"]({translucent:!1,flat:!0}),asynchronous:!1,modelMatrix:e})}var xe=[d["a"].RED,d["a"].GREEN,d["a"].BLUE,d["a"].MAGENTA],be=new o["a"];function ye(e,t){fe(e,t);var a=e.debugFreezeFrame&&!e._debugFreezeFrame;if(e._debugFreezeFrame=e.debugFreezeFrame,e.debugFreezeFrame&&(a&&(e._debugCameraFrustum=e._debugCameraFrustum&&e._debugCameraFrustum.destroy(),e._debugCameraFrustum=new X["a"]({camera:e._sceneCamera,color:d["a"].CYAN,updateOnChange:!1})),e._debugCameraFrustum.update(t)),e._cascadesEnabled){if(e.debugFreezeFrame){a&&(e._debugLightFrustum=e._debugLightFrustum&&e._debugLightFrustum.destroy(),e._debugLightFrustum=new X["a"]({camera:e._shadowMapCamera,color:d["a"].YELLOW,updateOnChange:!1})),e._debugLightFrustum.update(t);for(var r=0;r<e._numberOfCascades;++r)a&&(e._debugCascadeFrustums[r]=e._debugCascadeFrustums[r]&&e._debugCascadeFrustums[r].destroy(),e._debugCascadeFrustums[r]=new X["a"]({camera:e._passes[r].camera,color:xe[r],updateOnChange:!1})),e._debugCascadeFrustums[r].update(t)}}else if(e._isPointLight){if(!Object(f["a"])(e._debugLightFrustum)||e._needsUpdate){var i=e._shadowMapCamera.positionWC,n=M["a"].IDENTITY,s=2*e._pointLightRadius,h=o["a"].fromElements(s,s,s,be),u=b["a"].fromTranslationQuaternionRotationScale(i,n,h,ge);e._debugLightFrustum=e._debugLightFrustum&&e._debugLightFrustum.destroy(),e._debugLightFrustum=Se(u,d["a"].YELLOW)}e._debugLightFrustum.update(t)}else Object(f["a"])(e._debugLightFrustum)&&!e._needsUpdate||(e._debugLightFrustum=new X["a"]({camera:e._shadowMapCamera,color:d["a"].YELLOW,updateOnChange:!1})),e._debugLightFrustum.update(t)}function Ee(){this.viewMatrix=new b["a"],this.inverseViewMatrix=new b["a"],this.frustum=void 0,this.positionCartographic=new u["a"],this.positionWC=new o["a"],this.directionWC=o["a"].clone(o["a"].UNIT_Z),this.upWC=o["a"].clone(o["a"].UNIT_Y),this.rightWC=o["a"].clone(o["a"].UNIT_X),this.viewProjectionMatrix=new b["a"]}Ee.prototype.clone=function(e){b["a"].clone(e.viewMatrix,this.viewMatrix),b["a"].clone(e.inverseViewMatrix,this.inverseViewMatrix),this.frustum=e.frustum.clone(this.frustum),u["a"].clone(e.positionCartographic,this.positionCartographic),o["a"].clone(e.positionWC,this.positionWC),o["a"].clone(e.directionWC,this.directionWC),o["a"].clone(e.upWC,this.upWC),o["a"].clone(e.rightWC,this.rightWC)};var Oe=new b["a"](.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);Ee.prototype.getViewProjection=function(){var e=this.viewMatrix,t=this.frustum.projectionMatrix;return b["a"].multiply(t,e,this.viewProjectionMatrix),b["a"].multiply(Oe,this.viewProjectionMatrix,this.viewProjectionMatrix),this.viewProjectionMatrix};var Me=new Array(5),Ae=new E["a"],De=new Array(4),Pe=new o["a"],Le=new o["a"];function Te(e,t){var a,r=e._shadowMapCamera,i=e._sceneCamera,n=i.frustum.near,s=i.frustum.far,u=e._numberOfCascades,c=s-n,d=s/n,m=.9,_=!1;t.shadowState.closestObjectSize<200&&(_=!0,m=.9);var p=De,l=Me;for(l[0]=n,l[u]=s,a=0;a<u;++a){var f=(a+1)/u,w=n*Math.pow(d,f),g=n+c*f,C=x["a"].lerp(g,w,m);l[a+1]=C,p[a]=C-l[a]}if(_){for(a=0;a<u;++a)p[a]=Math.min(p[a],e._maximumCascadeDistances[a]);var v=l[0];for(a=0;a<u-1;++a)v+=p[a],l[a+1]=v}h["a"].unpack(l,0,e._cascadeSplits[0]),h["a"].unpack(l,1,e._cascadeSplits[1]),h["a"].unpack(p,0,e._cascadeDistances);var S=r.frustum,y=S.left,E=S.right,O=S.bottom,M=S.top,A=S.near,D=S.far,P=r.positionWC,L=r.directionWC,T=r.upWC,N=i.frustum.clone(Ae),F=r.getViewProjection();for(a=0;a<u;++a){N.near=l[a],N.far=l[a+1];for(var z=b["a"].multiply(N.projectionMatrix,i.viewMatrix,ge),I=b["a"].inverse(z,ge),j=b["a"].multiply(F,I,ge),W=o["a"].fromElements(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Pe),R=o["a"].fromElements(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,Le),V=0;V<8;++V){var H=h["a"].clone(we[V],Ce[V]);b["a"].multiplyByVector(j,H,H),o["a"].divideByScalar(H,H.w,H),o["a"].minimumByComponent(H,W,W),o["a"].maximumByComponent(H,R,R)}W.x=Math.max(W.x,0),W.y=Math.max(W.y,0),W.z=0,R.x=Math.min(R.x,1),R.y=Math.min(R.y,1),R.z=Math.min(R.z,1);var B=e._passes[a],U=B.camera;U.clone(r);var k=U.frustum;k.left=y+W.x*(E-y),k.right=y+R.x*(E-y),k.bottom=O+W.y*(M-O),k.top=O+R.y*(M-O),k.near=A+W.z*(D-A),k.far=A+R.z*(D-A),B.cullingVolume=U.frustum.computeCullingVolume(P,L,T);var G=e._cascadeMatrices[a];b["a"].multiply(U.getViewProjection(),i.inverseViewMatrix,G),b["a"].multiply(B.textureOffsets,G,G)}}var Ne=new b["a"],Fe=new o["a"],ze=new o["a"],Ie=new o["a"];function je(e,t){var a=e._shadowMapCamera,r=e._sceneCamera,i=b["a"].multiply(r.frustum.projectionMatrix,r.viewMatrix,ge),n=b["a"].inverse(i,ge),s=a.directionWC,u=r.directionWC,c=o["a"].cross(s,u,Fe);u=o["a"].cross(c,s,ze),o["a"].normalize(u,u),o["a"].normalize(c,c);for(var d=o["a"].fromElements(0,0,0,Ie),m=b["a"].computeView(d,s,u,c,Ne),_=b["a"].multiply(m,n,ge),p=o["a"].fromElements(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Pe),l=o["a"].fromElements(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,Le),f=0;f<8;++f){var w=h["a"].clone(we[f],Ce[f]);b["a"].multiplyByVector(_,w,w),o["a"].divideByScalar(w,w.w,w),o["a"].minimumByComponent(w,p,p),o["a"].maximumByComponent(w,l,l)}l.z+=1e3,p.z-=10;var g=Ie;g.x=-.5*(p.x+l.x),g.y=-.5*(p.y+l.y),g.z=-l.z;var C=b["a"].fromTranslation(g,ge);m=b["a"].multiply(C,m,m);var v=.5*(l.x-p.x),S=.5*(l.y-p.y),x=l.z-p.z,y=a.frustum;y.left=-v,y.right=v,y.bottom=-S,y.top=S,y.near=.01,y.far=x,b["a"].clone(m,a.viewMatrix),b["a"].inverse(m,a.inverseViewMatrix),b["a"].getTranslation(a.inverseViewMatrix,a.positionWC),t.mapProjection.ellipsoid.cartesianToCartographic(a.positionWC,a.positionCartographic),o["a"].clone(s,a.directionWC),o["a"].clone(u,a.upWC),o["a"].clone(c,a.rightWC)}var We=[new o["a"](-1,0,0),new o["a"](0,-1,0),new o["a"](0,0,-1),new o["a"](1,0,0),new o["a"](0,1,0),new o["a"](0,0,1)],Re=[new o["a"](0,-1,0),new o["a"](0,0,-1),new o["a"](0,-1,0),new o["a"](0,-1,0),new o["a"](0,0,1),new o["a"](0,-1,0)],Ve=[new o["a"](0,0,1),new o["a"](1,0,0),new o["a"](-1,0,0),new o["a"](0,0,-1),new o["a"](1,0,0),new o["a"](1,0,0)];function He(e,t){var a=new E["a"];a.fov=x["a"].PI_OVER_TWO,a.near=1,a.far=e._pointLightRadius,a.aspectRatio=1;for(var r=0;r<6;++r){var i=e._passes[r].camera;i.positionWC=e._shadowMapCamera.positionWC,i.positionCartographic=t.mapProjection.ellipsoid.cartesianToCartographic(i.positionWC,i.positionCartographic),i.directionWC=We[r],i.upWC=Re[r],i.rightWC=Ve[r],b["a"].computeView(i.positionWC,i.directionWC,i.upWC,i.rightWC,i.viewMatrix),b["a"].inverse(i.viewMatrix,i.inverseViewMatrix),i.frustum=a}}var Be=new o["a"],Ue=new o["a"],ke=new i["a"],Ge=ke.center;function qe(e,t){var a=e._sceneCamera,r=e._shadowMapCamera,n=ke;if(e._cascadesEnabled){if(a.frustum.near>=e.maximumDistance)return e._outOfView=!0,void(e._needsUpdate=!1);var s=t.mapProjection.ellipsoid.geodeticSurfaceNormal(a.positionWC,Be),h=o["a"].negate(r.directionWC,Ue),u=o["a"].dot(s,h),c=x["a"].clamp(u/.1,0,1);if(e._darkness=x["a"].lerp(1,e.darkness,c),u<0)return e._outOfView=!0,void(e._needsUpdate=!1);e._needsUpdate=!0,e._outOfView=!1}else if(e._isPointLight)n.center=r.positionWC,n.radius=e._pointLightRadius,e._outOfView=t.cullingVolume.computeVisibility(n)===S["a"].OUTSIDE,e._needsUpdate=!e._outOfView&&!e._boundingSphere.equals(n),i["a"].clone(n,e._boundingSphere);else{var d=r.frustum.far/2,m=o["a"].add(r.positionWC,o["a"].multiplyByScalar(r.directionWC,d,Ge),Ge);n.center=m,n.radius=d,e._outOfView=t.cullingVolume.computeVisibility(n)===S["a"].OUTSIDE,e._needsUpdate=!e._outOfView&&!e._boundingSphere.equals(n),i["a"].clone(n,e._boundingSphere)}}function Ye(e,t){var a=t.camera,r=e._lightCamera,i=e._sceneCamera,n=e._shadowMapCamera;e._cascadesEnabled?o["a"].clone(r.directionWC,n.directionWC):e._isPointLight?o["a"].clone(r.positionWC,n.positionWC):n.clone(r);var s,h,u=e._lightDirectionEC;b["a"].multiplyByPointAsVector(a.viewMatrix,n.directionWC,u),o["a"].normalize(u,u),o["a"].negate(u,u),b["a"].multiplyByPoint(a.viewMatrix,n.positionWC,e._lightPositionEC),e._lightPositionEC.w=e._pointLightRadius,e._fitNearFar?(s=Math.min(t.shadowState.nearPlane,e.maximumDistance),h=Math.min(t.shadowState.farPlane,e.maximumDistance+1)):(s=a.frustum.near,h=e.maximumDistance),e._sceneCamera=q["a"].clone(a,i),a.frustum.clone(e._sceneCamera.frustum),e._sceneCamera.frustum.near=s,e._sceneCamera.frustum.far=h,e._distance=h-s,qe(e,t),!e._outOfViewPrevious&&e._outOfView&&(e._needsUpdate=!0),e._outOfViewPrevious=e._outOfView}ee.prototype.update=function(e){if(Ye(this,e),this._needsUpdate)if(de(this,e.context),this._isPointLight&&He(this,e),this._cascadesEnabled&&(je(this,e),this._numberOfCascades>1&&Te(this,e)),this._isPointLight)this._shadowMapCullingVolume=p["a"].fromBoundingSphere(this._boundingSphere);else{var t=this._shadowMapCamera,a=t.positionWC,r=t.directionWC,i=t.upWC;this._shadowMapCullingVolume=t.frustum.computeCullingVolume(a,r,i),1===this._passes.length&&this._passes[0].camera.clone(t)}if(1===this._passes.length){var n=this._sceneCamera.inverseViewMatrix;b["a"].multiply(this._shadowMapCamera.getViewProjection(),n,this._shadowMapMatrix)}this.debugShow&&ye(this,e)},ee.prototype.updatePass=function(e,t){me(this,e,t)};var Xe=new s["a"];function Ke(e,t,a){var r=e._isPointLight?e._pointBias:a?e._terrainBias:e._primitiveBias,i={shadowMap_texture:function(){return e._shadowMapTexture},shadowMap_textureCube:function(){return e._shadowMapTexture},shadowMap_matrix:function(){return e._shadowMapMatrix},shadowMap_cascadeSplits:function(){return e._cascadeSplits},shadowMap_cascadeMatrices:function(){return e._cascadeMatrices},shadowMap_lightDirectionEC:function(){return e._lightDirectionEC},shadowMap_lightPositionEC:function(){return e._lightPositionEC},shadowMap_cascadeDistances:function(){return e._cascadeDistances},shadowMap_texelSizeDepthBiasAndNormalShadingSmooth:function(){var t=Xe;return t.x=1/e._textureSize.x,t.y=1/e._textureSize.y,h["a"].fromElements(t.x,t.y,r.depthBias,r.normalShadingSmooth,this.combinedUniforms1)},shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness:function(){return h["a"].fromElements(r.normalOffsetScale,e._distance,e.maximumDistance,e._darkness,this.combinedUniforms2)},combinedUniforms1:new h["a"],combinedUniforms2:new h["a"]};return Object(_["a"])(t,i,!1)}function Qe(e,t,a,r,i,n){var s,o,h;if(Object(f["a"])(n)&&(s=n.shaderProgram,o=n.renderState,h=n.uniformMap),n=N["a"].shallowClone(a,n),n.castShadows=!0,n.receiveShadows=!1,!Object(f["a"])(s)||i!==a.shaderProgram.id||t){var u=a.shaderProgram,d=a.pass===z["a"].GLOBE,m=a.pass!==z["a"].TRANSLUCENT,_=e._isPointLight,p=e._usesDepthTexture,l=$.getShadowCastShaderKeyword(_,d,p,m);if(s=r.shaderCache.getDerivedShaderProgram(u,l),!Object(f["a"])(s)){var w=u.vertexShaderSource,g=u.fragmentShaderSource,C=$.createShadowCastVertexShader(w,_,d),v=$.createShadowCastFragmentShader(g,_,p,m);s=r.shaderCache.createDerivedShaderProgram(u,l,{vertexShaderSource:C,fragmentShaderSource:v,attributeLocations:u._attributeLocations})}o=e._primitiveRenderState,_?o=e._pointRenderState:d&&(o=e._terrainRenderState);var S=a.renderState.cull.enabled;S||(o=Object(c["a"])(o,!1),o.cull=Object(c["a"])(o.cull,!1),o.cull.enabled=!1,o=V["a"].fromCache(o)),h=Ke(e,a.uniformMap,d)}return n.shaderProgram=s,n.renderState=o,n.uniformMap=h,n}ee.createReceiveDerivedCommand=function(e,t,a,r,i){Object(f["a"])(i)||(i={});var n=e.length>0,s=t.shaderProgram,o=s.vertexShaderSource,h=s.fragmentShaderSource,u=t.pass===z["a"].GLOBE,c=!1;if(u&&(c=t.owner.data.renderedMesh.encoding.hasVertexNormals),t.receiveShadows&&n){var d,m;Object(f["a"])(i.receiveCommand)&&(d=i.receiveCommand.shaderProgram,m=i.receiveCommand.uniformMap),i.receiveCommand=N["a"].shallowClone(t,i.receiveCommand),i.castShadows=!1,i.receiveShadows=!0;var _=i.receiveShaderCastShadows!==t.castShadows,p=i.receiveShaderProgramId!==t.shaderProgram.id;if(!Object(f["a"])(d)||p||a||_){var l=$.getShadowReceiveShaderKeyword(e[0],t.castShadows,u,c);if(d=r.shaderCache.getDerivedShaderProgram(s,l),!Object(f["a"])(d)){var w=$.createShadowReceiveVertexShader(o,u,c),g=$.createShadowReceiveFragmentShader(h,e[0],t.castShadows,u,c);d=r.shaderCache.createDerivedShaderProgram(s,l,{vertexShaderSource:w,fragmentShaderSource:g,attributeLocations:s._attributeLocations})}m=Ke(e[0],t.uniformMap,u)}i.receiveCommand.shaderProgram=d,i.receiveCommand.uniformMap=m,i.receiveShaderProgramId=t.shaderProgram.id,i.receiveShaderCastShadows=t.castShadows}return i},ee.createCastDerivedCommand=function(e,t,a,r,i){if(Object(f["a"])(i)||(i={}),t.castShadows){var n=i.castCommands;Object(f["a"])(n)||(n=i.castCommands=[]);var s=i.castShaderProgramId,o=e.length;n.length=o;for(var h=0;h<o;++h)n[h]=Qe(e[h],a,t,r,s,n[h]);i.castShaderProgramId=t.shaderProgram.id}return i},ee.prototype.isDestroyed=function(){return!1},ee.prototype.destroy=function(){ie(this),this._debugLightFrustum=this._debugLightFrustum&&this._debugLightFrustum.destroy(),this._debugCameraFrustum=this._debugCameraFrustum&&this._debugCameraFrustum.destroy(),this._debugShadowViewCommand=this._debugShadowViewCommand&&this._debugShadowViewCommand.shaderProgram&&this._debugShadowViewCommand.shaderProgram.destroy();for(var e=0;e<this._numberOfCascades;++e)this._debugCascadeFrustums[e]=this._debugCascadeFrustums[e]&&this._debugCascadeFrustums[e].destroy();return Object(g["a"])(this)};t["a"]=ee},a098:function(e,t,a){"use strict";var r=a("b482"),i=a("be18"),n=a("535a"),s=a("2f63"),o=a("7d62"),h=a("c1e2"),u=a("52f0"),c=a("0541"),d=a("8b68"),m=a("9ab9"),_=a("a894"),p=a("b0b5"),l=a("6dc0"),f=a("e90c"),w=a("5770"),g=a("7c5e"),C=a("8167"),v=a("688e"),S=a("b7c8"),x=a("a307");function b(e){this.sources=e.sources,this._sources=void 0,this.show=Object(n["a"])(e.show,!0),this._command=new _["a"]({modelMatrix:u["a"].clone(u["a"].IDENTITY),owner:this}),this._cubeMap=void 0,this._attributeLocations=void 0,this._useHdr=void 0}b.prototype.update=function(e,t){var a=this;if(this.show&&(e.mode===x["a"].SCENE3D||e.mode===x["a"].MORPHING)&&e.passes.render){var n=e.context;if(this._sources!==this.sources){this._sources=this.sources;var o=this.sources;"string"===typeof o.positiveX?Object(p["a"])(n,this._sources).then((function(e){a._cubeMap=a._cubeMap&&a._cubeMap.destroy(),a._cubeMap=e})):(this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),this._cubeMap=new m["a"]({context:n,source:o}))}var u=this._command;if(!Object(s["a"])(u.vertexArray)){u.uniformMap={u_cubeMap:function(){return a._cubeMap}};var _=r["a"].createGeometry(r["a"].fromDimensions({dimensions:new i["a"](2,2,2),vertexFormat:c["a"].POSITION_ONLY})),b=this._attributeLocations=h["a"].createAttributeLocations(_);u.vertexArray=g["a"].fromGeometry({context:n,geometry:_,attributeLocations:b,bufferUsage:d["a"].STATIC_DRAW}),u.renderState=l["a"].fromCache({blending:S["a"].ALPHA_BLEND})}if(!Object(s["a"])(u.shaderProgram)||this._useHdr!==t){var y=new w["a"]({defines:[t?"HDR":""],sources:[C["a"]]});u.shaderProgram=f["a"].fromCache({context:n,vertexShaderSource:v["a"],fragmentShaderSource:y,attributeLocations:this._attributeLocations}),this._useHdr=t}if(Object(s["a"])(this._cubeMap))return u}},b.prototype.isDestroyed=function(){return!1},b.prototype.destroy=function(){var e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy(),this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),Object(o["a"])(this)},t["a"]=b},a12c:function(e,t,a){"use strict";var r=a("be18"),i=a("a561"),n=a("535a"),s=a("2f63"),o=a("9f1d"),h=a("7d62"),u=a("c52f"),c=a("6cae"),d=a("c1e2"),m=a("93da"),_=a("0541"),p=a("8b68"),l=a("a894"),f=a("6dc0"),w=a("e90c"),g=a("5770"),C=a("7c5e"),v=a("ef10"),S=a("2a08"),x=a("b7c8"),b=a("29ab"),y=a("a307");function E(e){e=Object(n["a"])(e,u["a"].WGS84),this.show=!0,this._ellipsoid=e,this._command=new l["a"]({owner:this}),this._spSkyFromSpace=void 0,this._spSkyFromAtmosphere=void 0,this._spSkyFromSpaceColorCorrect=void 0,this._spSkyFromAtmosphereColorCorrect=void 0,this.hueShift=0,this.saturationShift=0,this.brightnessShift=0,this._hueSaturationBrightness=new r["a"];var t=new i["a"];t.w=0,t.y=r["a"].maximumComponent(r["a"].multiplyByScalar(e.radii,1.025,new r["a"])),t.z=e.maximumRadius,this._cameraAndRadiiAndDynamicAtmosphereColor=t;var a=this;this._command.uniformMap={u_cameraAndRadiiAndDynamicAtmosphereColor:function(){return a._cameraAndRadiiAndDynamicAtmosphereColor},u_hsbShift:function(){return a._hueSaturationBrightness.x=a.hueShift,a._hueSaturationBrightness.y=a.saturationShift,a._hueSaturationBrightness.z=a.brightnessShift,a._hueSaturationBrightness}}}function O(e){return!(m["a"].equalsEpsilon(e.hueShift,0,m["a"].EPSILON7)&&m["a"].equalsEpsilon(e.saturationShift,0,m["a"].EPSILON7)&&m["a"].equalsEpsilon(e.brightnessShift,0,m["a"].EPSILON7))}Object(o["a"])(E.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}}),E.prototype.setDynamicAtmosphereColor=function(e){this._cameraAndRadiiAndDynamicAtmosphereColor.w=e?1:0},E.prototype.update=function(e){if(this.show){var t=e.mode;if((t===y["a"].SCENE3D||t===y["a"].MORPHING)&&e.passes.render){var a=this._command;if(!Object(s["a"])(a.vertexArray)){var i=e.context,n=c["a"].createGeometry(new c["a"]({radii:r["a"].multiplyByScalar(this._ellipsoid.radii,1.025,new r["a"]),slicePartitions:256,stackPartitions:256,vertexFormat:_["a"].POSITION_ONLY}));a.vertexArray=C["a"].fromGeometry({context:i,geometry:n,attributeLocations:d["a"].createAttributeLocations(n),bufferUsage:p["a"].STATIC_DRAW}),a.renderState=f["a"].fromCache({cull:{enabled:!0,face:b["a"].FRONT},blending:x["a"].ALPHA_BLEND,depthMask:!1});var o=new g["a"]({defines:["SKY_FROM_SPACE"],sources:[S["a"]]});this._spSkyFromSpace=w["a"].fromCache({context:i,vertexShaderSource:o,fragmentShaderSource:v["a"]}),o=new g["a"]({defines:["SKY_FROM_ATMOSPHERE"],sources:[S["a"]]}),this._spSkyFromAtmosphere=w["a"].fromCache({context:i,vertexShaderSource:o,fragmentShaderSource:v["a"]})}var h=O(this);if(h&&(!Object(s["a"])(this._spSkyFromSpaceColorCorrect)||!Object(s["a"])(this._spSkyFromAtmosphereColorCorrect))){var u=e.context,m=new g["a"]({defines:["SKY_FROM_SPACE"],sources:[S["a"]]}),l=new g["a"]({defines:["COLOR_CORRECT"],sources:[v["a"]]});this._spSkyFromSpaceColorCorrect=w["a"].fromCache({context:u,vertexShaderSource:m,fragmentShaderSource:l}),m=new g["a"]({defines:["SKY_FROM_ATMOSPHERE"],sources:[S["a"]]}),this._spSkyFromAtmosphereColorCorrect=w["a"].fromCache({context:u,vertexShaderSource:m,fragmentShaderSource:l})}var E=e.camera.positionWC,M=r["a"].magnitude(E);return this._cameraAndRadiiAndDynamicAtmosphereColor.x=M,M>this._cameraAndRadiiAndDynamicAtmosphereColor.y?a.shaderProgram=h?this._spSkyFromSpaceColorCorrect:this._spSkyFromSpace:a.shaderProgram=h?this._spSkyFromAtmosphereColorCorrect:this._spSkyFromAtmosphere,a}}},E.prototype.isDestroyed=function(){return!1},E.prototype.destroy=function(){var e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),this._spSkyFromSpace=this._spSkyFromSpace&&this._spSkyFromSpace.destroy(),this._spSkyFromAtmosphere=this._spSkyFromAtmosphere&&this._spSkyFromAtmosphere.destroy(),this._spSkyFromSpaceColorCorrect=this._spSkyFromSpaceColorCorrect&&this._spSkyFromSpaceColorCorrect.destroy(),this._spSkyFromAtmosphereColorCorrect=this._spSkyFromAtmosphereColorCorrect&&this._spSkyFromAtmosphereColorCorrect.destroy(),Object(h["a"])(this)},t["a"]=E},b85d:function(e,t,a){"use strict";var r=a("8dfe"),i=a("535a"),n=a("9f1d"),s=a("21d7"),o=a("5d5c"),h=a("eace"),u=a("d4ed"),c=a("283e"),d=a("a89b"),m=a("a58e"),_=a("64ac");function p(e){e=Object(i["a"])(e,i["a"].EMPTY_OBJECT);var t=u["a"].createIfNeeded(e.url),a=Object(i["a"])(e.rectangle,h["a"].MAX_VALUE),n=new o["a"]({rectangle:a,numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1,ellipsoid:e.ellipsoid});this._tilingScheme=n,this._resource=t,this._image=void 0,this._texture=void 0,this._tileWidth=0,this._tileHeight=0,this._errorEvent=new s["a"],this._ready=!1,this._readyPromise=m["a"].defer();var p=e.credit;"string"===typeof p&&(p=new r["a"](p)),this._credit=p;var l,f=this;function w(e){f._image=e,f._tileWidth=e.width,f._tileHeight=e.height,f._ready=!0,f._readyPromise.resolve(!0),d["a"].handleSuccess(f._errorEvent)}function g(e){var a="Failed to load image "+t.url+".";l=d["a"].handleError(l,f,f._errorEvent,a,0,0,0,C,e),f._readyPromise.reject(new c["a"](a))}function C(){_["a"].loadImage(null,t).then(w).otherwise(g)}C()}Object(n["a"])(p.prototype,{url:{get:function(){return this._resource.url}},proxy:{get:function(){return this._resource.proxy}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return 0}},minimumLevel:{get:function(){return 0}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!0}}}),p.prototype.getTileCredits=function(e,t,a){},p.prototype.requestImage=function(e,t,a,r){return this._image},p.prototype.pickFeatures=function(e,t,a,r,i){},t["a"]=p},c86b:function(e,t,a){"use strict";var r=a("0e25"),i={DISABLED:0,ENABLED:1,CAST_ONLY:2,RECEIVE_ONLY:3,NUMBER_OF_SHADOW_MODES:4,castShadows:function(e){return e===i.ENABLED||e===i.CAST_ONLY},receiveShadows:function(e){return e===i.ENABLED||e===i.RECEIVE_ONLY},fromCastReceive:function(e,t){return e&&t?i.ENABLED:e?i.CAST_ONLY:t?i.RECEIVE_ONLY:i.DISABLED}};t["a"]=Object(r["a"])(i)}}]);