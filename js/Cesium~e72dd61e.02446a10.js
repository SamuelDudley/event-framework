(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Cesium~e72dd61e"],{"9dbf":function(t,a,i){"use strict";var o=i("cef5"),e=i("670c"),n=i("be18"),r=i("a561"),s=i("bef8"),c=i("535a"),h=i("2f63"),u=i("9f1d"),m=i("55f9"),l=i("c52f"),d=i("1e13"),p=i("21d7"),f=i("ddf7"),_=i("4f77"),g=i("8dd9d"),v=i("66bf"),C=i("5410"),T=i("93da"),y=i("df07"),O=i("52f0"),E=i("713f"),w=i("4e1a"),b=i("0260"),j=i("2ac3"),I=i("eace"),W=i("f806"),P=i("b137"),x=i("482f"),M=i("a307");function N(t){this._scene=t,this._transform=O["a"].clone(O["a"].IDENTITY),this._invTransform=O["a"].clone(O["a"].IDENTITY),this._actualTransform=O["a"].clone(O["a"].IDENTITY),this._actualInvTransform=O["a"].clone(O["a"].IDENTITY),this._transformChanged=!1,this.position=new n["a"],this._position=new n["a"],this._positionWC=new n["a"],this._positionCartographic=new s["a"],this._oldPositionWC=void 0,this.positionWCDeltaMagnitude=0,this.positionWCDeltaMagnitudeLastFrame=0,this.timeSinceMoved=0,this._lastMovedTimestamp=0,this.direction=new n["a"],this._direction=new n["a"],this._directionWC=new n["a"],this.up=new n["a"],this._up=new n["a"],this._upWC=new n["a"],this.right=new n["a"],this._right=new n["a"],this._rightWC=new n["a"],this.frustum=new w["a"],this.frustum.aspectRatio=t.drawingBufferWidth/t.drawingBufferHeight,this.frustum.fov=T["a"].toRadians(60),this.defaultMoveAmount=1e5,this.defaultLookAmount=Math.PI/60,this.defaultRotateAmount=Math.PI/3600,this.defaultZoomAmount=1e5,this.constrainedAxis=void 0,this.maximumZoomFactor=1.5,this._moveStart=new p["a"],this._moveEnd=new p["a"],this._changed=new p["a"],this._changedPosition=void 0,this._changedDirection=void 0,this._changedFrustum=void 0,this.percentageChanged=.5,this._viewMatrix=new O["a"],this._invViewMatrix=new O["a"],S(this),this._mode=M["a"].SCENE3D,this._modeChanged=!0;var a=t.mapProjection;this._projection=a,this._maxCoord=a.project(new s["a"](Math.PI,T["a"].PI_OVER_TWO)),this._max2Dfrustum=void 0,this._suspendTerrainAdjustment=!1,ia(this,N.DEFAULT_VIEW_RECTANGLE,this.position,!0);var i=n["a"].magnitude(this.position);i+=i*N.DEFAULT_VIEW_FACTOR,n["a"].normalize(this.position,this.position),n["a"].multiplyByScalar(this.position,i,this.position)}function S(t){O["a"].computeView(t._position,t._direction,t._up,t._right,t._viewMatrix),O["a"].multiply(t._viewMatrix,t._actualInvTransform,t._viewMatrix),O["a"].inverseTransformation(t._viewMatrix,t._invViewMatrix)}function D(t){if(Object(h["a"])(t._oldPositionWC)){t.positionWCDeltaMagnitudeLastFrame=t.positionWCDeltaMagnitude;var a=n["a"].subtract(t.positionWC,t._oldPositionWC,t._oldPositionWC);t.positionWCDeltaMagnitude=n["a"].magnitude(a),t._oldPositionWC=n["a"].clone(t.positionWC,t._oldPositionWC),t.positionWCDeltaMagnitude>0?(t.timeSinceMoved=0,t._lastMovedTimestamp=Object(f["a"])()):t.timeSinceMoved=Math.max(Object(f["a"])()-t._lastMovedTimestamp,0)/1e3}else t._oldPositionWC=n["a"].clone(t.positionWC,t._oldPositionWC)}N.TRANSFORM_2D=new O["a"](0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1),N.TRANSFORM_2D_INVERSE=O["a"].inverseTransformation(N.TRANSFORM_2D,new O["a"]),N.DEFAULT_VIEW_RECTANGLE=I["a"].fromDegrees(-95,-20,-70,90),N.DEFAULT_VIEW_FACTOR=.5,N.DEFAULT_OFFSET=new _["a"](0,-T["a"].PI_OVER_FOUR,0),N.prototype.hasCurrentFlight=function(){return Object(h["a"])(this._currentFlight)&&Object(h["a"])(this._scene.preloadFlightCamera)},N.prototype._updateCameraChanged=function(){var t=this;if(D(t),0!==t._changed.numberOfListeners){var a=t.percentageChanged;if(t._mode!==M["a"].SCENE2D){if(!Object(h["a"])(t._changedDirection))return t._changedPosition=n["a"].clone(t.positionWC,t._changedPosition),void(t._changedDirection=n["a"].clone(t.directionWC,t._changedDirection));var i,o=T["a"].acosClamped(n["a"].dot(t.directionWC,t._changedDirection));i=Object(h["a"])(t.frustum.fovy)?o/(.5*t.frustum.fovy):o;var e=n["a"].distance(t.positionWC,t._changedPosition),r=e/t.positionCartographic.height;(i>a||r>a)&&(t._changed.raiseEvent(Math.max(i,r)),t._changedPosition=n["a"].clone(t.positionWC,t._changedPosition),t._changedDirection=n["a"].clone(t.directionWC,t._changedDirection))}else{if(!Object(h["a"])(t._changedFrustum))return t._changedPosition=n["a"].clone(t.position,t._changedPosition),void(t._changedFrustum=t.frustum.clone());var s,c=t.position,u=t._changedPosition,m=t.frustum,l=t._changedFrustum,d=c.x+m.left,p=c.x+m.right,f=u.x+l.left,_=u.x+l.right,g=c.y+m.bottom,v=c.y+m.top,C=u.y+l.bottom,y=u.y+l.top,O=Math.max(d,f),E=Math.min(p,_),w=Math.max(g,C),b=Math.min(v,y);if(O>=E||w>=v)s=1;else{var j=l;d<f&&p>_&&g<C&&v>y&&(j=m),s=1-(E-O)*(b-w)/((j.right-j.left)*(j.top-j.bottom))}s>a&&(t._changed.raiseEvent(s),t._changedPosition=n["a"].clone(t.position,t._changedPosition),t._changedFrustum=t.frustum.clone(t._changedFrustum))}}};var A=new O["a"],R=new s["a"];function F(t){W["a"].basisTo2D(t._projection,t._transform,t._actualTransform)}N.prototype._adjustHeightForTerrain=function(){var t=this._scene,a=t.screenSpaceCameraController,i=a.enableCollisionDetection,o=a.minimumCollisionTerrainHeight,e=a.minimumZoomDistance;if(!this._suspendTerrainAdjustment&&i){var r=this._mode,s=t.globe;if(Object(h["a"])(s)&&r!==M["a"].SCENE2D&&r!==M["a"].MORPHING){var c,u,m=s.ellipsoid,l=t.mapProjection;O["a"].equals(this.transform,O["a"].IDENTITY)||(c=O["a"].clone(this.transform,A),u=n["a"].magnitude(this.position),this._setTransform(O["a"].IDENTITY));var d=R;r===M["a"].SCENE3D?m.cartesianToCartographic(this.position,d):l.unproject(this.position,d);var p=!1;if(d.height<o){var f=s.getHeight(d);Object(h["a"])(f)&&(f+=e,d.height<f&&(d.height=f,r===M["a"].SCENE3D?m.cartographicToCartesian(d,this.position):l.project(d,this.position),p=!0))}Object(h["a"])(c)&&(this._setTransform(c),p&&(n["a"].normalize(this.position,this.position),n["a"].negate(this.position,this.direction),n["a"].multiplyByScalar(this.position,Math.max(u,e),this.position),n["a"].normalize(this.direction,this.direction),n["a"].cross(this.direction,this.up,this.right),n["a"].cross(this.right,this.direction,this.up)))}}};var V=new s["a"],B=new n["a"],L=new n["a"],z=new r["a"],U=new r["a"],k=new r["a"],H=new r["a"],Y=new r["a"];function q(t){var a=t._projection,i=a.ellipsoid,o=O["a"].getColumn(t._transform,3,z),e=i.cartesianToCartographic(o,V),s=a.project(e,B),c=U;c.x=s.z,c.y=s.x,c.z=s.y,c.w=1;var h=r["a"].clone(r["a"].UNIT_X,Y),u=r["a"].add(O["a"].getColumn(t._transform,0,L),o,L);i.cartesianToCartographic(u,e),a.project(e,s);var m=k;m.x=s.z,m.y=s.x,m.z=s.y,m.w=0,n["a"].subtract(m,c,m),m.x=0;var l=H;if(n["a"].magnitudeSquared(m)>T["a"].EPSILON10)n["a"].cross(h,m,l);else{var d=r["a"].add(O["a"].getColumn(t._transform,1,L),o,L);i.cartesianToCartographic(d,e),a.project(e,s),l.x=s.z,l.y=s.x,l.z=s.y,l.w=0,n["a"].subtract(l,c,l),l.x=0,n["a"].magnitudeSquared(l)<T["a"].EPSILON10&&(r["a"].clone(r["a"].UNIT_Y,m),r["a"].clone(r["a"].UNIT_Z,l))}n["a"].cross(l,h,m),n["a"].normalize(m,m),n["a"].cross(h,m,l),n["a"].normalize(l,l),O["a"].setColumn(t._actualTransform,0,m,t._actualTransform),O["a"].setColumn(t._actualTransform,1,l,t._actualTransform),O["a"].setColumn(t._actualTransform,2,h,t._actualTransform),O["a"].setColumn(t._actualTransform,3,c,t._actualTransform)}var Z=new n["a"];function G(t){var a=t._mode,i=!1,o=0;a===M["a"].SCENE2D&&(o=t.frustum.right-t.frustum.left,i=o!==t._positionCartographic.height);var e=t._position,r=!n["a"].equals(e,t.position)||i;r&&(e=n["a"].clone(t.position,t._position));var s=t._direction,c=!n["a"].equals(s,t.direction);c&&(n["a"].normalize(t.direction,t.direction),s=n["a"].clone(t.direction,t._direction));var h=t._up,u=!n["a"].equals(h,t.up);u&&(n["a"].normalize(t.up,t.up),h=n["a"].clone(t.up,t._up));var m=t._right,l=!n["a"].equals(m,t.right);l&&(n["a"].normalize(t.right,t.right),m=n["a"].clone(t.right,t._right));var d=t._transformChanged||t._modeChanged;t._transformChanged=!1,d&&(O["a"].inverseTransformation(t._transform,t._invTransform),t._mode===M["a"].COLUMBUS_VIEW||t._mode===M["a"].SCENE2D?O["a"].equals(O["a"].IDENTITY,t._transform)?O["a"].clone(N.TRANSFORM_2D,t._actualTransform):t._mode===M["a"].COLUMBUS_VIEW?F(t):q(t):O["a"].clone(t._transform,t._actualTransform),O["a"].inverseTransformation(t._actualTransform,t._actualInvTransform),t._modeChanged=!1);var p=t._actualTransform;if(r||d)if(t._positionWC=O["a"].multiplyByPoint(p,e,t._positionWC),a===M["a"].SCENE3D||a===M["a"].MORPHING)t._positionCartographic=t._projection.ellipsoid.cartesianToCartographic(t._positionWC,t._positionCartographic);else{var f=Z;f.x=t._positionWC.y,f.y=t._positionWC.z,f.z=t._positionWC.x,a===M["a"].SCENE2D&&(f.z=o),t._projection.unproject(f,t._positionCartographic)}if(c||u||l){var _=n["a"].dot(s,n["a"].cross(h,m,Z));if(Math.abs(1-_)>T["a"].EPSILON2){var g=1/n["a"].magnitudeSquared(h),v=n["a"].dot(h,s)*g,C=n["a"].multiplyByScalar(s,v,Z);h=n["a"].normalize(n["a"].subtract(h,C,t._up),t._up),n["a"].clone(h,t.up),m=n["a"].cross(s,h,t._right),n["a"].clone(m,t.right)}}(c||d)&&(t._directionWC=O["a"].multiplyByPointAsVector(p,s,t._directionWC),n["a"].normalize(t._directionWC,t._directionWC)),(u||d)&&(t._upWC=O["a"].multiplyByPointAsVector(p,h,t._upWC),n["a"].normalize(t._upWC,t._upWC)),(l||d)&&(t._rightWC=O["a"].multiplyByPointAsVector(p,m,t._rightWC),n["a"].normalize(t._rightWC,t._rightWC)),(r||c||u||l||d)&&S(t)}function Q(t,a){var i;return i=T["a"].equalsEpsilon(Math.abs(t.z),1,T["a"].EPSILON3)?Math.atan2(a.y,a.x)-T["a"].PI_OVER_TWO:Math.atan2(t.y,t.x)-T["a"].PI_OVER_TWO,T["a"].TWO_PI-T["a"].zeroToTwoPi(i)}function X(t){return T["a"].PI_OVER_TWO-T["a"].acosClamped(t.z)}function J(t,a,i){var o=0;return T["a"].equalsEpsilon(Math.abs(t.z),1,T["a"].EPSILON3)||(o=Math.atan2(-i.z,a.z),o=T["a"].zeroToTwoPi(o+T["a"].TWO_PI)),o}var K=new O["a"],$=new O["a"];Object(u["a"])(N.prototype,{transform:{get:function(){return this._transform}},inverseTransform:{get:function(){return G(this),this._invTransform}},viewMatrix:{get:function(){return G(this),this._viewMatrix}},inverseViewMatrix:{get:function(){return G(this),this._invViewMatrix}},positionCartographic:{get:function(){return G(this),this._positionCartographic}},positionWC:{get:function(){return G(this),this._positionWC}},directionWC:{get:function(){return G(this),this._directionWC}},upWC:{get:function(){return G(this),this._upWC}},rightWC:{get:function(){return G(this),this._rightWC}},heading:{get:function(){if(this._mode!==M["a"].MORPHING){var t=this._projection.ellipsoid,a=O["a"].clone(this._transform,K),i=W["a"].eastNorthUpToFixedFrame(this.positionWC,t,$);this._setTransform(i);var o=Q(this.direction,this.up);return this._setTransform(a),o}}},pitch:{get:function(){if(this._mode!==M["a"].MORPHING){var t=this._projection.ellipsoid,a=O["a"].clone(this._transform,K),i=W["a"].eastNorthUpToFixedFrame(this.positionWC,t,$);this._setTransform(i);var o=X(this.direction);return this._setTransform(a),o}}},roll:{get:function(){if(this._mode!==M["a"].MORPHING){var t=this._projection.ellipsoid,a=O["a"].clone(this._transform,K),i=W["a"].eastNorthUpToFixedFrame(this.positionWC,t,$);this._setTransform(i);var o=J(this.direction,this.up,this.right);return this._setTransform(a),o}}},moveStart:{get:function(){return this._moveStart}},moveEnd:{get:function(){return this._moveEnd}},changed:{get:function(){return this._changed}}}),N.prototype.update=function(t){var a=!1;if(t!==this._mode&&(this._mode=t,this._modeChanged=t!==M["a"].MORPHING,a=this._mode===M["a"].SCENE2D),a){var i=this._max2Dfrustum=this.frustum.clone(),o=2,e=i.top/i.right;i.right=this._maxCoord.x*o,i.left=-i.right,i.top=e*i.right,i.bottom=-i.top}this._mode===M["a"].SCENE2D&&Et(this,this.position);var n=this._scene.globe,r=!Object(h["a"])(n)||n._surface.tileProvider.ready&&0===n._surface._tileLoadQueueHigh.length&&0===n._surface._tileLoadQueueMedium.length&&0===n._surface._tileLoadQueueLow.length&&0===n._surface._debug.tilesWaitingForChildren;this._suspendTerrainAdjustment&&(this._suspendTerrainAdjustment=!r),r&&this._adjustHeightForTerrain()};var tt=new n["a"],at=new n["a"],it=new n["a"];N.prototype._setTransform=function(t){var a=n["a"].clone(this.positionWC,tt),i=n["a"].clone(this.upWC,at),o=n["a"].clone(this.directionWC,it);O["a"].clone(t,this._transform),this._transformChanged=!0,G(this);var e=this._actualInvTransform;O["a"].multiplyByPoint(e,a,this.position),O["a"].multiplyByPointAsVector(e,o,this.direction),O["a"].multiplyByPointAsVector(e,i,this.up),n["a"].cross(this.direction,this.up,this.right),G(this)};var ot=new e["a"],et=new j["a"],nt=new n["a"],rt=new n["a"];N.prototype._adjustOrthographicFrustum=function(t){if(this.frustum instanceof E["a"]&&(t||!(this._positionCartographic.height<15e4)))if(O["a"].equals(O["a"].IDENTITY,this.transform)){var a,i,o=this._scene,e=o.globe;if(Object(h["a"])(e)){var r=ot;r.x=o.drawingBufferWidth/2,r.y=o.drawingBufferHeight/2;var s=this.getPickRay(r,et);if(a=e.pickWorldCoordinates(s,o,nt),o.pickPositionSupported&&(i=o.pickPositionWorldCoordinates(r,rt)),Object(h["a"])(a)&&Object(h["a"])(i)){var c=Object(h["a"])(i)?n["a"].distance(i,this.positionWC):Number.POSITIVE_INFINITY,u=Object(h["a"])(a)?n["a"].distance(a,this.positionWC):Number.POSITIVE_INFINITY;this.frustum.width=Math.min(c,u)}else Object(h["a"])(i)?this.frustum.width=n["a"].distance(i,this.positionWC):Object(h["a"])(a)&&(this.frustum.width=n["a"].distance(a,this.positionWC))}if(!Object(h["a"])(e)||!Object(h["a"])(a)&&!Object(h["a"])(i)){var m=Math.max(this.positionCartographic.height,0);this.frustum.width=m}}else this.frustum.width=n["a"].magnitude(this.position)};var st=new n["a"],ct=new O["a"],ht=new O["a"],ut=new b["a"],mt=new y["a"],lt=new s["a"];function dt(t,a,i){var o=O["a"].clone(t.transform,ct),e=W["a"].eastNorthUpToFixedFrame(a,t._projection.ellipsoid,ht);t._setTransform(e),n["a"].clone(n["a"].ZERO,t.position),i.heading=i.heading-T["a"].PI_OVER_TWO;var r=b["a"].fromHeadingPitchRoll(i,ut),s=y["a"].fromQuaternion(r,mt);y["a"].getColumn(s,0,t.direction),y["a"].getColumn(s,2,t.up),n["a"].cross(t.direction,t.up,t.right),t._setTransform(o),t._adjustOrthographicFrustum(!0)}function pt(t,a,i,o){var e=O["a"].clone(t.transform,ct);if(t._setTransform(O["a"].IDENTITY),!n["a"].equals(a,t.positionWC)){if(o){var r=t._projection,s=r.ellipsoid.cartesianToCartographic(a,lt);a=r.project(s,st)}n["a"].clone(a,t.position)}i.heading=i.heading-T["a"].PI_OVER_TWO;var c=b["a"].fromHeadingPitchRoll(i,ut),h=y["a"].fromQuaternion(c,mt);y["a"].getColumn(h,0,t.direction),y["a"].getColumn(h,2,t.up),n["a"].cross(t.direction,t.up,t.right),t._setTransform(e),t._adjustOrthographicFrustum(!0)}function ft(t,a,i,o){var r=O["a"].clone(t.transform,ct);if(t._setTransform(O["a"].IDENTITY),!n["a"].equals(a,t.positionWC)){if(o){var s=t._projection,c=s.ellipsoid.cartesianToCartographic(a,lt);a=s.project(c,st)}e["a"].clone(a,t.position);var h=.5*-a.z,u=-h,m=t.frustum;if(u>h){var l=m.top/m.right;m.right=u,m.left=h,m.top=m.right*l,m.bottom=-m.top}}if(t._scene.mapMode2D===x["a"].ROTATE){i.heading=i.heading-T["a"].PI_OVER_TWO,i.pitch=-T["a"].PI_OVER_TWO,i.roll=0;var d=b["a"].fromHeadingPitchRoll(i,ut),p=y["a"].fromQuaternion(d,mt);y["a"].getColumn(p,2,t.up),n["a"].cross(t.direction,t.up,t.right)}t._setTransform(r)}var _t=new n["a"],gt=new n["a"],vt=new n["a"];function Ct(t,a,i,o){var e=n["a"].clone(i.direction,_t),r=n["a"].clone(i.up,gt);if(t._scene.mode===M["a"].SCENE3D){var s=t._projection.ellipsoid,c=W["a"].eastNorthUpToFixedFrame(a,s,K),h=O["a"].inverseTransformation(c,$);O["a"].multiplyByPointAsVector(h,e,e),O["a"].multiplyByPointAsVector(h,r,r)}var u=n["a"].cross(e,r,vt);return o.heading=Q(e,r),o.pitch=X(e),o.roll=J(e,r,u),o}var Tt={destination:void 0,orientation:{direction:void 0,up:void 0,heading:void 0,pitch:void 0,roll:void 0},convert:void 0,endTransform:void 0},yt=new g["a"];N.prototype.setView=function(t){t=Object(c["a"])(t,c["a"].EMPTY_OBJECT);var a=Object(c["a"])(t.orientation,c["a"].EMPTY_OBJECT),i=this._mode;if(i!==M["a"].MORPHING){Object(h["a"])(t.endTransform)&&this._setTransform(t.endTransform);var o=Object(c["a"])(t.convert,!0),e=Object(c["a"])(t.destination,n["a"].clone(this.positionWC,st));Object(h["a"])(e)&&Object(h["a"])(e.west)&&(e=this.getRectangleCameraCoordinates(e,st),o=!1),Object(h["a"])(a.direction)&&(a=Ct(this,e,a,Tt.orientation)),yt.heading=Object(c["a"])(a.heading,0),yt.pitch=Object(c["a"])(a.pitch,-T["a"].PI_OVER_TWO),yt.roll=Object(c["a"])(a.roll,0),this._suspendTerrainAdjustment=!0,i===M["a"].SCENE3D?dt(this,e,yt):i===M["a"].SCENE2D?ft(this,e,yt,o):pt(this,e,yt,o)}};var Ot=new n["a"];function Et(t,a){var i,o,e=t._scene.mapMode2D===x["a"].ROTATE,n=t._maxCoord.x,r=t._maxCoord.y;e?(o=n,i=-o):(o=a.x-2*n,i=a.x+2*n),a.x>n&&(a.x=o),a.x<-n&&(a.x=i),a.y>r&&(a.y=r),a.y<-r&&(a.y=-r)}N.prototype.flyHome=function(t){var a=this._mode;if(a===M["a"].MORPHING&&this._scene.completeMorph(),a===M["a"].SCENE2D)this.flyTo({destination:N.DEFAULT_VIEW_RECTANGLE,duration:t,endTransform:O["a"].IDENTITY});else if(a===M["a"].SCENE3D){var i=this.getRectangleCameraCoordinates(N.DEFAULT_VIEW_RECTANGLE),o=n["a"].magnitude(i);o+=o*N.DEFAULT_VIEW_FACTOR,n["a"].normalize(i,i),n["a"].multiplyByScalar(i,o,i),this.flyTo({destination:i,duration:t,endTransform:O["a"].IDENTITY})}else if(a===M["a"].COLUMBUS_VIEW){var e=this._projection.ellipsoid.maximumRadius,r=new n["a"](0,-1,1);r=n["a"].multiplyByScalar(n["a"].normalize(r,r),5*e,r),this.flyTo({destination:r,duration:t,orientation:{heading:0,pitch:-Math.acos(n["a"].normalize(r,Ot).z),roll:0},endTransform:O["a"].IDENTITY,convert:!1})}},N.prototype.worldToCameraCoordinates=function(t,a){return Object(h["a"])(a)||(a=new r["a"]),G(this),O["a"].multiplyByVector(this._actualInvTransform,t,a)},N.prototype.worldToCameraCoordinatesPoint=function(t,a){return Object(h["a"])(a)||(a=new n["a"]),G(this),O["a"].multiplyByPoint(this._actualInvTransform,t,a)},N.prototype.worldToCameraCoordinatesVector=function(t,a){return Object(h["a"])(a)||(a=new n["a"]),G(this),O["a"].multiplyByPointAsVector(this._actualInvTransform,t,a)},N.prototype.cameraToWorldCoordinates=function(t,a){return Object(h["a"])(a)||(a=new r["a"]),G(this),O["a"].multiplyByVector(this._actualTransform,t,a)},N.prototype.cameraToWorldCoordinatesPoint=function(t,a){return Object(h["a"])(a)||(a=new n["a"]),G(this),O["a"].multiplyByPoint(this._actualTransform,t,a)},N.prototype.cameraToWorldCoordinatesVector=function(t,a){return Object(h["a"])(a)||(a=new n["a"]),G(this),O["a"].multiplyByPointAsVector(this._actualTransform,t,a)};var wt=new n["a"];N.prototype.move=function(t,a){var i=this.position;n["a"].multiplyByScalar(t,a,wt),n["a"].add(i,wt,i),this._mode===M["a"].SCENE2D&&Et(this,i),this._adjustOrthographicFrustum(!0)},N.prototype.moveForward=function(t){t=Object(c["a"])(t,this.defaultMoveAmount),this._mode===M["a"].SCENE2D?At(this,t):this.move(this.direction,t)},N.prototype.moveBackward=function(t){t=Object(c["a"])(t,this.defaultMoveAmount),this._mode===M["a"].SCENE2D?At(this,-t):this.move(this.direction,-t)},N.prototype.moveUp=function(t){t=Object(c["a"])(t,this.defaultMoveAmount),this.move(this.up,t)},N.prototype.moveDown=function(t){t=Object(c["a"])(t,this.defaultMoveAmount),this.move(this.up,-t)},N.prototype.moveRight=function(t){t=Object(c["a"])(t,this.defaultMoveAmount),this.move(this.right,t)},N.prototype.moveLeft=function(t){t=Object(c["a"])(t,this.defaultMoveAmount),this.move(this.right,-t)},N.prototype.lookLeft=function(t){t=Object(c["a"])(t,this.defaultLookAmount),this._mode!==M["a"].SCENE2D&&this.look(this.up,-t)},N.prototype.lookRight=function(t){t=Object(c["a"])(t,this.defaultLookAmount),this._mode!==M["a"].SCENE2D&&this.look(this.up,t)},N.prototype.lookUp=function(t){t=Object(c["a"])(t,this.defaultLookAmount),this._mode!==M["a"].SCENE2D&&this.look(this.right,-t)},N.prototype.lookDown=function(t){t=Object(c["a"])(t,this.defaultLookAmount),this._mode!==M["a"].SCENE2D&&this.look(this.right,t)};var bt=new b["a"],jt=new y["a"];N.prototype.look=function(t,a){var i=Object(c["a"])(a,this.defaultLookAmount),o=b["a"].fromAxisAngle(t,-i,bt),e=y["a"].fromQuaternion(o,jt),n=this.direction,r=this.up,s=this.right;y["a"].multiplyByVector(e,n,n),y["a"].multiplyByVector(e,r,r),y["a"].multiplyByVector(e,s,s)},N.prototype.twistLeft=function(t){t=Object(c["a"])(t,this.defaultLookAmount),this.look(this.direction,t)},N.prototype.twistRight=function(t){t=Object(c["a"])(t,this.defaultLookAmount),this.look(this.direction,-t)};var It=new b["a"],Wt=new y["a"];N.prototype.rotate=function(t,a){var i=Object(c["a"])(a,this.defaultRotateAmount),o=b["a"].fromAxisAngle(t,-i,It),e=y["a"].fromQuaternion(o,Wt);y["a"].multiplyByVector(e,this.position,this.position),y["a"].multiplyByVector(e,this.direction,this.direction),y["a"].multiplyByVector(e,this.up,this.up),n["a"].cross(this.direction,this.up,this.right),n["a"].cross(this.right,this.direction,this.up),this._adjustOrthographicFrustum(!1)},N.prototype.rotateDown=function(t){t=Object(c["a"])(t,this.defaultRotateAmount),St(this,t)},N.prototype.rotateUp=function(t){t=Object(c["a"])(t,this.defaultRotateAmount),St(this,-t)};var Pt=new n["a"],xt=new n["a"],Mt=new n["a"],Nt=new n["a"];function St(t,a){var i=t.position;if(Object(h["a"])(t.constrainedAxis)&&!n["a"].equalsEpsilon(t.position,n["a"].ZERO,T["a"].EPSILON2)){var o=n["a"].normalize(i,Pt),e=n["a"].equalsEpsilon(o,t.constrainedAxis,T["a"].EPSILON2),r=n["a"].equalsEpsilon(o,n["a"].negate(t.constrainedAxis,Nt),T["a"].EPSILON2);if(e||r)(e&&a<0||r&&a>0)&&t.rotate(t.right,a);else{var s=n["a"].normalize(t.constrainedAxis,xt),c=n["a"].dot(o,s),u=T["a"].acosClamped(c);a>0&&a>u&&(a=u-T["a"].EPSILON4),c=n["a"].dot(o,n["a"].negate(s,Nt)),u=T["a"].acosClamped(c),a<0&&-a>u&&(a=-u+T["a"].EPSILON4);var m=n["a"].cross(s,o,Mt);t.rotate(m,a)}}else t.rotate(t.right,a)}function Dt(t,a){Object(h["a"])(t.constrainedAxis)?t.rotate(t.constrainedAxis,a):t.rotate(t.up,a)}function At(t,a){var i,o=t.frustum;if(a*=.5,Math.abs(o.top)+Math.abs(o.bottom)>Math.abs(o.left)+Math.abs(o.right)){var e=o.top-a,n=o.bottom+a,r=t._maxCoord.y;t._scene.mapMode2D===x["a"].ROTATE&&(r*=t.maximumZoomFactor),n>r&&(n=r,e=-r),e<=n&&(e=1,n=-1),i=o.right/o.top,o.top=e,o.bottom=n,o.right=o.top*i,o.left=-o.right}else{var s=o.right-a,c=o.left+a,h=t._maxCoord.x;t._scene.mapMode2D===x["a"].ROTATE&&(h*=t.maximumZoomFactor),s>h&&(s=h,c=-h),s<=c&&(s=1,c=-1),i=o.top/o.right,o.right=s,o.left=c,o.top=o.right*i,o.bottom=-o.top}}function Rt(t,a){t.move(t.direction,a)}N.prototype.rotateRight=function(t){t=Object(c["a"])(t,this.defaultRotateAmount),Dt(this,-t)},N.prototype.rotateLeft=function(t){t=Object(c["a"])(t,this.defaultRotateAmount),Dt(this,t)},N.prototype.zoomIn=function(t){t=Object(c["a"])(t,this.defaultZoomAmount),this._mode===M["a"].SCENE2D?At(this,t):Rt(this,t)},N.prototype.zoomOut=function(t){t=Object(c["a"])(t,this.defaultZoomAmount),this._mode===M["a"].SCENE2D?At(this,-t):Rt(this,-t)},N.prototype.getMagnitude=function(){return this._mode===M["a"].SCENE3D?n["a"].magnitude(this.position):this._mode===M["a"].COLUMBUS_VIEW?Math.abs(this.position.z):this._mode===M["a"].SCENE2D?Math.max(this.frustum.right-this.frustum.left,this.frustum.top-this.frustum.bottom):void 0};var Ft=new O["a"];N.prototype.lookAt=function(t,a){var i=W["a"].eastNorthUpToFixedFrame(t,l["a"].WGS84,Ft);this.lookAtTransform(i,a)};var Vt=new n["a"],Bt=new b["a"],Lt=new b["a"],zt=new y["a"];function Ut(t,a,i){a=T["a"].clamp(a,-T["a"].PI_OVER_TWO,T["a"].PI_OVER_TWO),t=T["a"].zeroToTwoPi(t)-T["a"].PI_OVER_TWO;var o=b["a"].fromAxisAngle(n["a"].UNIT_Y,-a,Bt),e=b["a"].fromAxisAngle(n["a"].UNIT_Z,-t,Lt),r=b["a"].multiply(e,o,e),s=y["a"].fromQuaternion(r,zt),c=n["a"].clone(n["a"].UNIT_X,Vt);return y["a"].multiplyByVector(s,c,c),n["a"].negate(c,c),n["a"].multiplyByScalar(c,i,c),c}N.prototype.lookAtTransform=function(t,a){if(this._setTransform(t),Object(h["a"])(a)){var i;if(i=Object(h["a"])(a.heading)?Ut(a.heading,a.pitch,a.range):a,this._mode===M["a"].SCENE2D){e["a"].clone(e["a"].ZERO,this.position),n["a"].negate(i,this.up),this.up.z=0,n["a"].magnitudeSquared(this.up)<T["a"].EPSILON10&&n["a"].clone(n["a"].UNIT_Y,this.up),n["a"].normalize(this.up,this.up),this._setTransform(O["a"].IDENTITY),n["a"].negate(n["a"].UNIT_Z,this.direction),n["a"].cross(this.direction,this.up,this.right),n["a"].normalize(this.right,this.right);var o=this.frustum,r=o.top/o.right;return o.right=.5*n["a"].magnitude(i),o.left=-o.right,o.top=r*o.right,o.bottom=-o.top,void this._setTransform(t)}n["a"].clone(i,this.position),n["a"].negate(this.position,this.direction),n["a"].normalize(this.direction,this.direction),n["a"].cross(this.direction,n["a"].UNIT_Z,this.right),n["a"].magnitudeSquared(this.right)<T["a"].EPSILON10&&n["a"].clone(n["a"].UNIT_X,this.right),n["a"].normalize(this.right,this.right),n["a"].cross(this.right,this.direction,this.up),n["a"].normalize(this.up,this.up),this._adjustOrthographicFrustum(!0)}};var kt,Ht=new s["a"],Yt=new s["a"],qt=new n["a"],Zt=new n["a"],Gt=new n["a"],Qt=new n["a"],Xt=new n["a"],Jt=new n["a"],Kt=new n["a"],$t=new n["a"],ta={direction:new n["a"],right:new n["a"],up:new n["a"]};function aa(t,a,i,o){var e=Math.abs(n["a"].dot(a,i));return e/o-n["a"].dot(t,i)}function ia(t,a,i,o){var e=t._projection.ellipsoid,r=o?t:ta,s=a.north,c=a.south,u=a.east,m=a.west;m>u&&(u+=T["a"].TWO_PI);var l,p=.5*(m+u);if(c<-T["a"].PI_OVER_TWO+T["a"].RADIANS_PER_DEGREE&&s>T["a"].PI_OVER_TWO-T["a"].RADIANS_PER_DEGREE)l=0;else{var f=Ht;f.longitude=p,f.latitude=s,f.height=0;var _=Yt;_.longitude=p,_.latitude=c,_.height=0;var g=kt;Object(h["a"])(g)&&g.ellipsoid===e||(kt=g=new d["a"](void 0,void 0,e)),g.setEndPoints(f,_),l=g.interpolateUsingFraction(.5,Ht).latitude}var v=Ht;v.longitude=p,v.latitude=l,v.height=0;var C=e.cartographicToCartesian(v,Kt),y=Ht;y.longitude=u,y.latitude=s;var O=e.cartographicToCartesian(y,qt);y.longitude=m;var w=e.cartographicToCartesian(y,Gt);y.longitude=p;var b=e.cartographicToCartesian(y,Xt);y.latitude=c;var j=e.cartographicToCartesian(y,Jt);y.longitude=u;var I=e.cartographicToCartesian(y,Qt);y.longitude=m;var W=e.cartographicToCartesian(y,Zt);n["a"].subtract(w,C,w),n["a"].subtract(I,C,I),n["a"].subtract(O,C,O),n["a"].subtract(W,C,W),n["a"].subtract(b,C,b),n["a"].subtract(j,C,j);var P=e.geodeticSurfaceNormal(C,r.direction);n["a"].negate(P,P);var x=n["a"].cross(P,n["a"].UNIT_Z,r.right);n["a"].normalize(x,x);var M,N=n["a"].cross(x,P,r.up);if(t.frustum instanceof E["a"]){var S,D,A=Math.max(n["a"].distance(O,w),n["a"].distance(I,W)),R=Math.max(n["a"].distance(O,I),n["a"].distance(w,W)),F=t.frustum._offCenterFrustum.right/t.frustum._offCenterFrustum.top,V=R*F;A>V?(S=A,D=S/F):(D=R,S=V),M=Math.max(S,D)}else{var B=Math.tan(.5*t.frustum.fovy),L=t.frustum.aspectRatio*B;if(M=Math.max(aa(P,N,w,B),aa(P,N,I,B),aa(P,N,O,B),aa(P,N,W,B),aa(P,N,b,B),aa(P,N,j,B),aa(P,x,w,L),aa(P,x,I,L),aa(P,x,O,L),aa(P,x,W,L),aa(P,x,b,L),aa(P,x,j,L)),c<0&&s>0){var z=Ht;z.longitude=m,z.latitude=0,z.height=0;var U=e.cartographicToCartesian(z,$t);n["a"].subtract(U,C,U),M=Math.max(M,aa(P,N,U,B),aa(P,x,U,L)),z.longitude=u,U=e.cartographicToCartesian(z,$t),n["a"].subtract(U,C,U),M=Math.max(M,aa(P,N,U,B),aa(P,x,U,L))}}return n["a"].add(C,n["a"].multiplyByScalar(P,-M,$t),i)}var oa=new s["a"],ea=new n["a"],na=new n["a"];function ra(t,a,i){var o=t._projection;a.west>a.east&&(a=I["a"].MAX_VALUE);var e=t._actualTransform,n=t._actualInvTransform,r=oa;r.longitude=a.east,r.latitude=a.north;var s=o.project(r,ea);O["a"].multiplyByPoint(e,s,s),O["a"].multiplyByPoint(n,s,s),r.longitude=a.west,r.latitude=a.south;var c=o.project(r,na);if(O["a"].multiplyByPoint(e,c,c),O["a"].multiplyByPoint(n,c,c),i.x=.5*(s.x-c.x)+c.x,i.y=.5*(s.y-c.y)+c.y,Object(h["a"])(t.frustum.fovy)){var u=Math.tan(.5*t.frustum.fovy),m=t.frustum.aspectRatio*u;i.z=.5*Math.max((s.x-c.x)/m,(s.y-c.y)/u)}else{var l=s.x-c.x,d=s.y-c.y;i.z=Math.max(l,d)}return i}var sa=new s["a"],ca=new n["a"],ha=new n["a"];function ua(t,a,i){var o=t._projection,e=a.east;a.west>a.east&&(t._scene.mapMode2D===x["a"].INFINITE_SCROLL?e+=T["a"].TWO_PI:(a=I["a"].MAX_VALUE,e=a.east));var n=sa;n.longitude=e,n.latitude=a.north;var r=o.project(n,ca);n.longitude=a.west,n.latitude=a.south;var s,c,h=o.project(n,ha),u=.5*Math.abs(r.x-h.x),m=.5*Math.abs(r.y-h.y),l=t.frustum.right/t.frustum.top,d=m*l;return u>d?(s=u,c=s/l):(c=m,s=d),m=Math.max(2*s,2*c),i.x=.5*(r.x-h.x)+h.x,i.y=.5*(r.y-h.y)+h.y,n=o.unproject(i,n),n.height=m,i=o.project(n,i),i}N.prototype.getRectangleCameraCoordinates=function(t,a){var i=this._mode;return Object(h["a"])(a)||(a=new n["a"]),i===M["a"].SCENE3D?ia(this,t,a):i===M["a"].COLUMBUS_VIEW?ra(this,t,a):i===M["a"].SCENE2D?ua(this,t,a):void 0};var ma=new j["a"];function la(t,a,i,o){i=Object(c["a"])(i,l["a"].WGS84);var e=t.getPickRay(a,ma),n=C["a"].rayEllipsoid(e,i);if(n){var r=n.start>0?n.start:n.stop;return j["a"].getPoint(e,r,o)}}var da=new j["a"];function pa(t,a,i,o){var e=t.getPickRay(a,da),r=e.origin;r=n["a"].fromElements(r.y,r.z,0,r);var s=i.unproject(r);if(!(s.latitude<-T["a"].PI_OVER_TWO||s.latitude>T["a"].PI_OVER_TWO))return i.ellipsoid.cartographicToCartesian(s,o)}var fa=new j["a"];function _a(t,a,i,o){var e=t.getPickRay(a,fa),r=-e.origin.x/e.direction.x;j["a"].getPoint(e,r,o);var s=i.unproject(new n["a"](o.y,o.z,0));if(!(s.latitude<-T["a"].PI_OVER_TWO||s.latitude>T["a"].PI_OVER_TWO||s.longitude<-Math.PI||s.longitude>Math.PI))return i.ellipsoid.cartographicToCartesian(s,o)}N.prototype.pickEllipsoid=function(t,a,i){var o=this._scene.canvas;if(0!==o.clientWidth&&0!==o.clientHeight){if(Object(h["a"])(i)||(i=new n["a"]),a=Object(c["a"])(a,l["a"].WGS84),this._mode===M["a"].SCENE3D)i=la(this,t,a,i);else if(this._mode===M["a"].SCENE2D)i=pa(this,t,this._projection,i);else{if(this._mode!==M["a"].COLUMBUS_VIEW)return;i=_a(this,t,this._projection,i)}return i}};var ga=new n["a"],va=new n["a"],Ca=new n["a"];function Ta(t,a,i){var o=t._scene.canvas,e=o.clientWidth,r=o.clientHeight,s=Math.tan(.5*t.frustum.fovy),c=t.frustum.aspectRatio*s,h=t.frustum.near,u=2/e*a.x-1,m=2/r*(r-a.y)-1,l=t.positionWC;n["a"].clone(l,i.origin);var d=n["a"].multiplyByScalar(t.directionWC,h,ga);n["a"].add(l,d,d);var p=n["a"].multiplyByScalar(t.rightWC,u*h*c,va),f=n["a"].multiplyByScalar(t.upWC,m*h*s,Ca),_=n["a"].add(d,p,i.direction);return n["a"].add(_,f,_),n["a"].subtract(_,l,_),n["a"].normalize(_,_),i}var ya=new n["a"];function Oa(t,a,i){var o=t._scene.canvas,e=o.clientWidth,r=o.clientHeight,s=t.frustum;Object(h["a"])(s._offCenterFrustum)&&(s=s._offCenterFrustum);var c=2/e*a.x-1;c*=.5*(s.right-s.left);var u=2/r*(r-a.y)-1;u*=.5*(s.top-s.bottom);var m=i.origin;return n["a"].clone(t.position,m),n["a"].multiplyByScalar(t.right,c,ya),n["a"].add(ya,m,m),n["a"].multiplyByScalar(t.up,u,ya),n["a"].add(ya,m,m),n["a"].clone(t.directionWC,i.direction),t._mode!==M["a"].COLUMBUS_VIEW&&t._mode!==M["a"].SCENE2D||n["a"].fromElements(i.origin.z,i.origin.x,i.origin.y,i.origin),i}N.prototype.getPickRay=function(t,a){Object(h["a"])(a)||(a=new j["a"]);var i=this.frustum;return Object(h["a"])(i.aspectRatio)&&Object(h["a"])(i.fov)&&Object(h["a"])(i.near)?Ta(this,t,a):Oa(this,t,a)};var Ea=new n["a"],wa=new n["a"];N.prototype.distanceToBoundingSphere=function(t){var a=n["a"].subtract(this.positionWC,t.center,Ea),i=n["a"].multiplyByScalar(this.directionWC,n["a"].dot(a,this.directionWC),wa);return Math.max(0,n["a"].magnitude(i)-t.radius)};var ba=new e["a"];function ja(t,a,i,o,e,r){var s=n["a"].clone(a);function c(i){var o=n["a"].lerp(a,s,i.time,new n["a"]);t.worldToCameraCoordinatesPoint(o,t.position)}return i.y>o?s.y-=i.y-o:i.y<-o&&(s.y+=-o-i.y),i.z>e?s.z-=i.z-e:i.z<-e&&(s.z+=-e-i.z),{easingFunction:m["a"].EXPONENTIAL_OUT,startObject:{time:0},stopObject:{time:1},duration:r,update:c}}N.prototype.getPixelSize=function(t,a,i){var o=this.distanceToBoundingSphere(t),e=this.frustum.getPixelDimensions(a,i,o,this._scene.pixelRatio,ba);return Math.max(e.x,e.y)};var Ia=new n["a"],Wa=new n["a"],Pa=new n["a"],xa=new n["a"];function Ma(t,a){var i=t.position,o=t.direction,e=t.worldToCameraCoordinatesVector(n["a"].UNIT_X,Ia),r=-n["a"].dot(e,i)/n["a"].dot(e,o),s=n["a"].add(i,n["a"].multiplyByScalar(o,r,Wa),Wa);t.cameraToWorldCoordinatesPoint(s,s),i=t.cameraToWorldCoordinatesPoint(t.position,Pa);var c=Math.tan(.5*t.frustum.fovy),h=t.frustum.aspectRatio*c,u=n["a"].magnitude(n["a"].subtract(i,s,xa)),m=h*u,l=c*u,d=t._maxCoord.x,p=t._maxCoord.y,f=Math.max(m-d,d),_=Math.max(l-p,p);if(i.z<-f||i.z>f||i.y<-_||i.y>_){var g=s.y<-f||s.y>f,v=s.z<-_||s.z>_;if(g||v)return ja(t,i,s,f,_,a)}}N.prototype.createCorrectPositionTween=function(t){if(this._mode===M["a"].COLUMBUS_VIEW)return Ma(this,t)};var Na=new n["a"],Sa={destination:void 0,heading:void 0,pitch:void 0,roll:void 0,duration:void 0,complete:void 0,cancel:void 0,endTransform:void 0,maximumHeight:void 0,easingFunction:void 0};function Da(t,a){var i=t.frustum,o=Math.tan(.5*i.fovy),e=i.aspectRatio*o;return Math.max(a/e,a/o)}function Aa(t,a){var i,o,e=t.frustum;Object(h["a"])(e._offCenterFrustum)&&(e=e._offCenterFrustum);var n=e.right/e.top,r=a*n;return a>r?(i=a,o=i/n):(o=a,i=r),1.5*Math.max(i,o)}N.prototype.cancelFlight=function(){Object(h["a"])(this._currentFlight)&&(this._currentFlight.cancelTween(),this._currentFlight=void 0)},N.prototype.flyTo=function(t){t=Object(c["a"])(t,c["a"].EMPTY_OBJECT);var a=t.destination,i=this._mode;if(i!==M["a"].MORPHING){this.cancelFlight();var o=Object(c["a"])(t.orientation,c["a"].EMPTY_OBJECT);if(Object(h["a"])(o.direction)&&(o=Ct(this,a,o,Tt.orientation)),Object(h["a"])(t.duration)&&t.duration<=0){var e=Tt;return e.destination=t.destination,e.orientation.heading=o.heading,e.orientation.pitch=o.pitch,e.orientation.roll=o.roll,e.convert=t.convert,e.endTransform=t.endTransform,this.setView(e),void("function"===typeof t.complete&&t.complete())}var n=Object(h["a"])(a.west);n&&(a=this.getRectangleCameraCoordinates(a,Na));var r,s=this;Sa.destination=a,Sa.heading=o.heading,Sa.pitch=o.pitch,Sa.roll=o.roll,Sa.duration=t.duration,Sa.complete=function(){r===s._currentFlight&&(s._currentFlight=void 0),Object(h["a"])(t.complete)&&t.complete()},Sa.cancel=t.cancel,Sa.endTransform=t.endTransform,Sa.convert=!n&&t.convert,Sa.maximumHeight=t.maximumHeight,Sa.pitchAdjustHeight=t.pitchAdjustHeight,Sa.flyOverLongitude=t.flyOverLongitude,Sa.flyOverLongitudeWeight=t.flyOverLongitudeWeight,Sa.easingFunction=t.easingFunction;var u=this._scene;r=u.tweens.add(P["a"].createTween(u,Sa)),this._currentFlight=r;var m=this._scene.preloadFlightCamera;this._mode!==M["a"].SCENE2D?(Object(h["a"])(m)||(m=N.clone(this)),m.setView({destination:a,orientation:o}),this._scene.preloadFlightCullingVolume=m.frustum.computeCullingVolume(m.positionWC,m.directionWC,m.upWC)):m=void 0}};var Ra=100;function Fa(t,a,i){Object(h["a"])(i)||(i=_["a"].clone(N.DEFAULT_OFFSET));var o=t._scene.screenSpaceCameraController.minimumZoomDistance,e=t._scene.screenSpaceCameraController.maximumZoomDistance,n=i.range;if(!Object(h["a"])(n)||0===n){var r=a.radius;0===r?i.range=Ra:t.frustum instanceof E["a"]||t._mode===M["a"].SCENE2D?i.range=Aa(t,r):i.range=Da(t,r),i.range=T["a"].clamp(i.range,o,e)}return i}N.prototype.viewBoundingSphere=function(t,a){a=Fa(this,t,a),this.lookAt(t.center,a)};var Va=new O["a"],Ba=new n["a"],La=new n["a"],za=new n["a"],Ua=new n["a"],ka=new r["a"],Ha=new b["a"],Ya=new y["a"];N.prototype.flyToBoundingSphere=function(t,a){a=Object(c["a"])(a,c["a"].EMPTY_OBJECT);var i=this._mode===M["a"].SCENE2D||this._mode===M["a"].COLUMBUS_VIEW;this._setTransform(O["a"].IDENTITY);var o,e=Fa(this,t,a.offset);o=i?n["a"].multiplyByScalar(n["a"].UNIT_Z,e.range,Ba):Ut(e.heading,e.pitch,e.range);var r,s,h=W["a"].eastNorthUpToFixedFrame(t.center,l["a"].WGS84,Va);if(O["a"].multiplyByPoint(h,o,o),!i){if(r=n["a"].subtract(t.center,o,La),n["a"].normalize(r,r),s=O["a"].multiplyByPointAsVector(h,n["a"].UNIT_Z,za),1-Math.abs(n["a"].dot(r,s))<T["a"].EPSILON6){var u=b["a"].fromAxisAngle(r,e.heading,Ha),m=y["a"].fromQuaternion(u,Ya);n["a"].fromCartesian4(O["a"].getColumn(h,1,ka),s),y["a"].multiplyByVector(m,s,s)}var d=n["a"].cross(r,s,Ua);n["a"].cross(d,r,s),n["a"].normalize(s,s)}this.flyTo({destination:o,orientation:{direction:r,up:s},duration:a.duration,complete:a.complete,cancel:a.cancel,endTransform:a.endTransform,maximumHeight:a.maximumHeight,easingFunction:a.easingFunction,flyOverLongitude:a.flyOverLongitude,flyOverLongitudeWeight:a.flyOverLongitudeWeight,pitchAdjustHeight:a.pitchAdjustHeight})};var qa=new n["a"],Za=new n["a"],Ga=new n["a"],Qa=new n["a"],Xa=[new n["a"],new n["a"],new n["a"],new n["a"]];function Ja(t,a){var i,o,e=a.radii,r=t.positionWC,s=n["a"].multiplyComponents(a.oneOverRadii,r,qa),c=n["a"].magnitude(s),h=n["a"].normalize(s,Za);n["a"].equalsEpsilon(h,n["a"].UNIT_Z,T["a"].EPSILON10)?(i=new n["a"](0,1,0),o=new n["a"](0,0,1)):(i=n["a"].normalize(n["a"].cross(n["a"].UNIT_Z,h,Ga),Ga),o=n["a"].normalize(n["a"].cross(h,i,Qa),Qa));var u=Math.sqrt(n["a"].magnitudeSquared(s)-1),m=n["a"].multiplyByScalar(h,1/c,qa),l=u/c,d=n["a"].multiplyByScalar(i,l,Za),p=n["a"].multiplyByScalar(o,l,Ga),f=n["a"].add(m,p,Xa[0]);n["a"].subtract(f,d,f),n["a"].multiplyComponents(e,f,f);var _=n["a"].subtract(m,p,Xa[1]);n["a"].subtract(_,d,_),n["a"].multiplyComponents(e,_,_);var g=n["a"].subtract(m,p,Xa[2]);n["a"].add(g,d,g),n["a"].multiplyComponents(e,g,g);var v=n["a"].add(m,p,Xa[3]);return n["a"].add(v,d,v),n["a"].multiplyComponents(e,v,v),Xa}var Ka=new e["a"],$a=new n["a"],ti=[new s["a"],new s["a"],new s["a"],new s["a"]];function ai(t,a,i,o,e,n){Ka.x=t,Ka.y=a;var r=o.pickEllipsoid(Ka,e,$a);return Object(h["a"])(r)?(ti[i]=e.cartesianToCartographic(r,ti[i]),1):(ti[i]=e.cartesianToCartographic(n[i],ti[i]),0)}N.prototype.computeViewRectangle=function(t,a){t=Object(c["a"])(t,l["a"].WGS84);var i=this.frustum.computeCullingVolume(this.positionWC,this.directionWC,this.upWC),e=new o["a"](n["a"].ZERO,t.maximumRadius),r=i.computeVisibility(e);if(r!==v["a"].OUTSIDE){var s=this._scene.canvas,h=s.clientWidth,u=s.clientHeight,m=0,d=Ja(this,t);if(m+=ai(0,0,0,this,t,d),m+=ai(0,u,1,this,t,d),m+=ai(h,u,2,this,t,d),m+=ai(h,0,3,this,t,d),m<2)return I["a"].MAX_VALUE;a=I["a"].fromCartographicArray(ti,a);for(var p=0,f=ti[3].longitude,_=0;_<4;++_){var g=ti[_].longitude,C=Math.abs(g-f);C>T["a"].PI?p+=T["a"].TWO_PI-C:p+=C,f=g}return T["a"].equalsEpsilon(Math.abs(p),T["a"].TWO_PI,T["a"].EPSILON9)&&(a.west=-T["a"].PI,a.east=T["a"].PI,ti[0].latitude>=0?a.north=T["a"].PI_OVER_TWO:a.south=-T["a"].PI_OVER_TWO),a}},N.prototype.switchToPerspectiveFrustum=function(){if(!(this._mode===M["a"].SCENE2D||this.frustum instanceof w["a"])){var t=this._scene;this.frustum=new w["a"],this.frustum.aspectRatio=t.drawingBufferWidth/t.drawingBufferHeight,this.frustum.fov=T["a"].toRadians(60)}},N.prototype.switchToOrthographicFrustum=function(){if(!(this._mode===M["a"].SCENE2D||this.frustum instanceof E["a"])){var t=this._scene;this.frustum=new E["a"],this.frustum.aspectRatio=t.drawingBufferWidth/t.drawingBufferHeight,this.frustum.width=n["a"].magnitude(this.position);var a=this.frustum.projectionMatrix;Object(h["a"])(a)&&this._adjustOrthographicFrustum(!0)}},N.clone=function(t,a){return Object(h["a"])(a)||(a=new N(t._scene)),n["a"].clone(t.position,a.position),n["a"].clone(t.direction,a.direction),n["a"].clone(t.up,a.up),n["a"].clone(t.right,a.right),O["a"].clone(t._transform,a.transform),a._transformChanged=!0,a.frustum=t.frustum.clone(),a},a["a"]=N}}]);