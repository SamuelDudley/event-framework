(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Cesium~9025cc6c"],{"0c80":function(e,t,i){"use strict";var a=i("77af"),r=i("670c"),o=i("be18"),n=i("a561"),s=i("bef8"),u=i("2f63"),c=i("93da"),m=i("52f0"),d=i("713f"),h=i("c34a"),p=i("f806"),l=i("a307"),f={},_=new n["a"](0,0,0,1),g=new n["a"],v=new a["a"],b=new r["a"],C=new r["a"];f.wgs84ToWindowCoordinates=function(e,t,i){return f.wgs84WithEyeOffsetToWindowCoordinates(e,t,o["a"].ZERO,i)};var w=new n["a"],S=new o["a"];function T(e,t,i,a){var r=i.viewMatrix,s=m["a"].multiplyByVector(r,n["a"].fromElements(e.x,e.y,e.z,1,w),w),u=o["a"].multiplyComponents(t,o["a"].normalize(s,S),S);return s.x+=t.x+u.x,s.y+=t.y+u.y,s.z+=u.z,m["a"].multiplyByVector(i.frustum.projectionMatrix,s,a)}var D=new s["a"](Math.PI,c["a"].PI_OVER_TWO),y=new o["a"],E=new o["a"];f.wgs84WithEyeOffsetToWindowCoordinates=function(e,t,i,a){var n=e.frameState,s=f.computeActualWgs84Position(n,t,_);if(Object(u["a"])(s)){var w=e.canvas,S=v;S.x=0,S.y=0,S.width=w.clientWidth,S.height=w.clientHeight;var O=e.camera,x=!1;if(n.mode===l["a"].SCENE2D){var P=e.mapProjection,R=D,F=P.project(R,y),M=o["a"].clone(O.position,E),I=O.frustum.clone(),j=m["a"].computeViewportTransformation(S,0,1,new m["a"]),N=O.frustum.projectionMatrix,L=O.positionWC.y,A=o["a"].fromElements(c["a"].sign(L)*F.x-L,0,-O.positionWC.x),V=p["a"].pointToGLWindowCoordinates(N,j,A);if(0===L||V.x<=0||V.x>=w.clientWidth)x=!0;else{if(V.x>.5*w.clientWidth){S.width=V.x,O.frustum.right=F.x-L,g=T(s,i,O,g),f.clipToGLWindowCoordinates(S,g,b),S.x+=V.x,O.position.x=-O.position.x;var B=O.frustum.right;O.frustum.right=-O.frustum.left,O.frustum.left=-B,g=T(s,i,O,g),f.clipToGLWindowCoordinates(S,g,C)}else{S.x+=V.x,S.width-=V.x,O.frustum.left=-F.x-L,g=T(s,i,O,g),f.clipToGLWindowCoordinates(S,g,b),S.x=S.x-S.width,O.position.x=-O.position.x;var k=O.frustum.left;O.frustum.left=-O.frustum.right,O.frustum.right=-k,g=T(s,i,O,g),f.clipToGLWindowCoordinates(S,g,C)}o["a"].clone(M,O.position),O.frustum=I.clone(),a=r["a"].clone(b,a),(a.x<0||a.x>w.clientWidth)&&(a.x=C.x)}}if(n.mode!==l["a"].SCENE2D||x){if(g=T(s,i,O,g),g.z<0&&!(O.frustum instanceof d["a"])&&!(O.frustum instanceof h["a"]))return;a=f.clipToGLWindowCoordinates(S,g,a)}return a.y=w.clientHeight-a.y,a}},f.wgs84ToDrawingBufferCoordinates=function(e,t,i){if(i=f.wgs84ToWindowCoordinates(e,t,i),Object(u["a"])(i))return f.transformWindowToDrawingBuffer(e,i,i)};var O=new o["a"],x=new s["a"];f.computeActualWgs84Position=function(e,t,i){var a=e.mode;if(a===l["a"].SCENE3D)return o["a"].clone(t,i);var r=e.mapProjection,n=r.ellipsoid.cartesianToCartographic(t,x);if(Object(u["a"])(n)){if(r.project(n,O),a===l["a"].COLUMBUS_VIEW)return o["a"].fromElements(O.z,O.x,O.y,i);if(a===l["a"].SCENE2D)return o["a"].fromElements(0,O.x,O.y,i);var s=e.morphTime;return o["a"].fromElements(c["a"].lerp(O.z,t.x,s),c["a"].lerp(O.x,t.y,s),c["a"].lerp(O.y,t.z,s),i)}};var P=new o["a"],R=new o["a"],F=new m["a"];f.clipToGLWindowCoordinates=function(e,t,i){return o["a"].divideByScalar(t,t.w,P),m["a"].computeViewportTransformation(e,0,1,F),m["a"].multiplyByPoint(F,P,R),r["a"].fromCartesian3(R,i)},f.transformWindowToDrawingBuffer=function(e,t,i){var a=e.canvas,o=e.drawingBufferWidth/a.clientWidth,n=e.drawingBufferHeight/a.clientHeight;return r["a"].fromElements(t.x*o,t.y*n,i)};var M=new n["a"],I=new n["a"];f.drawingBufferToWgs84Coordinates=function(e,t,i,a){var r=e.context,s=r.uniformState,d=s.currentFrustum,h=d.x,p=d.y;e.frameState.useLogDepth&&(i=Math.pow(2,i*c["a"].log2(p+1))-1,i=p*(1-h/i)/(p-h));var l,f=e.view.passState.viewport,_=n["a"].clone(n["a"].UNIT_W,M);_.x=(t.x-f.x)/f.width*2-1,_.y=(t.y-f.y)/f.height*2-1,_.z=2*i-1,_.w=1;var g=e.camera.frustum;if(Object(u["a"])(g.fovy)){l=m["a"].multiplyByVector(s.inverseViewProjection,_,I);var v=1/l.w;o["a"].multiplyByScalar(l,v,l)}else Object(u["a"])(g._offCenterFrustum)&&(g=g._offCenterFrustum),l=I,l.x=.5*(_.x*(g.right-g.left)+g.left+g.right),l.y=.5*(_.y*(g.top-g.bottom)+g.bottom+g.top),l.z=.5*(_.z*(h-p)-h-p),l.w=1,l=m["a"].multiplyByVector(s.inverseView,l,l);return o["a"].fromCartesian4(l,a)},t["a"]=f},"7fe1":function(e,t,i){"use strict";var a=i("bd8d"),r=i("2f63"),o=i("7d62"),n=i("e42d"),s=i("f845"),u=i("ac3b"),c=i("6ef5"),m=i("8a65"),d=i("3550"),h=i("6c84"),p=i("a913"),l=i("3022"),f=i("03f1"),_=i("23b6");function g(){this._colorTexture=void 0,this._idTexture=void 0,this._depthStencilTexture=void 0,this._depthStencilRenderbuffer=void 0,this._framebuffer=void 0,this._idFramebuffer=void 0,this._idClearColor=new a["a"](0,0,0,0),this._useHdr=void 0,this._clearCommand=new s["a"]({color:new a["a"](0,0,0,0),depth:1,owner:this})}function v(e){e._framebuffer=e._framebuffer&&e._framebuffer.destroy(),e._idFramebuffer=e._idFramebuffer&&e._idFramebuffer.destroy(),e._colorTexture=e._colorTexture&&e._colorTexture.destroy(),e._idTexture=e._idTexture&&e._idTexture.destroy(),e._depthStencilTexture=e._depthStencilTexture&&e._depthStencilTexture.destroy(),e._depthStencilRenderbuffer=e._depthStencilRenderbuffer&&e._depthStencilRenderbuffer.destroy(),e._depthStencilIdTexture=e._depthStencilIdTexture&&e._depthStencilIdTexture.destroy(),e._depthStencilIdRenderbuffer=e._depthStencilIdRenderbuffer&&e._depthStencilIdRenderbuffer.destroy(),e._framebuffer=void 0,e._idFramebuffer=void 0,e._colorTexture=void 0,e._idTexture=void 0,e._depthStencilTexture=void 0,e._depthStencilRenderbuffer=void 0,e._depthStencilIdTexture=void 0,e._depthStencilIdRenderbuffer=void 0}g.prototype.update=function(e,t,i){var a=t.width,o=t.height,s=this._colorTexture;if(!Object(r["a"])(s)||s.width!==a||s.height!==o||i!==this._useHdr){v(this),this._useHdr=i;var g=i?e.halfFloatingPointTexture?c["a"].HALF_FLOAT:c["a"].FLOAT:c["a"].UNSIGNED_BYTE;this._colorTexture=new p["a"]({context:e,width:a,height:o,pixelFormat:n["a"].RGBA,pixelDatatype:g,sampler:new h["a"]({wrapS:_["a"].CLAMP_TO_EDGE,wrapT:_["a"].CLAMP_TO_EDGE,minificationFilter:f["a"].NEAREST,magnificationFilter:l["a"].NEAREST})}),this._idTexture=new p["a"]({context:e,width:a,height:o,pixelFormat:n["a"].RGBA,pixelDatatype:c["a"].UNSIGNED_BYTE,sampler:new h["a"]({wrapS:_["a"].CLAMP_TO_EDGE,wrapT:_["a"].CLAMP_TO_EDGE,minificationFilter:f["a"].NEAREST,magnificationFilter:l["a"].NEAREST})}),e.depthTexture?(this._depthStencilTexture=new p["a"]({context:e,width:a,height:o,pixelFormat:n["a"].DEPTH_STENCIL,pixelDatatype:c["a"].UNSIGNED_INT_24_8,sampler:new h["a"]({wrapS:_["a"].CLAMP_TO_EDGE,wrapT:_["a"].CLAMP_TO_EDGE,minificationFilter:f["a"].NEAREST,magnificationFilter:l["a"].NEAREST})}),this._depthStencilIdTexture=new p["a"]({context:e,width:a,height:o,pixelFormat:n["a"].DEPTH_STENCIL,pixelDatatype:c["a"].UNSIGNED_INT_24_8,sampler:new h["a"]({wrapS:_["a"].CLAMP_TO_EDGE,wrapT:_["a"].CLAMP_TO_EDGE,minificationFilter:f["a"].NEAREST,magnificationFilter:l["a"].NEAREST})})):(this._depthStencilRenderbuffer=new m["a"]({context:e,width:a,height:o,format:d["a"].DEPTH_STENCIL}),this._depthStencilIdRenderbuffer=new m["a"]({context:e,width:a,height:o,format:d["a"].DEPTH_STENCIL})),this._framebuffer=new u["a"]({context:e,colorTextures:[this._colorTexture],depthStencilTexture:this._depthStencilTexture,depthStencilRenderbuffer:this._depthStencilRenderbuffer,destroyAttachments:!1}),this._idFramebuffer=new u["a"]({context:e,colorTextures:[this._idTexture],depthStencilTexture:this._depthStencilIdTexture,depthStencilRenderbuffer:this._depthStencilIdRenderbuffer,destroyAttachments:!1})}},g.prototype.clear=function(e,t,i){var r=t.framebuffer;t.framebuffer=this._framebuffer,a["a"].clone(i,this._clearCommand.color),this._clearCommand.execute(e,t),t.framebuffer=this._idFramebuffer,a["a"].clone(this._idClearColor,this._clearCommand.color),this._clearCommand.execute(e,t),t.framebuffer=r},g.prototype.getFramebuffer=function(){return this._framebuffer},g.prototype.getIdFramebuffer=function(){return this._idFramebuffer},g.prototype.isDestroyed=function(){return!1},g.prototype.destroy=function(){return v(this),Object(o["a"])(this)},t["a"]=g},a307:function(e,t,i){"use strict";var a=i("0e25"),r={MORPHING:0,COLUMBUS_VIEW:1,SCENE2D:2,SCENE3D:3,getMorphTime:function(e){return e===r.SCENE3D?1:e!==r.MORPHING?0:void 0}};t["a"]=Object(a["a"])(r)},da97:function(e,t,i){"use strict";var a=i("77af"),r=i("cef5"),o=i("b482"),n=i("be18"),s=i("a561"),u=i("bef8"),c=i("dc1c"),m=i("bd8d"),d=i("9541"),h=i("71ce"),p=i("2384"),l=i("535a"),f=i("2f63"),_=i("9f1d"),g=i("45c5"),v=i("7d62"),b=i("6cae"),C=i("21d7"),w=i("3d7f"),S=i("d940"),T=i("c1e2"),D=i("66bf"),y=i("5ed2"),E=i("93da"),O=i("52f0"),x=i("4b0f"),P=i("f0be"),R=i("713f"),F=i("c34a"),M=i("4e1a"),I=i("4dc8"),j=i("75b2"),N=i("6a29"),L=i("f806"),A=i("f845"),V=i("aec5"),B=i("de02"),k=i("b997"),W=i("a894"),U=i("d289"),G=i("6dc0"),H=i("e90c"),z=i("5770"),q=i("1331"),Q=i("9dbf"),Y=i("d150"),Z=i("56d3"),K=i("0b8f"),J=i("c965"),X=i("81e1"),$=i("ed8b"),ee=i("9cff"),te=i("0838"),ie=i("f3b8"),ae=i("6f08"),re=i("d57b"),oe=i("4436"),ne=i("482f"),se=i("1b40"),ue=i("01c0"),ce=i("3a8e"),me=i("d572"),de=i("9e4a"),he=i("894b"),pe=i("738d"),le=i("a307"),fe=i("0c80"),_e=i("55f9"),ge=i("2ac3"),ve=i("1863"),be=i("2f48");function Ce(e){this._scene=e,this._currentTweens=[],this._morphHandler=void 0,this._morphCancelled=!1,this._completeMorph=void 0,this._morphToOrthographic=!1}Ce.prototype.completeMorph=function(){Object(f["a"])(this._completeMorph)&&this._completeMorph()},Ce.prototype.morphTo2D=function(e,t){Object(f["a"])(this._completeMorph)&&this._completeMorph();var i=this._scene;this._previousMode=i.mode,this._morphToOrthographic=i.camera.frustum instanceof R["a"],this._previousMode!==le["a"].SCENE2D&&this._previousMode!==le["a"].MORPHING&&(this._scene.morphStart.raiseEvent(this,this._previousMode,le["a"].SCENE2D,!0),i._mode=le["a"].MORPHING,i.camera._setTransform(O["a"].IDENTITY),this._previousMode===le["a"].COLUMBUS_VIEW?lt(this,e):St(this,e,t),0===e&&Object(f["a"])(this._completeMorph)&&this._completeMorph())};var we=new n["a"],Se=new n["a"],Te=new n["a"],De=new n["a"],ye=new n["a"],Ee=new n["a"],Oe=new n["a"],xe=new u["a"],Pe=new O["a"],Re=new M["a"],Fe=new R["a"],Me={position:void 0,direction:void 0,up:void 0,position2D:void 0,direction2D:void 0,up2D:void 0,frustum:void 0};Ce.prototype.morphToColumbusView=function(e,t){Object(f["a"])(this._completeMorph)&&this._completeMorph();var i=this._scene;if(this._previousMode=i.mode,this._previousMode!==le["a"].COLUMBUS_VIEW&&this._previousMode!==le["a"].MORPHING){this._scene.morphStart.raiseEvent(this,this._previousMode,le["a"].COLUMBUS_VIEW,!0),i.camera._setTransform(O["a"].IDENTITY);var a,r=we,o=Se,s=Te;if(e>0)r.x=0,r.y=-1,r.z=1,r=n["a"].multiplyByScalar(n["a"].normalize(r,r),5*t.maximumRadius,r),n["a"].negate(n["a"].normalize(r,o),o),n["a"].cross(n["a"].UNIT_X,o,s);else{var u=i.camera;if(this._previousMode===le["a"].SCENE2D)n["a"].clone(u.position,r),r.z=u.frustum.right-u.frustum.left,n["a"].negate(n["a"].UNIT_Z,o),n["a"].clone(n["a"].UNIT_Y,s);else{n["a"].clone(u.positionWC,r),n["a"].clone(u.directionWC,o),n["a"].clone(u.upWC,s);var c=t.scaleToGeodeticSurface(r,Oe),m=L["a"].eastNorthUpToFixedFrame(c,t,Pe);O["a"].inverseTransformation(m,m),i.mapProjection.project(t.cartesianToCartographic(r,xe),r),O["a"].multiplyByPointAsVector(m,o,o),O["a"].multiplyByPointAsVector(m,s,s)}}this._morphToOrthographic?(a=Fe,a.width=i.camera.frustum.right-i.camera.frustum.left,a.aspectRatio=i.drawingBufferWidth/i.drawingBufferHeight):(a=Re,a.aspectRatio=i.drawingBufferWidth/i.drawingBufferHeight,a.fov=E["a"].toRadians(60));var d=Me;d.position=r,d.direction=o,d.up=s,d.frustum=a;var h=Pt(d);Ne(this,h),this._previousMode===le["a"].SCENE2D?Dt(this,e,d,h):(d.position2D=O["a"].multiplyByPoint(Q["a"].TRANSFORM_2D,r,De),d.direction2D=O["a"].multiplyByPointAsVector(Q["a"].TRANSFORM_2D,o,ye),d.up2D=O["a"].multiplyByPointAsVector(Q["a"].TRANSFORM_2D,s,Ee),i._mode=le["a"].MORPHING,yt(this,e,d,h)),0===e&&Object(f["a"])(this._completeMorph)&&this._completeMorph()}};var Ie={position:new n["a"],direction:new n["a"],up:new n["a"],frustum:void 0},je=new M["a"];function Ne(e,t){if(e._scene.completeMorphOnUserInput){e._morphHandler=new ve["a"](e._scene.canvas);var i=function(){e._morphCancelled=!0,e._scene.camera.cancelFlight(),t(e)};e._completeMorph=i,e._morphHandler.setInputAction(i,be["a"].LEFT_DOWN),e._morphHandler.setInputAction(i,be["a"].MIDDLE_DOWN),e._morphHandler.setInputAction(i,be["a"].RIGHT_DOWN),e._morphHandler.setInputAction(i,be["a"].WHEEL)}}function Le(e){for(var t=e._currentTweens,i=0;i<t.length;++i)t[i].cancelTween();e._currentTweens.length=0,e._morphHandler=e._morphHandler&&e._morphHandler.destroy()}Ce.prototype.morphTo3D=function(e,t){Object(f["a"])(this._completeMorph)&&this._completeMorph();var i=this._scene;if(this._previousMode=i.mode,this._previousMode!==le["a"].SCENE3D&&this._previousMode!==le["a"].MORPHING){if(this._scene.morphStart.raiseEvent(this,this._previousMode,le["a"].SCENE3D,!0),i._mode=le["a"].MORPHING,i.camera._setTransform(O["a"].IDENTITY),this._previousMode===le["a"].SCENE2D)tt(this,e,t);else{var a,r;e>0?(a=Ie,n["a"].fromDegrees(0,0,5*t.maximumRadius,t,a.position),n["a"].negate(a.position,a.direction),n["a"].normalize(a.direction,a.direction),n["a"].clone(n["a"].UNIT_Z,a.up)):a=ke(this,t);var o=i.camera;o.frustum instanceof R["a"]?r=o.frustum.clone():(r=je,r.aspectRatio=i.drawingBufferWidth/i.drawingBufferHeight,r.fov=E["a"].toRadians(60)),a.frustum=r;var s=Ot(a);Ne(this,s),Qe(this,e,a,s)}0===e&&Object(f["a"])(this._completeMorph)&&this._completeMorph()}},Ce.prototype.isDestroyed=function(){return!1},Ce.prototype.destroy=function(){return Le(this),Object(v["a"])(this)};var Ae=new u["a"],Ve=new n["a"],Be=new O["a"];function ke(e,t){var i=e._scene,a=i.camera,r=Ie,o=r.position,n=r.direction,s=r.up,u=i.mapProjection.unproject(a.position,Ae);t.cartographicToCartesian(u,o);var c=t.scaleToGeodeticSurface(o,Ve),m=L["a"].eastNorthUpToFixedFrame(c,t,Be);return O["a"].multiplyByPointAsVector(m,a.direction,n),O["a"].multiplyByPointAsVector(m,a.up,s),r}var We=new n["a"],Ue=new n["a"],Ge=new n["a"],He=new n["a"],ze=new n["a"],qe=new n["a"];function Qe(e,t,i,a){t*=.5;var r=e._scene,o=r.camera,s=n["a"].clone(o.position,We),u=n["a"].clone(o.direction,Ue),c=n["a"].clone(o.up,Ge),m=O["a"].multiplyByPoint(Q["a"].TRANSFORM_2D_INVERSE,i.position,He),d=O["a"].multiplyByPointAsVector(Q["a"].TRANSFORM_2D_INVERSE,i.direction,ze),h=O["a"].multiplyByPointAsVector(Q["a"].TRANSFORM_2D_INVERSE,i.up,qe);function p(e){it(s,m,e.time,o.position),it(u,d,e.time,o.direction),it(c,h,e.time,o.up),n["a"].cross(o.direction,o.up,o.right),n["a"].normalize(o.right,o.right)}var l=r.tweens.add({duration:t,easingFunction:_e["a"].QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:p,complete:function(){Et(e,r,0,1,t,a)}});e._currentTweens.push(l)}var Ye=new R["a"],Ze=new n["a"],Ke=new n["a"],Je=new n["a"],Xe=new n["a"],$e=new n["a"],et=new n["a"];function tt(e,t,i){t/=3;var a,r,o=e._scene,s=o.camera;t>0?(a=Ie,n["a"].fromDegrees(0,0,5*i.maximumRadius,i,a.position),n["a"].negate(a.position,a.direction),n["a"].normalize(a.direction,a.direction),n["a"].clone(n["a"].UNIT_Z,a.up)):(s.position.z=s.frustum.right-s.frustum.left,a=ke(e,i)),e._morphToOrthographic?(r=Ye,r.aspectRatio=o.drawingBufferWidth/o.drawingBufferHeight,r.width=s.frustum.right-s.frustum.left):(r=je,r.aspectRatio=o.drawingBufferWidth/o.drawingBufferHeight,r.fov=E["a"].toRadians(60)),a.frustum=r;var u,c=Ot(a);Ne(e,c),u=e._morphToOrthographic?function(){Qe(e,t,a,c)}:function(){Tt(e,t,a,(function(){Qe(e,t,a,c)}))},t>0?(o._mode=le["a"].SCENE2D,s.flyTo({duration:t,destination:n["a"].fromDegrees(0,0,5*i.maximumRadius,i,Xe),complete:function(){o._mode=le["a"].MORPHING,u()}})):u()}function it(e,t,i,a){return n["a"].lerp(e,t,i,a)}function at(e,t,i,a,r){var o=e._scene,n=o.camera;if(!(n.frustum instanceof R["a"])){var s=n.frustum.fov,u=.5*E["a"].RADIANS_PER_DEGREE,c=i.position.z*Math.tan(.5*s);n.frustum.far=c/Math.tan(.5*u)+1e7;var m=o.tweens.add({duration:t,easingFunction:_e["a"].QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:d,complete:function(){n.frustum=i.frustum.clone(),r(e)}});e._currentTweens.push(m)}function d(e){n.frustum.fov=E["a"].lerp(s,u,e.time);var t=c/Math.tan(.5*n.frustum.fov);a(n,t)}}var rt=new n["a"],ot=new n["a"],nt=new n["a"],st=new n["a"],ut=new n["a"],ct=new n["a"],mt=new F["a"],dt=new ge["a"],ht=new n["a"],pt={position:void 0,direction:void 0,up:void 0,frustum:void 0};function lt(e,t){t*=.5;var i=e._scene,a=i.camera,r=n["a"].clone(a.position,rt),o=n["a"].clone(a.direction,ot),s=n["a"].clone(a.up,nt),u=n["a"].negate(n["a"].UNIT_Z,ut),c=n["a"].clone(n["a"].UNIT_Y,ct),m=st;if(t>0)n["a"].clone(n["a"].ZERO,st),m.z=5*i.mapProjection.ellipsoid.maximumRadius;else{n["a"].clone(r,st);var d=dt;O["a"].multiplyByPoint(Q["a"].TRANSFORM_2D,r,d.origin),O["a"].multiplyByPointAsVector(Q["a"].TRANSFORM_2D,o,d.direction);var h=i.globe;if(Object(f["a"])(h)){var p=h.pickWorldCoordinates(d,i,ht);Object(f["a"])(p)&&(O["a"].multiplyByPoint(Q["a"].TRANSFORM_2D_INVERSE,p,m),m.z+=n["a"].distance(r,m))}}var l=mt;l.right=.5*m.z,l.left=-l.right,l.top=l.right*(i.drawingBufferHeight/i.drawingBufferWidth),l.bottom=-l.top;var _=pt;_.position=m,_.direction=u,_.up=c,_.frustum=l;var g=xt(_);function v(e){it(r,m,e.time,a.position),it(o,u,e.time,a.direction),it(s,c,e.time,a.up),n["a"].cross(a.direction,a.up,a.right),n["a"].normalize(a.right,a.right),a._adjustOrthographicFrustum(!0)}function b(e,t){e.position.z=t}Ne(e,g);var C=i.tweens.add({duration:t,easingFunction:_e["a"].QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:v,complete:function(){at(e,t,_,b,g)}});e._currentTweens.push(C)}var ft=new u["a"],_t={position:new n["a"],direction:new n["a"],up:new n["a"],position2D:new n["a"],direction2D:new n["a"],up2D:new n["a"],frustum:new F["a"]},gt={position:new n["a"],direction:new n["a"],up:new n["a"],frustum:void 0},vt=new n["a"],bt=new ge["a"],Ct=new O["a"],wt=new n["a"];function St(e,t,i){t*=.5;var a=e._scene,r=a.camera,o=_t;if(t>0)n["a"].clone(n["a"].ZERO,o.position),o.position.z=5*i.maximumRadius,n["a"].negate(n["a"].UNIT_Z,o.direction),n["a"].clone(n["a"].UNIT_Y,o.up);else{i.cartesianToCartographic(r.positionWC,ft),a.mapProjection.project(ft,o.position),n["a"].negate(n["a"].UNIT_Z,o.direction),n["a"].clone(n["a"].UNIT_Y,o.up);var s=bt;n["a"].clone(o.position2D,s.origin);var u=n["a"].clone(r.directionWC,s.direction),c=i.scaleToGeodeticSurface(r.positionWC,wt),m=L["a"].eastNorthUpToFixedFrame(c,i,Ct);O["a"].inverseTransformation(m,m),O["a"].multiplyByPointAsVector(m,u,u),O["a"].multiplyByPointAsVector(Q["a"].TRANSFORM_2D,u,u);var d=a.globe;if(Object(f["a"])(d)){var h=d.pickWorldCoordinates(s,a,vt);if(Object(f["a"])(h)){var p=n["a"].distance(o.position2D,h);h.x+=p,n["a"].clone(h,o.position2D)}}}function l(e,t){e.position.x=t}O["a"].multiplyByPoint(Q["a"].TRANSFORM_2D,o.position,o.position2D),O["a"].multiplyByPointAsVector(Q["a"].TRANSFORM_2D,o.direction,o.direction2D),O["a"].multiplyByPointAsVector(Q["a"].TRANSFORM_2D,o.up,o.up2D);var _=o.frustum;_.right=.5*o.position.z,_.left=-_.right,_.top=_.right*(a.drawingBufferHeight/a.drawingBufferWidth),_.bottom=-_.top;var g=gt;O["a"].multiplyByPoint(Q["a"].TRANSFORM_2D_INVERSE,o.position2D,g.position),n["a"].clone(o.direction,g.direction),n["a"].clone(o.up,g.up),g.frustum=_;var v=xt(g);function b(){at(e,t,o,l,v)}Ne(e,v),yt(e,t,o,b)}function Tt(e,t,i,a){var r=e._scene,o=r.camera,n=o.frustum.right-o.frustum.left;o.frustum=i.frustum.clone();var s=o.frustum.fov,u=.5*E["a"].RADIANS_PER_DEGREE,c=n*Math.tan(.5*s);function m(e){o.frustum.fov=E["a"].lerp(u,s,e.time),o.position.z=c/Math.tan(.5*o.frustum.fov)}o.frustum.far=c/Math.tan(.5*u)+1e7,o.frustum.fov=u;var d=r.tweens.add({duration:t,easingFunction:_e["a"].QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:m,complete:function(){a(e)}});e._currentTweens.push(d)}function Dt(e,t,i,a){t*=.5;var r=e._scene,o=r.camera,s=n["a"].clone(i.position,Xe),u=n["a"].clone(i.direction,$e),c=n["a"].clone(i.up,et);function m(){o.frustum=i.frustum.clone();var m=n["a"].clone(o.position,Ze),d=n["a"].clone(o.direction,Ke),h=n["a"].clone(o.up,Je);function p(e){it(m,s,e.time,o.position),it(d,u,e.time,o.direction),it(h,c,e.time,o.up),n["a"].cross(o.direction,o.up,o.right),n["a"].normalize(o.right,o.right)}m.z=s.z;var l=r.tweens.add({duration:t,easingFunction:_e["a"].QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:p,complete:function(){a(e)}});e._currentTweens.push(l)}r._mode=le["a"].MORPHING,e._morphToOrthographic?m():Tt(e,0,i,m)}function yt(e,t,i,a){var r=e._scene,o=r.camera,s=n["a"].clone(o.position,Ze),u=n["a"].clone(o.direction,Ke),c=n["a"].clone(o.up,Je),m=n["a"].clone(i.position2D,Xe),d=n["a"].clone(i.direction2D,$e),h=n["a"].clone(i.up2D,et);function p(e){it(s,m,e.time,o.position),it(u,d,e.time,o.direction),it(c,h,e.time,o.up),n["a"].cross(o.direction,o.up,o.right),n["a"].normalize(o.right,o.right),o._adjustOrthographicFrustum(!0)}var l=r.tweens.add({duration:t,easingFunction:_e["a"].QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:p,complete:function(){Et(e,r,1,0,t,a)}});e._currentTweens.push(l)}function Et(e,t,i,a,r,o){var n={object:t,property:"morphTime",startValue:i,stopValue:a,duration:r,easingFunction:_e["a"].QUARTIC_OUT};Object(f["a"])(o)&&(n.complete=function(){o(e)});var s=t.tweens.addProperty(n);e._currentTweens.push(s)}function Ot(e){return function(t){var i=t._scene;i._mode=le["a"].SCENE3D,i.morphTime=le["a"].getMorphTime(le["a"].SCENE3D),Le(t);var a=i.camera;(t._previousMode!==le["a"].MORPHING||t._morphCancelled)&&(t._morphCancelled=!1,n["a"].clone(e.position,a.position),n["a"].clone(e.direction,a.direction),n["a"].clone(e.up,a.up),n["a"].cross(a.direction,a.up,a.right),n["a"].normalize(a.right,a.right),a.frustum=e.frustum.clone());var r=a.frustum;i.frameState.useLogDepth&&(r.near=.1,r.far=1e10);var o=Object(f["a"])(t._completeMorph);t._completeMorph=void 0,i.camera.update(i.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,le["a"].SCENE3D,o)}}function xt(e){return function(t){var i=t._scene;i._mode=le["a"].SCENE2D,i.morphTime=le["a"].getMorphTime(le["a"].SCENE2D),Le(t);var a=i.camera;n["a"].clone(e.position,a.position),a.position.z=2*i.mapProjection.ellipsoid.maximumRadius,n["a"].clone(e.direction,a.direction),n["a"].clone(e.up,a.up),n["a"].cross(a.direction,a.up,a.right),n["a"].normalize(a.right,a.right),a.frustum=e.frustum.clone();var r=Object(f["a"])(t._completeMorph);t._completeMorph=void 0,i.camera.update(i.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,le["a"].SCENE2D,r)}}function Pt(e){return function(t){var i=t._scene;i._mode=le["a"].COLUMBUS_VIEW,i.morphTime=le["a"].getMorphTime(le["a"].COLUMBUS_VIEW),Le(t);var a=i.camera;(t._previousModeMode!==le["a"].MORPHING||t._morphCancelled)&&(t._morphCancelled=!1,n["a"].clone(e.position,a.position),n["a"].clone(e.direction,a.direction),n["a"].clone(e.up,a.up),n["a"].cross(a.direction,a.up,a.right),n["a"].normalize(a.right,a.right));var r=a.frustum;i.frameState.useLogDepth&&(r.near=.1,r.far=1e10);var o=Object(f["a"])(t._completeMorph);t._completeMorph=void 0,i.camera.update(i.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,le["a"].COLUMBUS_VIEW,o)}}var Rt=Ce,Ft=i("59d5"),Mt=i("569f"),It=i("3626"),jt=i("e065"),Nt=i("cdd6"),Lt=i("619f"),At=i("ef77"),Vt=function(e){return function(){e.frameState.afterRender.push((function(){e.requestRender()}))}};function Bt(e){e=Object(l["a"])(e,l["a"].EMPTY_OBJECT);var t=e.canvas,i=e.creditContainer,r=e.creditViewport,o=Object(c["a"])(e.contextOptions);Object(f["a"])(o)||(o={}),Object(f["a"])(o.webgl)||(o.webgl={}),o.webgl.powerPreference=Object(l["a"])(o.webgl.powerPreference,"high-performance");var n=Object(f["a"])(i),s=new B["a"](t,o);n||(i=document.createElement("div"),i.style.position="absolute",i.style.bottom="0",i.style["text-shadow"]="0 0 2px #000000",i.style.color="#ffffff",i.style["font-size"]="10px",i.style["padding-right"]="5px",t.parentNode.appendChild(i)),Object(f["a"])(r)||(r=t.parentNode),this._id=Object(h["a"])(),this._jobScheduler=new oe["a"],this._frameState=new ie["a"](s,new K["a"](i," • ",r),this._jobScheduler),this._frameState.scene3DOnly=Object(l["a"])(e.scene3DOnly,!1),this._removeCreditContainer=!n,this._creditContainer=i,this._canvas=t,this._context=s,this._computeEngine=new V["a"](s),this._globe=void 0,this._primitives=new pe["a"],this._groundPrimitives=new pe["a"],this._logDepthBuffer=s.fragmentDepth,this._logDepthBufferDirty=!0,this._tweens=new Lt["a"],this._shaderFrameCount=0,this._sunPostProcess=void 0,this._computeCommandList=[],this._overlayCommandList=[],this._useOIT=Object(l["a"])(e.orderIndependentTranslucency,!0),this._executeOITFunction=void 0,this._depthPlane=new X["a"],this._clearColorCommand=new A["a"]({color:new m["a"],stencil:0,owner:this}),this._depthClearCommand=new A["a"]({depth:1,owner:this}),this._stencilClearCommand=new A["a"]({stencil:0}),this._classificationStencilClearCommand=new A["a"]({stencil:0,renderState:G["a"].fromCache({stencilMask:It["a"].CLASSIFICATION_MASK})}),this._depthOnlyRenderStateCache={},this._transitioner=new Rt(this),this._preUpdate=new C["a"],this._postUpdate=new C["a"],this._renderError=new C["a"],this._preRender=new C["a"],this._postRender=new C["a"],this._minimumDisableDepthTestDistance=0,this.rethrowRenderErrors=!1,this.completeMorphOnUserInput=!0,this.morphStart=new C["a"],this.morphComplete=new C["a"],this.skyBox=void 0,this.skyAtmosphere=void 0,this.sun=void 0,this.sunBloom=!0,this._sunBloom=void 0,this.moon=void 0,this.backgroundColor=m["a"].clone(m["a"].BLACK),this._mode=le["a"].SCENE3D,this._mapProjection=Object(f["a"])(e.mapProjection)?e.mapProjection:new w["a"],this.morphTime=1,this.farToNearRatio=1e3,this.logarithmicDepthFarToNearRatio=1e9,this.nearToFarDistance2D=175e4,this.debugCommandFilter=void 0,this.debugShowCommands=!1,this.debugShowFrustums=!1,this.debugShowFramesPerSecond=!1,this.debugShowGlobeDepth=!1,this.debugShowDepthFrustum=1,this.debugShowFrustumPlanes=!1,this._debugShowFrustumPlanes=!1,this._debugFrustumPlanes=void 0,this.useDepthPicking=!0,this.pickTranslucentDepth=!1,this.cameraEventWaitTime=500,this.fog=new te["a"],this._shadowMapCamera=new Q["a"](this),this.shadowMap=new Mt["a"]({context:s,lightCamera:this._shadowMapCamera,enabled:Object(l["a"])(e.shadows,!1)}),this.invertClassification=!1,this.invertClassificationColor=m["a"].clone(m["a"].WHITE),this._actualInvertClassificationColor=m["a"].clone(this._invertClassificationColor),this._invertClassification=new re["a"],this.focalLength=void 0,this.eyeSeparation=void 0,this.postProcessStages=new de["a"],this._brdfLutGenerator=new q["a"],this._terrainExaggeration=Object(l["a"])(e.terrainExaggeration,1),this._performanceDisplay=void 0,this._debugVolume=void 0,this._screenSpaceCameraController=new Ft["a"](this),this._mapMode2D=Object(l["a"])(e.mapMode2D,ne["a"].INFINITE_SCROLL),this._environmentState={skyBoxCommand:void 0,skyAtmosphereCommand:void 0,sunDrawCommand:void 0,sunComputeCommand:void 0,moonCommand:void 0,isSunVisible:!1,isMoonVisible:!1,isReadyForAtmosphere:!1,isSkyAtmosphereVisible:!1,clearGlobeDepth:!1,useDepthPlane:!1,renderTranslucentDepthForPick:!1,originalFramebuffer:void 0,useGlobeDepthFramebuffer:!1,separatePrimitiveFramebuffer:!1,useOIT:!1,useInvertClassification:!1,usePostProcess:!1,usePostProcessSelected:!1,useWebVR:!1},this._useWebVR=!1,this._cameraVR=void 0,this._aspectRatioVR=void 0,this.requestRenderMode=Object(l["a"])(e.requestRenderMode,!1),this._renderRequested=!0,this.maximumRenderTimeChange=Object(l["a"])(e.maximumRenderTimeChange,0),this._lastRenderTime=void 0,this._frameRateMonitor=void 0,this._removeRequestListenerCallback=j["a"].requestCompletedEvent.addEventListener(Vt(this)),this._removeTaskProcessorListenerCallback=N["a"].taskCompletedEvent.addEventListener(Vt(this)),this._removeGlobeCallbacks=[];var u=new a["a"](0,0,s.drawingBufferWidth,s.drawingBufferHeight),d=new Q["a"](this);this._logDepthBuffer&&(d.frustum.near=.1,d.frustum.far=1e10),this.preloadFlightCamera=new Q["a"](this),this.preloadFlightCullingVolume=void 0,this._picking=new me["a"](this),this._defaultView=new At["a"](this,d,u),this._view=this._defaultView,this._hdr=void 0,this._hdrDirty=void 0,this.highDynamicRange=!1,this.gamma=2.2,this.sphericalHarmonicCoefficients=void 0,this.specularEnvironmentMaps=void 0,this._specularEnvironmentMapAtlas=void 0,this.light=new jt["a"],Kt(this,0,y["a"].now()),this.updateFrameState(),this.initializeFrame()}function kt(e,t){for(var i=0;i<e._removeGlobeCallbacks.length;++i)e._removeGlobeCallbacks[i]();e._removeGlobeCallbacks.length=0;var a=[];Object(f["a"])(t)&&(a.push(t.imageryLayersUpdatedEvent.addEventListener(Vt(e))),a.push(t.terrainProviderChanged.addEventListener(Vt(e)))),e._removeGlobeCallbacks=a}var Wt=new s["a"];function Ut(e,t,i){var a=e._frameState,r=e._context,o=e._view.oit,n=a.shadowState.lightShadowMaps,s=a.shadowState.lightShadowsEnabled,u=t.derivedCommands;Object(f["a"])(t.pickId)&&(u.picking=$["a"].createPickDerivedCommand(e,t,r,u.picking)),t.pickOnly||(u.depth=$["a"].createDepthOnlyDerivedCommand(e,t,r,u.depth)),u.originalCommand=t,e._hdr&&(u.hdr=$["a"].createHdrCommand(t,r,u.hdr),t=u.hdr.command,u=t.derivedCommands),s&&t.receiveShadows&&(u.shadows=Mt["a"].createReceiveDerivedCommand(n,t,i,r,u.shadows)),t.pass===U["a"].TRANSLUCENT&&Object(f["a"])(o)&&o.isSupported()&&(s&&t.receiveShadows?(u.oit=Object(f["a"])(u.oit)?u.oit:{},u.oit.shadows=o.createDerivedCommands(u.shadows.receiveCommand,r,u.oit.shadows)):u.oit=o.createDerivedCommands(t,r,u.oit))}Object(_["a"])(Bt.prototype,{canvas:{get:function(){return this._canvas}},drawingBufferHeight:{get:function(){return this._context.drawingBufferHeight}},drawingBufferWidth:{get:function(){return this._context.drawingBufferWidth}},maximumAliasedLineWidth:{get:function(){return k["a"].maximumAliasedLineWidth}},maximumCubeMapSize:{get:function(){return k["a"].maximumCubeMapSize}},pickPositionSupported:{get:function(){return this._context.depthTexture}},sampleHeightSupported:{get:function(){return this._context.depthTexture}},clampToHeightSupported:{get:function(){return this._context.depthTexture}},invertClassificationSupported:{get:function(){return this._context.depthTexture}},specularEnvironmentMapsSupported:{get:function(){return se["a"].isSupported(this._context)}},globe:{get:function(){return this._globe},set:function(e){this._globe=this._globe&&this._globe.destroy(),this._globe=e,kt(this,e)}},primitives:{get:function(){return this._primitives}},groundPrimitives:{get:function(){return this._groundPrimitives}},camera:{get:function(){return this._view.camera},set:function(e){this._view.camera=e}},view:{get:function(){return this._view},set:function(e){this._view=e}},defaultView:{get:function(){return this._defaultView}},picking:{get:function(){return this._picking}},screenSpaceCameraController:{get:function(){return this._screenSpaceCameraController}},mapProjection:{get:function(){return this._mapProjection}},jobScheduler:{get:function(){return this._jobScheduler}},frameState:{get:function(){return this._frameState}},environmentState:{get:function(){return this._environmentState}},tweens:{get:function(){return this._tweens}},imageryLayers:{get:function(){if(Object(f["a"])(this.globe))return this.globe.imageryLayers}},terrainProvider:{get:function(){if(Object(f["a"])(this.globe))return this.globe.terrainProvider},set:function(e){Object(f["a"])(this.globe)&&(this.globe.terrainProvider=e)}},terrainProviderChanged:{get:function(){if(Object(f["a"])(this.globe))return this.globe.terrainProviderChanged}},preUpdate:{get:function(){return this._preUpdate}},postUpdate:{get:function(){return this._postUpdate}},renderError:{get:function(){return this._renderError}},preRender:{get:function(){return this._preRender}},postRender:{get:function(){return this._postRender}},lastRenderTime:{get:function(){return this._lastRenderTime}},context:{get:function(){return this._context}},debugFrustumStatistics:{get:function(){return this._view.debugFrustumStatistics}},scene3DOnly:{get:function(){return this._frameState.scene3DOnly}},orderIndependentTranslucency:{get:function(){return this._useOIT}},id:{get:function(){return this._id}},mode:{get:function(){return this._mode},set:function(e){e===le["a"].SCENE2D?this.morphTo2D(0):e===le["a"].SCENE3D?this.morphTo3D(0):e===le["a"].COLUMBUS_VIEW&&this.morphToColumbusView(0),this._mode=e}},frustumCommandsList:{get:function(){return this._view.frustumCommandsList}},numberOfFrustums:{get:function(){return this._view.frustumCommandsList.length}},terrainExaggeration:{get:function(){return this._terrainExaggeration}},useWebVR:{get:function(){return this._useWebVR},set:function(e){this._useWebVR=e,this._useWebVR?(this._frameState.creditDisplay.container.style.visibility="hidden",this._cameraVR=new Q["a"](this),Object(f["a"])(this._deviceOrientationCameraController)||(this._deviceOrientationCameraController=new ee["a"](this)),this._aspectRatioVR=this.camera.frustum.aspectRatio):(this._frameState.creditDisplay.container.style.visibility="visible",this._cameraVR=void 0,this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this.camera.frustum.aspectRatio=this._aspectRatioVR,this.camera.frustum.xOffset=0)}},mapMode2D:{get:function(){return this._mapMode2D}},imagerySplitPosition:{get:function(){return this._frameState.imagerySplitPosition},set:function(e){this._frameState.imagerySplitPosition=e}},minimumDisableDepthTestDistance:{get:function(){return this._minimumDisableDepthTestDistance},set:function(e){this._minimumDisableDepthTestDistance=e}},logarithmicDepthBuffer:{get:function(){return this._logDepthBuffer},set:function(e){e=this._context.fragmentDepth&&e,this._logDepthBuffer!==e&&(this._logDepthBuffer=e,this._logDepthBufferDirty=!0,this._defaultView.updateFrustums=!0)}},gamma:{get:function(){return this._context.uniformState.gamma},set:function(e){this._context.uniformState.gamma=e}},highDynamicRange:{get:function(){return this._hdr},set:function(e){var t=this._context,i=e&&t.depthTexture&&(t.colorBufferFloat||t.colorBufferHalfFloat);this._hdrDirty=i!==this._hdr,this._hdr=i}},highDynamicRangeSupported:{get:function(){var e=this._context;return e.depthTexture&&(e.colorBufferFloat||e.colorBufferHalfFloat)}},sunColor:{get:function(){return Object(g["a"])("sun-color-removed","scene.sunColor will be removed in Cesium 1.69. Use scene.light.color and scene.light.intensity instead."),this.light.color},set:function(e){Object(g["a"])("sun-color-removed","scene.sunColor will be removed in Cesium 1.69. Use scene.light.color and scene.light.intensity instead.");var t=n["a"].maximumComponent(e),i=s["a"].fromElements(e.x,e.y,e.z,1,Wt),a=1;t>1&&(n["a"].divideByScalar(i,t,i),a=t),this.light.color=m["a"].fromCartesian4(i,this.light.color),this.light.intensity=a}},pixelRatio:{get:function(){return this._frameState.pixelRatio},set:function(e){this._frameState.pixelRatio=e}},opaqueFrustumNearOffset:{get:function(){return this._frameState.useLogDepth?.9:.9999}}}),Bt.prototype.getCompressedTextureFormatSupported=function(e){var t=this.context;return("WEBGL_compressed_texture_s3tc"===e||"s3tc"===e)&&t.s3tc||("WEBGL_compressed_texture_pvrtc"===e||"pvrtc"===e)&&t.pvrtc||("WEBGL_compressed_texture_etc1"===e||"etc1"===e)&&t.etc1},Bt.prototype.updateDerivedCommands=function(e){if(Object(f["a"])(e.derivedCommands)){var t=this._frameState,i=this._context,a=!1,r=t.shadowState.lastDirtyTime;e.lastDirtyTime!==r&&(e.lastDirtyTime=r,e.dirty=!0,a=!0);var o=t.useLogDepth,n=this._hdr,s=e.derivedCommands,u=Object(f["a"])(s.logDepth),c=Object(f["a"])(s.hdr),m=Object(f["a"])(s.originalCommand),d=o&&!u,h=n&&!c,p=(!o||!n)&&!m;if(e.dirty=e.dirty||d||h||p,e.dirty){e.dirty=!1;var l=t.shadowState.shadowMaps,_=t.shadowState.shadowsEnabled;_&&e.castShadows&&(s.shadows=Mt["a"].createCastDerivedCommand(l,e,a,i,s.shadows)),(u||d)&&(s.logDepth=$["a"].createLogDepthCommand(e,i,s.logDepth),Ut(this,s.logDepth.command,a)),(m||p)&&Ut(this,e,a)}}};var Gt,Ht=new Z["a"]({pass:Y["a"].RENDER}),zt=new Z["a"]({pass:Y["a"].PRELOAD}),qt=new Z["a"]({pass:Y["a"].PRELOAD_FLIGHT}),Qt=new Z["a"]({pass:Y["a"].REQUEST_RENDER_MODE_DEFER_CHECK}),Yt=new r["a"];function Zt(e){var t=e.globe;if(e._mode===le["a"].SCENE3D&&Object(f["a"])(t)&&t.show){var i=t.ellipsoid,a=e.frameState.minimumTerrainHeight;return Yt.radius=i.minimumRadius+a,Gt=P["a"].fromBoundingSphere(Yt,e.camera.positionWC,Gt),Gt}}function Kt(e,t,i){var a=e._frameState;a.frameNumber=t,a.time=y["a"].clone(i,a.time)}function Jt(e){var t={},i=e.vertexAttributes;for(var a in i)i.hasOwnProperty(a)&&(t[a]=i[a].index);return t}function Xt(e,t,i){var a=t.context,r=Object(l["a"])(i,e.shaderProgram),o=r.fragmentShaderSource.clone(),n=[];o.sources=o.sources.map((function(e){e=z["a"].replaceMain(e,"czm_Debug_main");var t,i=/gl_FragData\[(\d+)\]/g;while(null!==(t=i.exec(e)))-1===n.indexOf(t[1])&&n.push(t[1]);return e}));var s,u=n.length,c="void main() \n{ \n    czm_Debug_main(); \n";if(t.debugShowCommands){Object(f["a"])(e._debugColor)||(e._debugColor=m["a"].fromRandom());var d=e._debugColor;if(u>0)for(s=0;s<u;++s)c+="    gl_FragData["+n[s]+"].rgb *= vec3("+d.red+", "+d.green+", "+d.blue+"); \n";else c+="    gl_FragColor.rgb *= vec3("+d.red+", "+d.green+", "+d.blue+"); \n"}if(t.debugShowFrustums){var h=1&e.debugOverlappingFrustums?"1.0":"0.0",p=2&e.debugOverlappingFrustums?"1.0":"0.0",_=4&e.debugOverlappingFrustums?"1.0":"0.0";if(u>0)for(s=0;s<u;++s)c+="    gl_FragData["+n[s]+"].rgb *= vec3("+h+", "+p+", "+_+"); \n";else c+="    gl_FragColor.rgb *= vec3("+h+", "+p+", "+_+"); \n"}c+="}",o.sources.push(c);var g=Jt(r);return H["a"].fromCache({context:a,vertexShaderSource:r.vertexShaderSource,fragmentShaderSource:o,attributeLocations:g})}function $t(e,t,i){var a=W["a"].shallowClone(e);a.shaderProgram=Xt(e,t),a.execute(t.context,i),a.shaderProgram.destroy()}Bt.prototype.clearPasses=function(e){e.render=!1,e.pick=!1,e.depth=!1,e.postProcess=!1,e.offscreen=!1},Bt.prototype.updateFrameState=function(){var e=this.camera,t=this._frameState;t.commandList.length=0,t.shadowMaps.length=0,t.brdfLutGenerator=this._brdfLutGenerator,t.environmentMap=this.skyBox&&this.skyBox._cubeMap,t.mode=this._mode,t.morphTime=this.morphTime,t.mapProjection=this.mapProjection,t.camera=e,t.cullingVolume=e.frustum.computeCullingVolume(e.positionWC,e.directionWC,e.upWC),t.occluder=Zt(this),t.terrainExaggeration=this._terrainExaggeration,t.minimumTerrainHeight=0,t.minimumDisableDepthTestDistance=this._minimumDisableDepthTestDistance,t.invertClassification=this.invertClassification,t.useLogDepth=this._logDepthBuffer&&!(this.camera.frustum instanceof R["a"]||this.camera.frustum instanceof F["a"]),t.light=this.light,Object(f["a"])(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.ready?(t.specularEnvironmentMaps=this._specularEnvironmentMapAtlas.texture,t.specularEnvironmentMapsMaximumLOD=this._specularEnvironmentMapAtlas.maximumMipmapLevel):(t.specularEnvironmentMaps=void 0,t.specularEnvironmentMapsMaximumLOD=void 0),t.sphericalHarmonicCoefficients=this.sphericalHarmonicCoefficients,this._actualInvertClassificationColor=m["a"].clone(this.invertClassificationColor,this._actualInvertClassificationColor),re["a"].isTranslucencySupported(this._context)||(this._actualInvertClassificationColor.alpha=1),t.invertClassificationColor=this._actualInvertClassificationColor,Object(f["a"])(this.globe)?t.maximumScreenSpaceError=this.globe.maximumScreenSpaceError:t.maximumScreenSpaceError=2,this.clearPasses(t.passes),t.tilesetPassState=void 0},Bt.prototype.isVisible=function(e,t,i){return Object(f["a"])(e)&&(!Object(f["a"])(e.boundingVolume)||!e.cull||t.computeVisibility(e.boundingVolume)!==D["a"].OUTSIDE&&(!Object(f["a"])(i)||!e.occlude||!e.boundingVolume.isOccluded(i)))};var ei=new O["a"](0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1);function ti(e,t,i,a){var r,s=t._frameState,u=s.context,c=e.boundingVolume;Object(f["a"])(t._debugVolume)&&t._debugVolume.destroy();var m=n["a"].clone(c.center);if(s.mode!==le["a"].SCENE3D){m=O["a"].multiplyByPoint(ei,m,m);var h=s.mapProjection,p=h.unproject(m);m=h.ellipsoid.cartographicToCartesian(p)}if(Object(f["a"])(c.radius)){var l=c.radius;r=T["a"].toWireframe(b["a"].createGeometry(new b["a"]({radii:new n["a"](l,l,l),vertexFormat:ce["a"].FLAT_VERTEX_FORMAT}))),t._debugVolume=new he["a"]({geometryInstances:new S["a"]({geometry:r,modelMatrix:O["a"].fromTranslation(m),attributes:{color:new d["a"](1,0,0,1)}}),appearance:new ce["a"]({flat:!0,translucent:!1}),asynchronous:!1})}else{var _=c.halfAxes;r=T["a"].toWireframe(o["a"].createGeometry(o["a"].fromDimensions({dimensions:new n["a"](2,2,2),vertexFormat:ce["a"].FLAT_VERTEX_FORMAT}))),t._debugVolume=new he["a"]({geometryInstances:new S["a"]({geometry:r,modelMatrix:O["a"].fromRotationTranslation(_,m,new O["a"]),attributes:{color:new d["a"](1,0,0,1)}}),appearance:new ce["a"]({flat:!0,translucent:!1}),asynchronous:!1})}var g,v=s.commandList,C=s.commandList=[];if(t._debugVolume.update(s),e=C[0],s.useLogDepth){var w=$["a"].createLogDepthCommand(e,u);e=w.command}Object(f["a"])(a)&&(g=i.framebuffer,i.framebuffer=a),e.execute(u,i),Object(f["a"])(g)&&(i.framebuffer=g),s.commandList=v}function ii(e,t,i,a,r){var o=t._frameState;if(!Object(f["a"])(t.debugCommandFilter)||t.debugCommandFilter(e))if(e instanceof A["a"])e.execute(i,a);else{e.debugShowBoundingVolume&&Object(f["a"])(e.boundingVolume)&&ti(e,t,a,r),o.useLogDepth&&Object(f["a"])(e.derivedCommands.logDepth)&&(e=e.derivedCommands.logDepth.command);var n=o.passes;if(!n.pick&&t._hdr&&Object(f["a"])(e.derivedCommands)&&Object(f["a"])(e.derivedCommands.hdr)&&(e=e.derivedCommands.hdr.command),n.pick||n.depth){if(n.pick&&!n.depth&&Object(f["a"])(e.derivedCommands.picking))return e=e.derivedCommands.picking.pickCommand,void e.execute(i,a);if(Object(f["a"])(e.derivedCommands.depth))return e=e.derivedCommands.depth.depthOnlyCommand,void e.execute(i,a)}t.debugShowCommands||t.debugShowFrustums?$t(e,t,a):o.shadowState.lightShadowsEnabled&&e.receiveShadows&&Object(f["a"])(e.derivedCommands.shadows)?e.derivedCommands.shadows.receiveCommand.execute(i,a):e.execute(i,a)}}function ai(e,t,i,a){var r=t._frameState,o=e.derivedCommands;Object(f["a"])(o)&&(r.useLogDepth&&Object(f["a"])(o.logDepth)&&(e=o.logDepth.command),o=e.derivedCommands,Object(f["a"])(o.picking)?(e=o.picking.pickCommand,e.execute(i,a)):Object(f["a"])(o.depth)&&(e=o.depth.depthOnlyCommand,e.execute(i,a)))}function ri(e,t,i){return t.boundingVolume.distanceSquaredTo(i)-e.boundingVolume.distanceSquaredTo(i)}function oi(e,t,i){return e.boundingVolume.distanceSquaredTo(i)-t.boundingVolume.distanceSquaredTo(i)+E["a"].EPSILON12}function ni(e,t,i,a,r){var o=e.context;Object(x["a"])(a,ri,e.camera.positionWC),Object(f["a"])(r)&&t(r.unclassifiedCommand,e,o,i);for(var n=a.length,s=0;s<n;++s)t(a[s],e,o,i)}function si(e,t,i,a,r){var o=e.context;Object(x["a"])(a,oi,e.camera.positionWC),Object(f["a"])(r)&&t(r.unclassifiedCommand,e,o,i);for(var n=a.length,s=0;s<n;++s)t(a[s],e,o,i)}function ui(e,t){var i=e._view.debugGlobeDepths,a=i[t];return!Object(f["a"])(a)&&e.context.depthTexture&&(a=new ae["a"],i[t]=a),a}ei=O["a"].inverseTransformation(ei,ei);var ci=new M["a"],mi=new I["a"],di=new R["a"],hi=new F["a"];function pi(e,t){var i,a=e.camera,r=e.context,o=r.uniformState;o.updateCamera(a),i=Object(f["a"])(a.frustum.fov)?a.frustum.clone(ci):Object(f["a"])(a.frustum.infiniteProjectionMatrix)?a.frustum.clone(mi):Object(f["a"])(a.frustum.width)?a.frustum.clone(di):a.frustum.clone(hi),i.near=a.frustum.near,i.far=a.frustum.far,o.updateFrustum(i),o.updatePass(U["a"].ENVIRONMENT);var n,s=e._frameState.passes,u=s.pick,c=e._environmentState,m=e._view,d=c.renderTranslucentDepthForPick,h=c.useWebVR;if(!u){var p,l=c.skyBoxCommand;if(Object(f["a"])(l)&&ii(l,e,r,t),c.isSkyAtmosphereVisible&&ii(c.skyAtmosphereCommand,e,r,t),c.isSunVisible)if(c.sunDrawCommand.execute(r,t),e.sunBloom&&!h)p=c.useGlobeDepthFramebuffer?m.globeDepth.framebuffer:c.usePostProcess?m.sceneFramebuffer.getFramebuffer():c.originalFramebuffer,e._sunPostProcess.execute(r),e._sunPostProcess.copy(r,p),t.framebuffer=p;c.isMoonVisible&&c.moonCommand.execute(r,t)}c.useOIT?(Object(f["a"])(e._executeOITFunction)||(e._executeOITFunction=function(e,t,i,a,r){m.oit.executeCommands(e,t,i,a,r)}),n=e._executeOITFunction):n=s.render?ni:si;for(var _,g=m.frustumCommandsList,v=g.length,b=c.clearGlobeDepth,C=c.useDepthPlane,w=c.separatePrimitiveFramebuffer=!1,S=e._depthClearCommand,T=e._stencilClearCommand,D=e._classificationStencilClearCommand,y=e._depthPlane,E=c.usePostProcessSelected,O=a.position.z,x=0;x<v;++x){var P=v-x-1,R=g[P];e.mode===le["a"].SCENE2D?(a.position.z=O-R.near+1,i.far=Math.max(1,R.far-R.near),i.near=1,o.update(e.frameState),o.updateFrustum(i)):(i.near=0!==P?R.near*e.opaqueFrustumNearOffset:R.near,i.far=R.far,o.updateFrustum(i));var F,M=e.debugShowGlobeDepth?ui(e,P):m.globeDepth;w&&(t.framebuffer=M.framebuffer),e.debugShowGlobeDepth&&Object(f["a"])(M)&&c.useGlobeDepthFramebuffer&&(M.update(r,t,m.viewport,e._hdr,b),M.clear(r,t,e._clearColorCommand.color),F=t.framebuffer,t.framebuffer=M.framebuffer),S.execute(r,t),r.stencilBuffer&&T.execute(r,t),o.updatePass(U["a"].GLOBE);var I,j=R.commands[U["a"].GLOBE],N=R.indices[U["a"].GLOBE];for(_=0;_<N;++_)ii(j[_],e,r,t);for(Object(f["a"])(M)&&c.useGlobeDepthFramebuffer&&M.executeCopyDepth(r,t),e.debugShowGlobeDepth&&Object(f["a"])(M)&&c.useGlobeDepthFramebuffer&&(t.framebuffer=F),o.updatePass(U["a"].TERRAIN_CLASSIFICATION),j=R.commands[U["a"].TERRAIN_CLASSIFICATION],N=R.indices[U["a"].TERRAIN_CLASSIFICATION],_=0;_<N;++_)ii(j[_],e,r,t);if(b&&(S.execute(r,t),C&&y.execute(r,t)),w&&(t.framebuffer=M.primitiveFramebuffer),!c.useInvertClassification||u){for(o.updatePass(U["a"].CESIUM_3D_TILE),j=R.commands[U["a"].CESIUM_3D_TILE],N=R.indices[U["a"].CESIUM_3D_TILE],_=0;_<N;++_)ii(j[_],e,r,t);if(N>0)for(Object(f["a"])(M)&&c.useGlobeDepthFramebuffer&&M.executeUpdateDepth(r,t,b),o.updatePass(U["a"].CESIUM_3D_TILE_CLASSIFICATION),j=R.commands[U["a"].CESIUM_3D_TILE_CLASSIFICATION],N=R.indices[U["a"].CESIUM_3D_TILE_CLASSIFICATION],_=0;_<N;++_)ii(j[_],e,r,t)}else{e._invertClassification.clear(r,t);var L=t.framebuffer;for(t.framebuffer=e._invertClassification._fbo,o.updatePass(U["a"].CESIUM_3D_TILE),j=R.commands[U["a"].CESIUM_3D_TILE],N=R.indices[U["a"].CESIUM_3D_TILE],_=0;_<N;++_)ii(j[_],e,r,t);for(Object(f["a"])(M)&&c.useGlobeDepthFramebuffer&&M.executeUpdateDepth(r,t,b),o.updatePass(U["a"].CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW),j=R.commands[U["a"].CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],N=R.indices[U["a"].CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],_=0;_<N;++_)ii(j[_],e,r,t);for(t.framebuffer=L,e._invertClassification.executeClassified(r,t),1===e.frameState.invertClassificationColor.alpha&&e._invertClassification.executeUnclassified(r,t),N>0&&r.stencilBuffer&&D.execute(r,t),o.updatePass(U["a"].CESIUM_3D_TILE_CLASSIFICATION),j=R.commands[U["a"].CESIUM_3D_TILE_CLASSIFICATION],N=R.indices[U["a"].CESIUM_3D_TILE_CLASSIFICATION],_=0;_<N;++_)ii(j[_],e,r,t)}for(N>0&&r.stencilBuffer&&T.execute(r,t),o.updatePass(U["a"].OPAQUE),j=R.commands[U["a"].OPAQUE],N=R.indices[U["a"].OPAQUE],_=0;_<N;++_)ii(j[_],e,r,t);if(0!==P&&e.mode!==le["a"].SCENE2D&&(i.near=R.near,o.updateFrustum(i)),!u&&c.useInvertClassification&&e.frameState.invertClassificationColor.alpha<1&&(I=e._invertClassification),o.updatePass(U["a"].TRANSLUCENT),j=R.commands[U["a"].TRANSLUCENT],j.length=R.indices[U["a"].TRANSLUCENT],n(e,ii,t,j,I),r.depthTexture&&e.useDepthPicking&&(c.useGlobeDepthFramebuffer||d)){var A=d?t.framebuffer.depthStencilTexture:M.framebuffer.depthStencilTexture,V=e._picking.getPickDepth(e,P);V.update(r,A),V.executeCopyDepth(r,t)}if(w&&(t.framebuffer=M.framebuffer),!u&&E){var B=t.framebuffer;for(t.framebuffer=m.sceneFramebuffer.getIdFramebuffer(),i.near=0!==P?R.near*e.opaqueFrustumNearOffset:R.near,i.far=R.far,o.updateFrustum(i),o.updatePass(U["a"].GLOBE),j=R.commands[U["a"].GLOBE],N=R.indices[U["a"].GLOBE],_=0;_<N;++_)ai(j[_],e,r,t);for(b&&(S.framebuffer=t.framebuffer,S.execute(r,t),S.framebuffer=void 0),b&&C&&y.execute(r,t),o.updatePass(U["a"].CESIUM_3D_TILE),j=R.commands[U["a"].CESIUM_3D_TILE],N=R.indices[U["a"].CESIUM_3D_TILE],_=0;_<N;++_)ai(j[_],e,r,t);for(o.updatePass(U["a"].OPAQUE),j=R.commands[U["a"].OPAQUE],N=R.indices[U["a"].OPAQUE],_=0;_<N;++_)ai(j[_],e,r,t);for(o.updatePass(U["a"].TRANSLUCENT),j=R.commands[U["a"].TRANSLUCENT],N=R.indices[U["a"].TRANSLUCENT],_=0;_<N;++_)ai(j[_],e,r,t);t.framebuffer=B}}}function li(e){var t=e.context.uniformState;t.updatePass(U["a"].COMPUTE);var i=e._environmentState.sunComputeCommand;Object(f["a"])(i)&&i.execute(e._computeEngine);for(var a=e._computeCommandList,r=a.length,o=0;o<r;++o)a[o].execute(e._computeEngine)}function fi(e,t){var i=e.context.uniformState;i.updatePass(U["a"].OVERLAY);for(var a=e.context,r=e._overlayCommandList,o=r.length,n=0;n<o;++n)r[n].execute(a,t)}function _i(e,t,i){for(var a=i.shadowMapCullingVolume,r=i.isPointLight,o=i.passes,n=o.length,s=t.length,u=0;u<s;++u){var c=t[u];if(e.updateDerivedCommands(c),c.castShadows&&(c.pass===U["a"].GLOBE||c.pass===U["a"].CESIUM_3D_TILE||c.pass===U["a"].OPAQUE||c.pass===U["a"].TRANSLUCENT)&&e.isVisible(c,a))if(r)for(var m=0;m<n;++m)o[m].commandList.push(c);else if(1===n)o[0].commandList.push(c);else for(var d=!1,h=n-1;h>=0;--h){var p=o[h].cullingVolume;if(e.isVisible(c,p))o[h].commandList.push(c),d=!0;else if(d)break}}}function gi(e){var t=e.frameState,i=t.shadowState.shadowMaps,a=i.length;if(t.shadowState.shadowsEnabled)for(var r=e.context,o=r.uniformState,n=0;n<a;++n){var s=i[n];if(!s.outOfView){var u,c=s.passes,m=c.length;for(u=0;u<m;++u)c[u].commandList.length=0;var d=e.frameState.commandList;for(_i(e,d,s),u=0;u<m;++u){var h=s.passes[u];o.updateCamera(h.camera),s.updatePass(r,u);for(var p=h.commandList.length,l=0;l<p;++l){var f=h.commandList[l];o.updatePass(f.pass),ii(f.derivedCommands.shadows.castCommands[n],e,r,h.passState)}}}}}var vi=new n["a"];function bi(e,t,i){var a=e._view,r=a.camera,o=e._environmentState,s=o.renderTranslucentDepthForPick;ji(e,t,i),s||Ii(e),a.createPotentiallyVisibleSet(e),s||(li(e),gi(e));var u=t.viewport;u.x=0,u.y=0,u.width=.5*u.width;var c=Q["a"].clone(r,e._cameraVR);c.frustum=r.frustum;var m=r.frustum.near,d=m*Object(l["a"])(e.focalLength,5),h=Object(l["a"])(e.eyeSeparation,d/30),p=n["a"].multiplyByScalar(c.right,.5*h,vi);r.frustum.aspectRatio=u.width/u.height;var f=.5*h*m/d;n["a"].add(c.position,p,r.position),r.frustum.xOffset=f,pi(e,t),u.x=u.width,n["a"].subtract(c.position,p,r.position),r.frustum.xOffset=-f,pi(e,t),Q["a"].clone(c,r)}Bt.prototype.updateAndExecuteCommands=function(e,t){var i=this._frameState,a=i.mode,r=this._environmentState.useWebVR;r?bi(this,e,t):a!==le["a"].SCENE2D||this._mapMode2D===ne["a"].ROTATE?Pi(!0,this,e,t):(ji(this,e,t),xi(this,e))};var Ci=new u["a"](Math.PI,E["a"].PI_OVER_TWO),wi=new n["a"],Si=new n["a"],Ti=new O["a"],Di=new O["a"],yi=new n["a"],Ei=new n["a"],Oi=new a["a"];function xi(e,t){var i=e.context,r=e.frameState,o=e.camera,s=t.viewport,u=a["a"].clone(s,Oi);t.viewport=u;var c=Ci,m=wi,d=e.mapProjection;d.project(c,m);var h=n["a"].clone(o.position,Si),p=O["a"].clone(o.transform,Di),l=o.frustum.clone();o._setTransform(O["a"].IDENTITY);var f=O["a"].computeViewportTransformation(u,0,1,Ti),_=o.frustum.projectionMatrix,g=o.positionWC.y,v=n["a"].fromElements(E["a"].sign(g)*m.x-g,0,-o.positionWC.x,yi),b=L["a"].pointToGLWindowCoordinates(_,f,v,Ei);b.x=Math.floor(b.x);var C=u.x,w=u.width;if(0===g||b.x<=C||b.x>=C+w)Pi(!0,e,t);else if(Math.abs(C+.5*w-b.x)<1)u.width=b.x-u.x,o.position.x*=E["a"].sign(o.position.x),o.frustum.right=0,r.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(r),Pi(!0,e,t),u.x=b.x,o.position.x=-o.position.x,o.frustum.right=-o.frustum.left,o.frustum.left=0,r.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(r),Pi(!1,e,t);else if(b.x>C+.5*w){u.width=b.x-C;var S=o.frustum.right;o.frustum.right=m.x-g,r.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(r),Pi(!0,e,t),u.x=b.x,u.width=C+w-b.x,o.position.x=-o.position.x,o.frustum.left=-o.frustum.right,o.frustum.right=S-2*o.frustum.right,r.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(r),Pi(!1,e,t)}else{u.x=b.x,u.width=C+w-b.x;var T=o.frustum.left;o.frustum.left=-m.x-g,r.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(r),Pi(!0,e,t),u.x=C,u.width=b.x-C,o.position.x=-o.position.x,o.frustum.right=-o.frustum.left,o.frustum.left=T-2*o.frustum.left,r.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(r),Pi(!1,e,t)}o._setTransform(p),n["a"].clone(h,o.position),o.frustum=l.clone(),t.viewport=s}function Pi(e,t,i,a){var r=t._environmentState,o=t._view,n=r.renderTranslucentDepthForPick;e||n||(t.frameState.commandList.length=0),n||Ii(t),o.createPotentiallyVisibleSet(t),e&&(Object(f["a"])(a)&&ji(t,i,a),n||(li(t),gi(t))),pi(t,i)}var Ri=new p["a"];function Fi(e){var t=e._frameState;e.debugShowFrustumPlanes!==e._debugShowFrustumPlanes&&(e.debugShowFrustumPlanes?e._debugFrustumPlanes=new J["a"]({camera:e.camera,updateOnChange:!1}):e._debugFrustumPlanes=e._debugFrustumPlanes&&e._debugFrustumPlanes.destroy(),e._debugShowFrustumPlanes=e.debugShowFrustumPlanes),Object(f["a"])(e._debugFrustumPlanes)&&e._debugFrustumPlanes.update(t)}function Mi(e){var t=e._frameState,i=t.shadowMaps,a=i.length,r=a>0&&!t.passes.pick&&e.mode===le["a"].SCENE3D;if(r!==t.shadowState.shadowsEnabled&&(++t.shadowState.lastDirtyTime,t.shadowState.shadowsEnabled=r),t.shadowState.lightShadowsEnabled=!1,r){for(var o=0;o<a;++o)if(i[o]!==t.shadowState.shadowMaps[o]){++t.shadowState.lastDirtyTime;break}t.shadowState.shadowMaps.length=0,t.shadowState.lightShadowMaps.length=0;for(var n=0;n<a;++n){var s=i[n];s.update(t),t.shadowState.shadowMaps.push(s),s.fromLightSource&&(t.shadowState.lightShadowMaps.push(s),t.shadowState.lightShadowsEnabled=!0),s.dirty&&(++t.shadowState.lastDirtyTime,s.dirty=!1)}}}function Ii(e){var t=e._frameState;e._groundPrimitives.update(t),e._primitives.update(t),Fi(e),Mi(e),e._globe&&e._globe.render(t)}function ji(e,t,i){var a=e._context,r=e._frameState,o=e._environmentState,n=e._view,s=e._frameState.passes,u=s.pick,c=o.useWebVR;o.originalFramebuffer=t.framebuffer,Object(f["a"])(e.sun)&&e.sunBloom!==e._sunBloom?(e.sunBloom&&!c?e._sunPostProcess=new Nt["a"]:Object(f["a"])(e._sunPostProcess)&&(e._sunPostProcess=e._sunPostProcess.destroy()),e._sunBloom=e.sunBloom):!Object(f["a"])(e.sun)&&Object(f["a"])(e._sunPostProcess)&&(e._sunPostProcess=e._sunPostProcess.destroy(),e._sunBloom=!1);var d=e._clearColorCommand;m["a"].clone(i,d.color),d.execute(a,t);var h=o.useGlobeDepthFramebuffer=Object(f["a"])(n.globeDepth);h&&(n.globeDepth.update(a,t,n.viewport,e._hdr,o.clearGlobeDepth),n.globeDepth.clear(a,t,i));var p=n.oit,l=o.useOIT=!u&&Object(f["a"])(p)&&p.isSupported();l&&(p.update(a,t,n.globeDepth.framebuffer,e._hdr),p.clear(a,t,i),o.useOIT=p.isSupported());var _=e.postProcessStages,g=o.usePostProcess=!u&&(e._hdr||_.length>0||_.ambientOcclusion.enabled||_.fxaa.enabled||_.bloom.enabled);o.usePostProcessSelected=!1,g&&(n.sceneFramebuffer.update(a,n.viewport,e._hdr),n.sceneFramebuffer.clear(a,t,i),_.update(a,r.useLogDepth,e._hdr),_.clear(a),g=o.usePostProcess=_.ready,o.usePostProcessSelected=g&&_.hasSelected),o.isSunVisible&&e.sunBloom&&!c?(t.framebuffer=e._sunPostProcess.update(t),e._sunPostProcess.clear(a,t,i)):h?t.framebuffer=n.globeDepth.framebuffer:g&&(t.framebuffer=n.sceneFramebuffer.getFramebuffer()),Object(f["a"])(t.framebuffer)&&d.execute(a,t);var v,b=o.useInvertClassification=!u&&Object(f["a"])(t.framebuffer)&&e.invertClassification;if(b)if(1===e.frameState.invertClassificationColor.alpha&&o.useGlobeDepthFramebuffer&&(v=n.globeDepth.framebuffer),Object(f["a"])(v)||a.depthTexture){if(e._invertClassification.previousFramebuffer=v,e._invertClassification.update(a),e._invertClassification.clear(a,t),e.frameState.invertClassificationColor.alpha<1&&l){var C=e._invertClassification.unclassifiedCommand,w=C.derivedCommands;w.oit=p.createDerivedCommands(C,a,w.oit)}}else o.useInvertClassification=!1}function Ni(e){for(var t=e._frameState.afterRender,i=0,a=t.length;i<a;++i)t[i](),e.requestRender();t.length=0}function Li(e,t){if(e.debugShowFramesPerSecond){if(!Object(f["a"])(e._performanceDisplay)){var i=document.createElement("div");i.className="cesium-performanceDisplay-defaultContainer";var a=e._canvas.parentNode;a.appendChild(i);var r=new ue["a"]({container:i});e._performanceDisplay=r,e._performanceContainer=i}e._performanceDisplay.throttled=e.requestRenderMode,e._performanceDisplay.update(t)}else Object(f["a"])(e._performanceDisplay)&&(e._performanceDisplay=e._performanceDisplay&&e._performanceDisplay.destroy(),e._performanceContainer.parentNode.removeChild(e._performanceContainer))}function Ai(e){e._jobScheduler.resetBudgets();var t=e._frameState,i=e.primitives;i.prePassesUpdate(t),Object(f["a"])(e.globe)&&e.globe.update(t),e._picking.update(),t.creditDisplay.update()}function Vi(e){var t=e._frameState,i=e.primitives;i.postPassesUpdate(t),j["a"].update()}Bt.prototype.updateEnvironment=function(){var e=this._frameState,t=this._view,i=this._environmentState,a=e.passes.render,r=e.passes.offscreen,o=this.skyAtmosphere,n=this.globe;if(!a||this._mode!==le["a"].SCENE2D&&t.camera.frustum instanceof R["a"])i.skyAtmosphereCommand=void 0,i.skyBoxCommand=void 0,i.sunDrawCommand=void 0,i.sunComputeCommand=void 0,i.moonCommand=void 0;else{Object(f["a"])(o)&&Object(f["a"])(n)&&(o.setDynamicAtmosphereColor(n.enableLighting&&n.dynamicAtmosphereLighting,n.dynamicAtmosphereLightingFromSun),i.isReadyForAtmosphere=i.isReadyForAtmosphere||n._surface._tilesToRender.length>0),i.skyAtmosphereCommand=Object(f["a"])(o)?o.update(e):void 0,i.skyBoxCommand=Object(f["a"])(this.skyBox)?this.skyBox.update(e,this._hdr):void 0;var s=Object(f["a"])(this.sun)?this.sun.update(e,t.passState,this._hdr):void 0;i.sunDrawCommand=Object(f["a"])(s)?s.drawCommand:void 0,i.sunComputeCommand=Object(f["a"])(s)?s.computeCommand:void 0,i.moonCommand=Object(f["a"])(this.moon)?this.moon.update(e):void 0}var u=i.clearGlobeDepth=Object(f["a"])(n)&&(!n.depthTestAgainstTerrain||this.mode===le["a"].SCENE2D),c=i.useDepthPlane=u&&this.mode===le["a"].SCENE3D;c&&this._depthPlane.update(e),i.renderTranslucentDepthForPick=!1,i.useWebVR=this._useWebVR&&this.mode!==le["a"].SCENE2D&&!r;for(var m=e.mode===le["a"].SCENE3D?e.occluder:void 0,d=e.cullingVolume,h=Ri.planes,p=0;p<5;++p)h[p]=d.planes[p];d=Ri,i.isSkyAtmosphereVisible=Object(f["a"])(i.skyAtmosphereCommand)&&i.isReadyForAtmosphere,i.isSunVisible=this.isVisible(i.sunDrawCommand,d,m),i.isMoonVisible=this.isVisible(i.moonCommand,d,m);var l=this.specularEnvironmentMaps,_=this._specularEnvironmentMapAtlas;!Object(f["a"])(l)||Object(f["a"])(_)&&_.url===l?!Object(f["a"])(l)&&Object(f["a"])(_)&&(_.destroy(),this._specularEnvironmentMapAtlas=void 0):(_=_&&_.destroy(),this._specularEnvironmentMapAtlas=new se["a"](l)),Object(f["a"])(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.update(e)},Bt.prototype.resolveFramebuffers=function(e){var t=this._context,i=this._frameState,a=this._environmentState,r=this._view,o=r.globeDepth,n=a.useOIT,s=a.useGlobeDepthFramebuffer,u=a.usePostProcess,c=a.originalFramebuffer,m=s?o.framebuffer:void 0,d=r.sceneFramebuffer.getFramebuffer(),h=r.sceneFramebuffer.getIdFramebuffer();if(a.separatePrimitiveFramebuffer&&o.executeMergeColor(t,e),n&&(e.framebuffer=u?d:c,r.oit.execute(t,e)),u){var p=d;s&&!n&&(p=m);var f=this.postProcessStages,_=p.getColorTexture(0),g=h.getColorTexture(0),v=Object(l["a"])(m,d).depthStencilTexture;f.execute(t,_,v,g),f.copy(t,c)}n||u||!s||(e.framebuffer=c,o.executeCopyColor(t,e));var b=i.useLogDepth;if(this.debugShowGlobeDepth&&s){var C=ui(this,this.debugShowDepthFrustum-1);C.executeDebugGlobeDepth(t,e,b)}if(this.debugShowPickDepth&&s){var w=this._picking.getPickDepth(this,this.debugShowDepthFrustum-1);w.executeDebugPickDepth(t,e,b)}},Bt.prototype.initializeFrame=function(){120===this._shaderFrameCount++&&(this._shaderFrameCount=0,this._context.shaderCache.destroyReleasedShaderPrograms(),this._context.textureCache.destroyReleasedTextures()),this._tweens.update(),this._screenSpaceCameraController.update(),Object(f["a"])(this._deviceOrientationCameraController)&&this._deviceOrientationCameraController.update(),this.camera.update(this._mode),this.camera._updateCameraChanged()};var Bi=new m["a"];function ki(e){var t=e._frameState,i=e.context,r=i.uniformState,o=e._defaultView;e._view=o,e.updateFrameState(),t.passes.render=!0,t.passes.postProcess=e.postProcessStages.hasSelected,t.tilesetPassState=Ht;var s=Object(l["a"])(e.backgroundColor,m["a"].BLACK);e._hdr&&(s=m["a"].clone(s,Bi),s.red=Math.pow(s.red,e.gamma),s.green=Math.pow(s.green,e.gamma),s.blue=Math.pow(s.blue,e.gamma)),t.backgroundColor=s,e.fog.update(t),r.update(t);var u=e.shadowMap;Object(f["a"])(u)&&u.enabled&&(!Object(f["a"])(e.light)||e.light instanceof jt["a"]?n["a"].negate(r.sunDirectionWC,e._shadowMapCamera.direction):n["a"].clone(e.light.direction,e._shadowMapCamera.direction),t.shadowMaps.push(u)),e._computeCommandList.length=0,e._overlayCommandList.length=0;var c=o.viewport;c.x=0,c.y=0,c.width=i.drawingBufferWidth,c.height=i.drawingBufferHeight;var d=o.passState;d.framebuffer=void 0,d.blendingEnabled=void 0,d.scissorTest=void 0,d.viewport=a["a"].clone(c,d.viewport),Object(f["a"])(e.globe)&&e.globe.beginFrame(t),e.updateEnvironment(),e.updateAndExecuteCommands(d,s),e.resolveFramebuffers(d),d.framebuffer=void 0,fi(e,d),Object(f["a"])(e.globe)&&(e.globe.endFrame(t),e.globe.tilesLoaded||(e._renderRequested=!0)),i.endFrame()}function Wi(e,t){try{t(e)}catch(i){if(e._renderError.raiseEvent(e,i),e.rethrowRenderErrors)throw i}}function Ui(e){return e._picking.updateMostDetailedRayPicks(e)}function Gi(e){var t=e._frameState;zt.camera=t.camera,zt.cullingVolume=t.cullingVolume;var i=e.primitives;i.updateForPass(t,zt)}function Hi(e){var t=e._frameState,i=t.camera;if(i.canPreloadFlight()){qt.camera=e.preloadFlightCamera,qt.cullingVolume=e.preloadFlightCullingVolume;var a=e.primitives;a.updateForPass(t,qt)}}function zi(e){e.primitives.updateForPass(e._frameState,Qt)}Bt.prototype.render=function(e){this._preUpdate.raiseEvent(this,e);var t=this._frameState;t.newFrame=!1,Object(f["a"])(e)||(e=y["a"].now());var i=this._view.checkForCameraUpdates(this),a=!this.requestRenderMode||this._renderRequested||i||this._logDepthBufferDirty||this._hdrDirty||this.mode===le["a"].MORPHING;if(!a&&Object(f["a"])(this.maximumRenderTimeChange)&&Object(f["a"])(this._lastRenderTime)){var r=Math.abs(y["a"].secondsDifference(this._lastRenderTime,e));a=a||r>this.maximumRenderTimeChange}if(a){this._lastRenderTime=y["a"].clone(e,this._lastRenderTime),this._renderRequested=!1,this._logDepthBufferDirty=!1,this._hdrDirty=!1;var o=E["a"].incrementWrap(t.frameNumber,15e6,1);Kt(this,o,e),t.newFrame=!0}Wi(this,Ai),this.primitives.show&&(Wi(this,Ui),Wi(this,Gi),Wi(this,Hi),a||Wi(this,zi)),this._postUpdate.raiseEvent(this,e),a&&(this._preRender.raiseEvent(this,e),t.creditDisplay.beginFrame(),Wi(this,ki)),Li(this,a),Wi(this,Vi),Ni(this),a&&(this._postRender.raiseEvent(this,e),t.creditDisplay.endFrame())},Bt.prototype.forceRender=function(e){this._renderRequested=!0,this.render(e)},Bt.prototype.requestRender=function(){this._renderRequested=!0},Bt.prototype.clampLineWidth=function(e){return Math.max(k["a"].minimumAliasedLineWidth,Math.min(e,k["a"].maximumAliasedLineWidth))},Bt.prototype.pick=function(e,t,i){return this._picking.pick(this,e,t,i)},Bt.prototype.pickPositionWorldCoordinates=function(e,t){return this._picking.pickPositionWorldCoordinates(this,e,t)},Bt.prototype.pickPosition=function(e,t){return this._picking.pickPosition(this,e,t)},Bt.prototype.drillPick=function(e,t,i,a){return this._picking.drillPick(this,e,t,i,a)},Bt.prototype.pickFromRay=function(e,t,i){return this._picking.pickFromRay(this,e,t,i)},Bt.prototype.drillPickFromRay=function(e,t,i,a){return this._picking.drillPickFromRay(this,e,t,i,a)},Bt.prototype.pickFromRayMostDetailed=function(e,t,i){return this._picking.pickFromRayMostDetailed(this,e,t,i)},Bt.prototype.drillPickFromRayMostDetailed=function(e,t,i,a){return this._picking.drillPickFromRayMostDetailed(this,e,t,i,a)},Bt.prototype.sampleHeight=function(e,t,i){return this._picking.sampleHeight(this,e,t,i)},Bt.prototype.clampToHeight=function(e,t,i,a){return this._picking.clampToHeight(this,e,t,i,a)},Bt.prototype.sampleHeightMostDetailed=function(e,t,i){return this._picking.sampleHeightMostDetailed(this,e,t,i)},Bt.prototype.clampToHeightMostDetailed=function(e,t,i){return this._picking.clampToHeightMostDetailed(this,e,t,i)},Bt.prototype.cartesianToCanvasCoordinates=function(e,t){return fe["a"].wgs84ToWindowCoordinates(this,e,t)},Bt.prototype.completeMorph=function(){this._transitioner.completeMorph()},Bt.prototype.morphTo2D=function(e){var t,i=this.globe;t=Object(f["a"])(i)?i.ellipsoid:this.mapProjection.ellipsoid,e=Object(l["a"])(e,2),this._transitioner.morphTo2D(e,t)},Bt.prototype.morphToColumbusView=function(e){var t,i=this.globe;t=Object(f["a"])(i)?i.ellipsoid:this.mapProjection.ellipsoid,e=Object(l["a"])(e,2),this._transitioner.morphToColumbusView(e,t)},Bt.prototype.morphTo3D=function(e){var t,i=this.globe;t=Object(f["a"])(i)?i.ellipsoid:this.mapProjection.ellipsoid,e=Object(l["a"])(e,2),this._transitioner.morphTo3D(e,t)},Bt.prototype.isDestroyed=function(){return!1},Bt.prototype.destroy=function(){this._tweens.removeAll(),this._computeEngine=this._computeEngine&&this._computeEngine.destroy(),this._screenSpaceCameraController=this._screenSpaceCameraController&&this._screenSpaceCameraController.destroy(),this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this._primitives=this._primitives&&this._primitives.destroy(),this._groundPrimitives=this._groundPrimitives&&this._groundPrimitives.destroy(),this._globe=this._globe&&this._globe.destroy(),this.skyBox=this.skyBox&&this.skyBox.destroy(),this.skyAtmosphere=this.skyAtmosphere&&this.skyAtmosphere.destroy(),this._debugSphere=this._debugSphere&&this._debugSphere.destroy(),this.sun=this.sun&&this.sun.destroy(),this._sunPostProcess=this._sunPostProcess&&this._sunPostProcess.destroy(),this._depthPlane=this._depthPlane&&this._depthPlane.destroy(),this._transitioner=this._transitioner&&this._transitioner.destroy(),this._debugFrustumPlanes=this._debugFrustumPlanes&&this._debugFrustumPlanes.destroy(),this._brdfLutGenerator=this._brdfLutGenerator&&this._brdfLutGenerator.destroy(),this._picking=this._picking&&this._picking.destroy(),this._defaultView=this._defaultView&&this._defaultView.destroy(),this._view=void 0,this._removeCreditContainer&&this._canvas.parentNode.removeChild(this._creditContainer),this.postProcessStages=this.postProcessStages&&this.postProcessStages.destroy(),this._context=this._context&&this._context.destroy(),this._frameState.creditDisplay=this._frameState.creditDisplay&&this._frameState.creditDisplay.destroy(),Object(f["a"])(this._performanceDisplay)&&(this._performanceDisplay=this._performanceDisplay&&this._performanceDisplay.destroy(),this._performanceContainer.parentNode.removeChild(this._performanceContainer)),this._removeRequestListenerCallback(),this._removeTaskProcessorListenerCallback();for(var e=0;e<this._removeGlobeCallbacks.length;++e)this._removeGlobeCallbacks[e]();return this._removeGlobeCallbacks.length=0,Object(v["a"])(this)};t["a"]=Bt}}]);