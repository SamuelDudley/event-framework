(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Cesium~435fd353"],{"59d5":function(a,i,t){"use strict";var e=t("670c"),o=t("be18"),n=t("a561"),r=t("bef8"),s=t("535a"),l=t("2f63"),c=t("7d62"),m=t("c52f"),d=t("8dd9d"),_=t("5410"),g=t("c2aa"),u=t("c8ed"),h=t("93da"),p=t("df07"),v=t("52f0"),P=t("713f"),f=t("188e"),T=t("0260"),y=t("2ac3"),b=t("f806"),w=t("691b"),E=t("8909"),R=t("482f"),M=t("a307"),O=t("0c80"),x=t("619f");function I(a){this.enableInputs=!0,this.enableTranslate=!0,this.enableZoom=!0,this.enableRotate=!0,this.enableTilt=!0,this.enableLook=!0,this.inertiaSpin=.9,this.inertiaTranslate=.9,this.inertiaZoom=.8,this.maximumMovementRatio=.1,this.bounceAnimationTime=3,this.minimumZoomDistance=1,this.maximumZoomDistance=Number.POSITIVE_INFINITY,this.translateEventTypes=E["a"].LEFT_DRAG,this.zoomEventTypes=[E["a"].RIGHT_DRAG,E["a"].WHEEL,E["a"].PINCH],this.rotateEventTypes=E["a"].LEFT_DRAG,this.tiltEventTypes=[E["a"].MIDDLE_DRAG,E["a"].PINCH,{eventType:E["a"].LEFT_DRAG,modifier:u["a"].CTRL},{eventType:E["a"].RIGHT_DRAG,modifier:u["a"].CTRL}],this.lookEventTypes={eventType:E["a"].LEFT_DRAG,modifier:u["a"].SHIFT},this.minimumPickingTerrainHeight=15e4,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight,this.minimumCollisionTerrainHeight=15e3,this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight,this.minimumTrackBallHeight=75e5,this._minimumTrackBallHeight=this.minimumTrackBallHeight,this.enableCollisionDetection=!0,this._scene=a,this._globe=void 0,this._ellipsoid=void 0,this._aggregator=new w["a"](a.canvas),this._lastInertiaSpinMovement=void 0,this._lastInertiaZoomMovement=void 0,this._lastInertiaTranslateMovement=void 0,this._lastInertiaTiltMovement=void 0,this._tweens=new x["a"],this._tween=void 0,this._horizontalRotationAxis=void 0,this._tiltCenterMousePosition=new e["a"](-1,-1),this._tiltCenter=new o["a"],this._rotateMousePosition=new e["a"](-1,-1),this._rotateStartPosition=new o["a"],this._strafeStartPosition=new o["a"],this._zoomMouseStart=new e["a"](-1,-1),this._zoomWorldPosition=new o["a"],this._useZoomWorldPosition=!1,this._tiltCVOffMap=!1,this._looking=!1,this._rotating=!1,this._strafing=!1,this._zoomingOnVector=!1,this._rotatingZoom=!1,this._adjustedHeightForTerrain=!1;var i=a.mapProjection;this._maxCoord=i.project(new r["a"](Math.PI,h["a"].PI_OVER_TWO)),this._zoomFactor=5,this._rotateFactor=void 0,this._rotateRateRangeAdjustment=void 0,this._maximumRotateRate=1.77,this._minimumRotateRate=2e-4,this._minimumZoomRate=20,this._maximumZoomRate=5906376272e3}function C(a,i){if(a<0)return 0;var t=25*(1-i);return Math.exp(-t*a)}function z(a){return e["a"].equalsEpsilon(a.startPosition,a.endPosition,h["a"].EPSILON14)}var S=.4;function j(a,i,t,o,n,r,s){var c=r[s];Object(l["a"])(c)||(c=r[s]={startPosition:new e["a"],endPosition:new e["a"],motion:new e["a"],active:!1});var m=a.getButtonPressTime(i,t),d=a.getButtonReleaseTime(i,t),_=m&&d&&(d.getTime()-m.getTime())/1e3,g=new Date,u=d&&(g.getTime()-d.getTime())/1e3;if(m&&d&&_<S){var h=C(u,o);if(c.active)c.startPosition=e["a"].clone(c.endPosition,c.startPosition),c.endPosition=e["a"].multiplyByScalar(c.motion,h,c.endPosition),c.endPosition=e["a"].add(c.startPosition,c.endPosition,c.endPosition),c.motion=e["a"].clone(e["a"].ZERO,c.motion);else{var p=a.getLastMovement(i,t);if(!Object(l["a"])(p)||z(p))return;c.motion.x=.5*(p.endPosition.x-p.startPosition.x),c.motion.y=.5*(p.endPosition.y-p.startPosition.y),c.startPosition=e["a"].clone(p.startPosition,c.startPosition),c.endPosition=e["a"].multiplyByScalar(c.motion,h,c.endPosition),c.endPosition=e["a"].add(c.startPosition,c.endPosition,c.endPosition),c.active=!0}if(isNaN(c.endPosition.x)||isNaN(c.endPosition.y)||e["a"].distance(c.startPosition,c.endPosition)<.5)return void(c.active=!1);if(!a.isButtonDown(i,t)){var v=a.getStartMousePosition(i,t);n(r,v,c)}}else c.active=!1}var k=[];function N(a,i,t,e,o,n){if(Object(l["a"])(t)){var r=a._aggregator;Object(g["a"])(t)||(k[0]=t,t=k);for(var s=t.length,c=0;c<s;++c){var m=t[c],d=Object(l["a"])(m.eventType)?m.eventType:m,_=m.modifier,u=r.isMoving(d,_)&&r.getMovement(d,_),h=r.getStartMousePosition(d,_);a.enableInputs&&i&&(u?e(a,h,u):o<1&&j(r,d,_,o,e,a,n))}}}var H=new y["a"],A=new o["a"],W=new e["a"],Z=new o["a"],B=new e["a"],D=new o["a"],F=new o["a"],U=new o["a"],q=new o["a"],L=new o["a"],V=new o["a"],G=new o["a"],Y=new o["a"],X=new o["a"],J=new o["a"],Q=new o["a"],K=new o["a"],$=new o["a"],aa=new o["a"],ia=new o["a"],ta=new o["a"],ea=new o["a"],oa=new o["a"],na={orientation:new d["a"]};function ra(a,i,t,n,r,s){var c=1;Object(l["a"])(s)&&(c=h["a"].clamp(Math.abs(s),.25,1));var m=a.minimumZoomDistance*c,d=a.maximumZoomDistance,_=r-m,g=n*_;g=h["a"].clamp(g,a._minimumZoomRate,a._maximumZoomRate);var u=t.endPosition.y-t.startPosition.y,p=u/a._scene.canvas.clientHeight;p=Math.min(p,a.maximumMovementRatio);var v=g*p;if(!(v>0&&Math.abs(r-m)<1)&&!(v<0&&Math.abs(r-d)<1)){r-v<m?v=r-m-1:r-v>d&&(v=r-d);var f=a._scene,T=f.camera,y=f.mode,b=na.orientation;if(b.heading=T.heading,b.pitch=T.pitch,b.roll=T.roll,T.frustum instanceof P["a"])Math.abs(v)>0&&(T.zoomIn(v),T._adjustOrthographicFrustum());else{var w,E=e["a"].equals(i,a._zoomMouseStart),R=a._zoomingOnVector,x=a._rotatingZoom;if(E||(a._zoomMouseStart=e["a"].clone(i,a._zoomMouseStart),Object(l["a"])(a._globe)&&(y===M["a"].SCENE2D?(w=T.getPickRay(i,H).origin,w=o["a"].fromElements(w.y,w.z,w.x)):w=Ta(a,i,A)),Object(l["a"])(w)?(a._useZoomWorldPosition=!0,a._zoomWorldPosition=o["a"].clone(w,a._zoomWorldPosition)):a._useZoomWorldPosition=!1,R=a._zoomingOnVector=!1,x=a._rotatingZoom=!1),a._useZoomWorldPosition){var I=y===M["a"].COLUMBUS_VIEW;if(T.positionCartographic.height<2e6&&(x=!0),!E||x){if(y===M["a"].SCENE2D){var C=a._zoomWorldPosition,z=T.position;if(!o["a"].equals(C,z)&&T.positionCartographic.height<2*a._maxCoord.x){var S=T.position.x,j=o["a"].subtract(C,z,Z);o["a"].normalize(j,j);var k=o["a"].distance(C,z)*v/(.5*T.getMagnitude());T.move(j,.5*k),(T.position.x<0&&S>0||T.position.x>0&&S<0)&&(w=T.getPickRay(i,H).origin,w=o["a"].fromElements(w.y,w.z,w.x),a._zoomWorldPosition=o["a"].clone(w,a._zoomWorldPosition))}}else if(y===M["a"].SCENE3D){var N=o["a"].normalize(T.position,L);if(T.positionCartographic.height<3e3&&Math.abs(o["a"].dot(T.direction,N))<.6)I=!0;else{var ra=f.canvas,sa=B;sa.x=ra.clientWidth/2,sa.y=ra.clientHeight/2;var la=Ta(a,sa,D);if(Object(l["a"])(la)&&T.positionCartographic.height<1e6){var ca=G;o["a"].clone(T.position,ca);var ma=a._zoomWorldPosition,da=V;if(da=o["a"].normalize(ma,da),o["a"].dot(da,N)<0)return;var _a=ia,ga=J;o["a"].clone(T.direction,ga),o["a"].add(ca,o["a"].multiplyByScalar(ga,1e3,ta),_a);var ua=Q,ha=K;o["a"].subtract(ma,ca,ua),o["a"].normalize(ua,ha);var pa=o["a"].dot(N,ha);if(pa>=0)return void(a._zoomMouseStart.x=-1);var va=Math.acos(-pa),Pa=o["a"].magnitude(ca),fa=o["a"].magnitude(ma),ya=Pa-v,ba=o["a"].magnitude(ua),wa=Math.asin(h["a"].clamp(ba/fa*Math.sin(va),-1,1)),Ea=Math.asin(h["a"].clamp(ya/fa*Math.sin(va),-1,1)),Ra=wa-Ea+va,Ma=Y;o["a"].normalize(ca,Ma);var Oa=X;Oa=o["a"].cross(ha,Ma,Oa),Oa=o["a"].normalize(Oa,Oa),o["a"].normalize(o["a"].cross(Ma,Oa,ta),ga),o["a"].multiplyByScalar(o["a"].normalize(_a,ta),o["a"].magnitude(_a)-v,_a),o["a"].normalize(ca,ca),o["a"].multiplyByScalar(ca,ya,ca);var xa=$;o["a"].multiplyByScalar(o["a"].add(o["a"].multiplyByScalar(Ma,Math.cos(Ra)-1,ea),o["a"].multiplyByScalar(ga,Math.sin(Ra),oa),ta),ya,xa),o["a"].add(ca,xa,ca),o["a"].normalize(_a,Ma),o["a"].normalize(o["a"].cross(Ma,Oa,ta),ga);var Ia=aa;return o["a"].multiplyByScalar(o["a"].add(o["a"].multiplyByScalar(Ma,Math.cos(Ra)-1,ea),o["a"].multiplyByScalar(ga,Math.sin(Ra),oa),ta),o["a"].magnitude(_a),Ia),o["a"].add(_a,Ia,_a),o["a"].clone(ca,T.position),o["a"].normalize(o["a"].subtract(_a,ca,ta),T.direction),o["a"].clone(T.direction,T.direction),o["a"].cross(T.direction,T.up,T.right),o["a"].cross(T.right,T.direction,T.up),void T.setView(na)}if(Object(l["a"])(la)){var Ca=o["a"].normalize(la,F),za=o["a"].normalize(a._zoomWorldPosition,U),Sa=o["a"].dot(za,Ca);if(Sa>0&&Sa<1){var ja=h["a"].acosClamped(Sa),ka=o["a"].cross(za,Ca,q),Na=Math.abs(ja)>h["a"].toRadians(20)?.75*T.positionCartographic.height:T.positionCartographic.height-v,Ha=v/Na;T.rotate(ka,ja*Ha)}}else I=!0}}a._rotatingZoom=!I}if(!E&&I||R){var Aa,Wa=O["a"].wgs84ToWindowCoordinates(f,a._zoomWorldPosition,W);Aa=y!==M["a"].COLUMBUS_VIEW&&e["a"].equals(i,a._zoomMouseStart)&&Object(l["a"])(Wa)?T.getPickRay(Wa,H):T.getPickRay(i,H);var Za=Aa.direction;y!==M["a"].COLUMBUS_VIEW&&y!==M["a"].SCENE2D||o["a"].fromElements(Za.y,Za.z,Za.x,Za),T.move(Za,v),a._zoomingOnVector=!0}else T.zoomIn(v);T.setView(na)}else T.zoomIn(v)}}}var sa=new y["a"],la=new y["a"],ca=new o["a"];function ma(a,i,t){var e=a._scene,n=e.camera,r=n.getPickRay(t.startPosition,sa).origin,s=n.getPickRay(t.endPosition,la).origin;r=o["a"].fromElements(r.y,r.z,r.x,r),s=o["a"].fromElements(s.y,s.z,s.x,s);var l=o["a"].subtract(r,s,ca),c=o["a"].magnitude(l);c>0&&(o["a"].normalize(l,l),n.move(l,c))}function da(a,i,t){Object(l["a"])(t.distance)&&(t=t.distance);var e=a._scene,o=e.camera;ra(a,i,t,a._zoomFactor,o.getMagnitude())}var _a=new e["a"],ga=new e["a"];function ua(a,i,t){if(Object(l["a"])(t.angleAndHeight))ha(a,i,t.angleAndHeight);else{var o=a._scene,n=o.camera,r=o.canvas,s=r.clientWidth,c=r.clientHeight,m=_a;m.x=2/s*t.startPosition.x-1,m.y=2/c*(c-t.startPosition.y)-1,m=e["a"].normalize(m,m);var d=ga;d.x=2/s*t.endPosition.x-1,d.y=2/c*(c-t.endPosition.y)-1,d=e["a"].normalize(d,d);var _=h["a"].acosClamped(m.x);m.y<0&&(_=h["a"].TWO_PI-_);var g=h["a"].acosClamped(d.x);d.y<0&&(g=h["a"].TWO_PI-g);var u=g-_;n.twistRight(u)}}function ha(a,i,t){var e=a._rotateFactor*a._rotateRateRangeAdjustment;e>a._maximumRotateRate&&(e=a._maximumRotateRate),e<a._minimumRotateRate&&(e=a._minimumRotateRate);var o=a._scene,n=o.camera,r=o.canvas,s=(t.endPosition.x-t.startPosition.x)/r.clientWidth;s=Math.min(s,a.maximumMovementRatio);var l=e*s*Math.PI*4;n.twistRight(l)}function pa(a){var i=a._scene.mapMode2D===R["a"].ROTATE;v["a"].equals(v["a"].IDENTITY,a._scene.camera.transform)?(N(a,a.enableTranslate,a.translateEventTypes,ma,a.inertiaTranslate,"_lastInertiaTranslateMovement"),N(a,a.enableZoom,a.zoomEventTypes,da,a.inertiaZoom,"_lastInertiaZoomMovement"),i&&N(a,a.enableRotate,a.tiltEventTypes,ua,a.inertiaSpin,"_lastInertiaTiltMovement")):(N(a,a.enableZoom,a.zoomEventTypes,da,a.inertiaZoom,"_lastInertiaZoomMovement"),i&&N(a,a.enableRotate,a.translateEventTypes,ua,a.inertiaSpin,"_lastInertiaSpinMovement"))}var va=new y["a"],Pa=new o["a"],fa=new o["a"];function Ta(a,i,t){var e=a._scene,n=a._globe,r=e.camera;if(Object(l["a"])(n)){var s;e.pickPositionSupported&&(s=e.pickPositionWorldCoordinates(i,Pa));var c=r.getPickRay(i,va),m=n.pickWorldCoordinates(c,e,fa),d=Object(l["a"])(s)?o["a"].distance(s,r.positionWC):Number.POSITIVE_INFINITY,_=Object(l["a"])(m)?o["a"].distance(m,r.positionWC):Number.POSITIVE_INFINITY;return d<_?o["a"].clone(s,t):o["a"].clone(m,t)}}var ya=new y["a"],ba=new y["a"],wa=new o["a"],Ea=new o["a"],Ra=new o["a"],Ma=new o["a"],Oa=new f["a"](o["a"].UNIT_X,0),xa=new e["a"],Ia=new e["a"];function Ca(a,i,t){if(o["a"].equals(i,a._translateMousePosition)||(a._looking=!1),o["a"].equals(i,a._strafeMousePosition)||(a._strafing=!1),a._looking)Li(a,i,t);else if(a._strafing)oi(a,i,t);else{var n,r=a._scene,s=r.camera,c=e["a"].clone(t.startPosition,xa),m=e["a"].clone(t.endPosition,Ia),d=s.getPickRay(c,ya),g=o["a"].clone(o["a"].ZERO,Ma),u=o["a"].UNIT_X;if(s.position.z<a._minimumPickingTerrainHeight&&(n=Ta(a,c,wa),Object(l["a"])(n)&&(g.x=n.x)),g.x>s.position.z&&Object(l["a"])(n))return o["a"].clone(n,a._strafeStartPosition),a._strafing=!0,oi(a,i,t),void(a._strafeMousePosition=e["a"].clone(i,a._strafeMousePosition));var p=f["a"].fromPointNormal(g,u,Oa);d=s.getPickRay(c,ya);var v=_["a"].rayPlane(d,p,wa),P=s.getPickRay(m,ba),T=_["a"].rayPlane(P,p,Ea);if(!Object(l["a"])(v)||!Object(l["a"])(T))return a._looking=!0,Li(a,i,t),void e["a"].clone(i,a._translateMousePosition);var y=o["a"].subtract(v,T,Ra),b=y.x;y.x=y.y,y.y=y.z,y.z=b;var w=o["a"].magnitude(y);w>h["a"].EPSILON6&&(o["a"].normalize(y,y),s.move(y,w))}}var za=new e["a"],Sa=new y["a"],ja=new o["a"],ka=new o["a"],Na=new v["a"],Ha=new v["a"],Aa=new o["a"],Wa=new f["a"](o["a"].UNIT_X,0),Za=new o["a"],Ba=new r["a"],Da=new v["a"],Fa=new T["a"],Ua=new p["a"],qa=new o["a"];function La(a,i,t){if(Object(l["a"])(t.angleAndHeight)&&(t=t.angleAndHeight),e["a"].equals(i,a._tiltCenterMousePosition)||(a._tiltCVOffMap=!1,a._looking=!1),a._looking)Li(a,i,t);else{var o=a._scene,n=o.camera,r=a._maxCoord,s=Math.abs(n.position.x)-r.x<0&&Math.abs(n.position.y)-r.y<0;a._tiltCVOffMap||!s||n.position.z>a._minimumPickingTerrainHeight?(a._tiltCVOffMap=!0,Va(a,i,t)):Ga(a,i,t)}}function Va(a,i,t){var n=a._scene,r=n.camera,s=n.canvas,c=za;c.x=s.clientWidth/2,c.y=s.clientHeight/2;var d,_=r.getPickRay(c,Sa),g=o["a"].UNIT_X,u=_.origin,p=_.direction,P=o["a"].dot(g,p);if(Math.abs(P)>h["a"].EPSILON6&&(d=-o["a"].dot(g,u)/P),!Object(l["a"])(d)||d<=0)return a._looking=!0,Li(a,i,t),void e["a"].clone(i,a._tiltCenterMousePosition);var f=o["a"].multiplyByScalar(p,d,ja);o["a"].add(u,f,f);var T=n.mapProjection,y=T.ellipsoid;o["a"].fromElements(f.y,f.z,f.x,f);var w=T.unproject(f,Ba);y.cartographicToCartesian(w,f);var E=b["a"].eastNorthUpToFixedFrame(f,y,Na),R=a._globe,M=a._ellipsoid;a._globe=void 0,a._ellipsoid=m["a"].UNIT_SPHERE,a._rotateFactor=1,a._rotateRateRangeAdjustment=1;var O=v["a"].clone(r.transform,Da);r._setTransform(E),di(a,i,t,o["a"].UNIT_Z),r._setTransform(O),a._globe=R,a._ellipsoid=M;var x=M.maximumRadius;a._rotateFactor=1/x,a._rotateRateRangeAdjustment=x}function Ga(a,i,t){var n,r,s=a._scene,c=s.camera,d=o["a"].UNIT_X;if(e["a"].equals(i,a._tiltCenterMousePosition))n=o["a"].clone(a._tiltCenter,ja);else{if(c.position.z<a._minimumPickingTerrainHeight&&(n=Ta(a,i,ja)),!Object(l["a"])(n)){r=c.getPickRay(i,Sa);var g,u=r.origin,P=r.direction,y=o["a"].dot(d,P);if(Math.abs(y)>h["a"].EPSILON6&&(g=-o["a"].dot(d,u)/y),!Object(l["a"])(g)||g<=0)return a._looking=!0,Li(a,i,t),void e["a"].clone(i,a._tiltCenterMousePosition);n=o["a"].multiplyByScalar(P,g,ja),o["a"].add(u,n,n)}e["a"].clone(i,a._tiltCenterMousePosition),o["a"].clone(n,a._tiltCenter)}var w=s.canvas,E=za;E.x=w.clientWidth/2,E.y=a._tiltCenterMousePosition.y,r=c.getPickRay(E,Sa);var R=o["a"].clone(o["a"].ZERO,Aa);R.x=n.x;var M=f["a"].fromPointNormal(R,d,Wa),O=_["a"].rayPlane(r,M,ka),x=c._projection,I=x.ellipsoid;o["a"].fromElements(n.y,n.z,n.x,n);var C=x.unproject(n,Ba);I.cartographicToCartesian(C,n);var z,S=b["a"].eastNorthUpToFixedFrame(n,I,Na);Object(l["a"])(O)?(o["a"].fromElements(O.y,O.z,O.x,O),C=x.unproject(O,Ba),I.cartographicToCartesian(C,O),z=b["a"].eastNorthUpToFixedFrame(O,I,Ha)):z=S;var j=a._globe,k=a._ellipsoid;a._globe=void 0,a._ellipsoid=m["a"].UNIT_SPHERE,a._rotateFactor=1,a._rotateRateRangeAdjustment=1;var N=o["a"].UNIT_Z,H=v["a"].clone(c.transform,Da);c._setTransform(S);var A=o["a"].cross(o["a"].UNIT_Z,o["a"].normalize(c.position,Za),Za),W=o["a"].dot(c.right,A);if(di(a,i,t,N,!1,!0),c._setTransform(z),W<0){t.startPosition.y>t.endPosition.y&&(N=void 0);var Z=c.constrainedAxis;c.constrainedAxis=void 0,di(a,i,t,N,!0,!1),c.constrainedAxis=Z}else di(a,i,t,N,!0,!1);if(Object(l["a"])(c.constrainedAxis)){var B=o["a"].cross(c.direction,c.constrainedAxis,qa);o["a"].equalsEpsilon(B,o["a"].ZERO,h["a"].EPSILON6)||(o["a"].dot(B,c.right)<0&&o["a"].negate(B,B),o["a"].cross(B,c.direction,c.up),o["a"].cross(c.direction,c.up,c.right),o["a"].normalize(c.up,c.up),o["a"].normalize(c.right,c.right))}c._setTransform(H),a._globe=j,a._ellipsoid=k;var D=k.maximumRadius;a._rotateFactor=1/D,a._rotateRateRangeAdjustment=D;var F=o["a"].clone(c.positionWC,Za);if(a.enableCollisionDetection&&Xi(a),!o["a"].equals(c.positionWC,F)){c._setTransform(z),c.worldToCameraCoordinatesPoint(F,F);var U=o["a"].magnitudeSquared(F);o["a"].magnitudeSquared(c.position)>U&&(o["a"].normalize(c.position,c.position),o["a"].multiplyByScalar(c.position,Math.sqrt(U),c.position));var q=o["a"].angleBetween(F,c.position),L=o["a"].cross(F,c.position,F);o["a"].normalize(L,L);var V=T["a"].fromAxisAngle(L,q,Fa),G=p["a"].fromQuaternion(V,Ua);p["a"].multiplyByVector(G,c.direction,c.direction),p["a"].multiplyByVector(G,c.up,c.up),o["a"].cross(c.direction,c.up,c.right),o["a"].cross(c.right,c.direction,c.up),c._setTransform(H)}}var Ya=new e["a"],Xa=new y["a"],Ja=new o["a"];function Qa(a,i,t){Object(l["a"])(t.distance)&&(t=t.distance);var e=a._scene,n=e.camera,r=e.canvas,s=Ya;s.x=r.clientWidth/2,s.y=r.clientHeight/2;var c,m,d=n.getPickRay(s,Xa);if(n.position.z<a._minimumPickingTerrainHeight&&(c=Ta(a,s,Ja)),Object(l["a"])(c))m=o["a"].distance(d.origin,c);else{var _=o["a"].UNIT_X,g=d.origin,u=d.direction;m=-o["a"].dot(_,g)/o["a"].dot(_,u)}ra(a,i,t,a._zoomFactor,m)}function Ka(a){var i=a._scene,t=i.camera;if(v["a"].equals(v["a"].IDENTITY,t.transform)){var e=a._tweens;if(a._aggregator.anyButtonDown&&e.removeAll(),N(a,a.enableTilt,a.tiltEventTypes,La,a.inertiaSpin,"_lastInertiaTiltMovement"),N(a,a.enableTranslate,a.translateEventTypes,Ca,a.inertiaTranslate,"_lastInertiaTranslateMovement"),N(a,a.enableZoom,a.zoomEventTypes,Qa,a.inertiaZoom,"_lastInertiaZoomMovement"),N(a,a.enableLook,a.lookEventTypes,Li),!a._aggregator.anyButtonDown&&(!Object(l["a"])(a._lastInertiaZoomMovement)||!a._lastInertiaZoomMovement.active)&&(!Object(l["a"])(a._lastInertiaTranslateMovement)||!a._lastInertiaTranslateMovement.active)&&!e.contains(a._tween)){var o=t.createCorrectPositionTween(a.bounceAnimationTime);Object(l["a"])(o)&&(a._tween=e.add(o))}e.update()}else N(a,a.enableRotate,a.rotateEventTypes,di,a.inertiaSpin,"_lastInertiaSpinMovement"),N(a,a.enableZoom,a.zoomEventTypes,wi,a.inertiaZoom,"_lastInertiaZoomMovement")}var $a=new y["a"],ai=new f["a"](o["a"].UNIT_X,0),ii=new o["a"],ti=new o["a"],ei=new o["a"];function oi(a,i,t){var e=a._scene,n=e.camera,r=Ta(a,t.startPosition,ei);if(Object(l["a"])(r)){var s=t.endPosition,c=n.getPickRay(s,$a),m=o["a"].clone(n.direction,ti);e.mode===M["a"].COLUMBUS_VIEW&&o["a"].fromElements(m.z,m.x,m.y,m);var d=f["a"].fromPointNormal(r,m,ai),g=_["a"].rayPlane(c,d,ii);Object(l["a"])(g)&&(m=o["a"].subtract(r,g,m),e.mode===M["a"].COLUMBUS_VIEW&&o["a"].fromElements(m.y,m.z,m.x,m),o["a"].add(n.position,m,n.position))}}var ni=new o["a"],ri=new r["a"],si=new o["a"],li=new m["a"],ci=new o["a"];function mi(a,i,t){var n=a._scene,r=n.camera;if(v["a"].equals(r.transform,v["a"].IDENTITY)){var s,c,d,_,g=a._ellipsoid.geodeticSurfaceNormal(r.position,ci),u=a._ellipsoid.cartesianToCartographic(r.positionWC,ri).height,h=a._globe,p=!1;if(Object(l["a"])(h)&&u<a._minimumPickingTerrainHeight&&(_=Ta(a,t.startPosition,ei),Object(l["a"])(_))){var P=r.getPickRay(t.startPosition,va),f=a._ellipsoid.geodeticSurfaceNormal(_);p=Math.abs(o["a"].dot(P.direction,f))<.05,p&&!a._looking&&(a._rotating=!1,a._strafing=!0)}e["a"].equals(i,a._rotateMousePosition)?a._looking?Li(a,i,t,g):a._rotating?di(a,i,t):a._strafing?(o["a"].clone(_,a._strafeStartPosition),oi(a,i,t)):(s=o["a"].magnitude(a._rotateStartPosition),c=si,c.x=c.y=c.z=s,d=m["a"].fromCartesian3(c,li),Ti(a,i,t,d)):(a._looking=!1,a._rotating=!1,a._strafing=!1,Object(l["a"])(h)&&u<a._minimumPickingTerrainHeight?Object(l["a"])(_)?o["a"].magnitude(r.position)<o["a"].magnitude(_)?(o["a"].clone(_,a._strafeStartPosition),a._strafing=!0,oi(a,i,t)):(s=o["a"].magnitude(_),c=si,c.x=c.y=c.z=s,d=m["a"].fromCartesian3(c,li),Ti(a,i,t,d),o["a"].clone(_,a._rotateStartPosition)):(a._looking=!0,Li(a,i,t,g)):Object(l["a"])(r.pickEllipsoid(t.startPosition,a._ellipsoid,ni))?(Ti(a,i,t,a._ellipsoid),o["a"].clone(ni,a._rotateStartPosition)):u>a._minimumTrackBallHeight?(a._rotating=!0,di(a,i,t)):(a._looking=!0,Li(a,i,t,g)),e["a"].clone(i,a._rotateMousePosition))}else di(a,i,t)}function di(a,i,t,e,n,r){n=Object(s["a"])(n,!1),r=Object(s["a"])(r,!1);var c=a._scene,m=c.camera,d=c.canvas,_=m.constrainedAxis;Object(l["a"])(e)&&(m.constrainedAxis=e);var g=o["a"].magnitude(m.position),u=a._rotateFactor*(g-a._rotateRateRangeAdjustment);u>a._maximumRotateRate&&(u=a._maximumRotateRate),u<a._minimumRotateRate&&(u=a._minimumRotateRate);var h=(t.startPosition.x-t.endPosition.x)/d.clientWidth,p=(t.startPosition.y-t.endPosition.y)/d.clientHeight;h=Math.min(h,a.maximumMovementRatio),p=Math.min(p,a.maximumMovementRatio);var v=u*h*Math.PI*2,P=u*p*Math.PI;n||m.rotateRight(v),r||m.rotateUp(P),m.constrainedAxis=_}var _i=n["a"].clone(n["a"].UNIT_W),gi=n["a"].clone(n["a"].UNIT_W),ui=new o["a"],hi=new o["a"],pi=new o["a"],vi=new o["a"],Pi=new e["a"],fi=new e["a"];function Ti(a,i,t,n){var r=a._scene,s=r.camera,c=e["a"].clone(t.startPosition,Pi),m=e["a"].clone(t.endPosition,fi),d=s.pickEllipsoid(c,n,_i),_=s.pickEllipsoid(m,n,gi);if(!Object(l["a"])(d)||!Object(l["a"])(_))return a._rotating=!0,void di(a,i,t);if(d=s.worldToCameraCoordinates(d,d),_=s.worldToCameraCoordinates(_,_),Object(l["a"])(s.constrainedAxis)){var g=s.constrainedAxis,u=o["a"].mostOrthogonalAxis(g,ui);o["a"].cross(u,g,u),o["a"].normalize(u,u);var p=o["a"].cross(g,u,hi),v=o["a"].magnitude(d),P=o["a"].dot(g,d),f=Math.acos(P/v),T=o["a"].multiplyByScalar(g,P,pi);o["a"].subtract(d,T,T),o["a"].normalize(T,T);var y=o["a"].magnitude(_),b=o["a"].dot(g,_),w=Math.acos(b/y),E=o["a"].multiplyByScalar(g,b,vi);o["a"].subtract(_,E,E),o["a"].normalize(E,E);var R=Math.acos(o["a"].dot(T,u));o["a"].dot(T,p)<0&&(R=h["a"].TWO_PI-R);var M=Math.acos(o["a"].dot(E,u));o["a"].dot(E,p)<0&&(M=h["a"].TWO_PI-M);var O,x=R-M;O=o["a"].equalsEpsilon(g,s.position,h["a"].EPSILON2)?s.right:o["a"].cross(g,s.position,ui);var I,C=o["a"].cross(g,O,ui),z=o["a"].dot(C,o["a"].subtract(d,g,hi)),S=o["a"].dot(C,o["a"].subtract(_,g,hi));I=z>0&&S>0?w-f:z>0&&S<=0?o["a"].dot(s.position,g)>0?-f-w:f+w:f-w,s.rotateRight(x),s.rotateUp(I)}else{o["a"].normalize(d,d),o["a"].normalize(_,_);var j=o["a"].dot(d,_),k=o["a"].cross(d,_,ui);if(j<1&&!o["a"].equalsEpsilon(k,o["a"].ZERO,h["a"].EPSILON14)){var N=Math.acos(j);s.rotate(k,N)}}}var yi=new o["a"],bi=new r["a"];function wi(a,i,t){Object(l["a"])(t.distance)&&(t=t.distance);var e=a._ellipsoid,n=a._scene,r=n.camera,s=n.canvas,c=Ya;c.x=s.clientWidth/2,c.y=s.clientHeight/2;var m,d,_=r.getPickRay(c,Xa),g=e.cartesianToCartographic(r.position,bi).height;g<a._minimumPickingTerrainHeight&&(m=Ta(a,c,Ja)),d=Object(l["a"])(m)?o["a"].distance(_.origin,m):g;var u=o["a"].normalize(r.position,yi);ra(a,i,t,a._zoomFactor,d,o["a"].dot(u,r.direction))}var Ei=new e["a"],Ri=new y["a"],Mi=new o["a"],Oi=new o["a"],xi=new v["a"],Ii=new v["a"],Ci=new v["a"],zi=new T["a"],Si=new p["a"],ji=new r["a"],ki=new o["a"];function Ni(a,i,t){var o=a._scene,n=o.camera;if(v["a"].equals(n.transform,v["a"].IDENTITY))if(Object(l["a"])(t.angleAndHeight)&&(t=t.angleAndHeight),e["a"].equals(i,a._tiltCenterMousePosition)||(a._tiltOnEllipsoid=!1,a._looking=!1),a._looking){var r=a._ellipsoid.geodeticSurfaceNormal(n.position,ki);Li(a,i,t,r)}else{var s=a._ellipsoid,c=s.cartesianToCartographic(n.position,ji);a._tiltOnEllipsoid||c.height>a._minimumCollisionTerrainHeight?(a._tiltOnEllipsoid=!0,Ai(a,i,t)):Wi(a,i,t)}}var Hi=new r["a"];function Ai(a,i,t){var n=a._ellipsoid,r=a._scene,s=r.camera,c=.25*a.minimumZoomDistance,d=n.cartesianToCartographic(s.positionWC,Hi).height;if(!(d-c-1<h["a"].EPSILON3&&t.endPosition.y-t.startPosition.y<0)){var g=r.canvas,u=Ei;u.x=g.clientWidth/2,u.y=g.clientHeight/2;var p,P=s.getPickRay(u,Ri),f=_["a"].rayEllipsoid(P,n);if(Object(l["a"])(f))p=y["a"].getPoint(P,f.start,Mi);else{if(!(d>a._minimumTrackBallHeight)){a._looking=!0;var T=a._ellipsoid.geodeticSurfaceNormal(s.position,ki);return Li(a,i,t,T),void e["a"].clone(i,a._tiltCenterMousePosition)}var w=_["a"].grazingAltitudeLocation(P,n);if(!Object(l["a"])(w))return;var E=n.cartesianToCartographic(w,ji);E.height=0,p=n.cartographicToCartesian(E,Mi)}var R=b["a"].eastNorthUpToFixedFrame(p,n,xi),M=a._globe,O=a._ellipsoid;a._globe=void 0,a._ellipsoid=m["a"].UNIT_SPHERE,a._rotateFactor=1,a._rotateRateRangeAdjustment=1;var x=v["a"].clone(s.transform,Ci);s._setTransform(R),di(a,i,t,o["a"].UNIT_Z),s._setTransform(x),a._globe=M,a._ellipsoid=O;var I=O.maximumRadius;a._rotateFactor=1/I,a._rotateRateRangeAdjustment=I}}function Wi(a,i,t){var n,r,s,c=a._ellipsoid,d=a._scene,g=d.camera;if(e["a"].equals(i,a._tiltCenterMousePosition))n=o["a"].clone(a._tiltCenter,Mi);else{if(n=Ta(a,i,Mi),!Object(l["a"])(n)){if(r=g.getPickRay(i,Ri),s=_["a"].rayEllipsoid(r,c),!Object(l["a"])(s)){var u=c.cartesianToCartographic(g.position,ji);if(u.height<=a._minimumTrackBallHeight){a._looking=!0;var P=a._ellipsoid.geodeticSurfaceNormal(g.position,ki);Li(a,i,t,P),e["a"].clone(i,a._tiltCenterMousePosition)}return}n=y["a"].getPoint(r,s.start,Mi)}e["a"].clone(i,a._tiltCenterMousePosition),o["a"].clone(n,a._tiltCenter)}var f=d.canvas,w=Ei;w.x=f.clientWidth/2,w.y=a._tiltCenterMousePosition.y,r=g.getPickRay(w,Ri);var E=o["a"].magnitude(n),R=o["a"].fromElements(E,E,E,si),M=m["a"].fromCartesian3(R,li);if(s=_["a"].rayEllipsoid(r,M),Object(l["a"])(s)){var O=o["a"].magnitude(r.origin)>E?s.start:s.stop,x=y["a"].getPoint(r,O,Oi),I=b["a"].eastNorthUpToFixedFrame(n,c,xi),C=b["a"].eastNorthUpToFixedFrame(x,M,Ii),z=a._globe,S=a._ellipsoid;a._globe=void 0,a._ellipsoid=m["a"].UNIT_SPHERE,a._rotateFactor=1,a._rotateRateRangeAdjustment=1;var j=o["a"].UNIT_Z,k=v["a"].clone(g.transform,Ci);g._setTransform(I);var N=o["a"].cross(x,g.positionWC,qa),H=o["a"].dot(g.rightWC,N);if(di(a,i,t,j,!1,!0),g._setTransform(C),H<0){t.startPosition.y>t.endPosition.y&&(j=void 0);var A=g.constrainedAxis;g.constrainedAxis=void 0,di(a,i,t,j,!0,!1),g.constrainedAxis=A}else di(a,i,t,j,!0,!1);if(Object(l["a"])(g.constrainedAxis)){var W=o["a"].cross(g.direction,g.constrainedAxis,qa);o["a"].equalsEpsilon(W,o["a"].ZERO,h["a"].EPSILON6)||(o["a"].dot(W,g.right)<0&&o["a"].negate(W,W),o["a"].cross(W,g.direction,g.up),o["a"].cross(g.direction,g.up,g.right),o["a"].normalize(g.up,g.up),o["a"].normalize(g.right,g.right))}g._setTransform(k),a._globe=z,a._ellipsoid=S;var Z=S.maximumRadius;a._rotateFactor=1/Z,a._rotateRateRangeAdjustment=Z;var B=o["a"].clone(g.positionWC,qa);if(a.enableCollisionDetection&&Xi(a),!o["a"].equals(g.positionWC,B)){g._setTransform(C),g.worldToCameraCoordinatesPoint(B,B);var D=o["a"].magnitudeSquared(B);o["a"].magnitudeSquared(g.position)>D&&(o["a"].normalize(g.position,g.position),o["a"].multiplyByScalar(g.position,Math.sqrt(D),g.position));var F=o["a"].angleBetween(B,g.position),U=o["a"].cross(B,g.position,B);o["a"].normalize(U,U);var q=T["a"].fromAxisAngle(U,F,zi),L=p["a"].fromQuaternion(q,Si);p["a"].multiplyByVector(L,g.direction,g.direction),p["a"].multiplyByVector(L,g.up,g.up),o["a"].cross(g.direction,g.up,g.right),o["a"].cross(g.right,g.direction,g.up),g._setTransform(k)}}}var Zi=new e["a"],Bi=new e["a"],Di=new y["a"],Fi=new y["a"],Ui=new o["a"],qi=new o["a"];function Li(a,i,t,e){var n=a._scene,r=n.camera,c=Zi;c.x=t.startPosition.x,c.y=0;var m=Bi;m.x=t.endPosition.x,m.y=0;var d,_,g=r.getPickRay(c,Di),u=r.getPickRay(m,Fi),p=0;r.frustum instanceof P["a"]?(d=g.origin,_=u.origin,o["a"].add(r.direction,d,d),o["a"].add(r.direction,_,_),o["a"].subtract(d,r.position,d),o["a"].subtract(_,r.position,_),o["a"].normalize(d,d),o["a"].normalize(_,_)):(d=g.direction,_=u.direction);var v=o["a"].dot(d,_);v<1&&(p=Math.acos(v)),p=t.startPosition.x>t.endPosition.x?-p:p;var f=a._horizontalRotationAxis;if(Object(l["a"])(e)?r.look(e,-p):Object(l["a"])(f)?r.look(f,-p):r.lookLeft(p),c.x=0,c.y=t.startPosition.y,m.x=0,m.y=t.endPosition.y,g=r.getPickRay(c,Di),u=r.getPickRay(m,Fi),p=0,r.frustum instanceof P["a"]?(d=g.origin,_=u.origin,o["a"].add(r.direction,d,d),o["a"].add(r.direction,_,_),o["a"].subtract(d,r.position,d),o["a"].subtract(_,r.position,_),o["a"].normalize(d,d),o["a"].normalize(_,_)):(d=g.direction,_=u.direction),v=o["a"].dot(d,_),v<1&&(p=Math.acos(v)),p=t.startPosition.y>t.endPosition.y?-p:p,e=Object(s["a"])(e,f),Object(l["a"])(e)){var T=r.direction,y=o["a"].negate(e,Ui),b=o["a"].equalsEpsilon(T,e,h["a"].EPSILON2),w=o["a"].equalsEpsilon(T,y,h["a"].EPSILON2);if(b||w)(b&&p<0||w&&p>0)&&r.look(r.right,-p);else{v=o["a"].dot(T,e);var E=h["a"].acosClamped(v);p>0&&p>E&&(p=E-h["a"].EPSILON4),v=o["a"].dot(T,y),E=h["a"].acosClamped(v),p<0&&-p>E&&(p=-E+h["a"].EPSILON4);var R=o["a"].cross(e,T,qi);r.look(R,p)}}else r.lookUp(p)}function Vi(a){N(a,a.enableRotate,a.rotateEventTypes,mi,a.inertiaSpin,"_lastInertiaSpinMovement"),N(a,a.enableZoom,a.zoomEventTypes,wi,a.inertiaZoom,"_lastInertiaZoomMovement"),N(a,a.enableTilt,a.tiltEventTypes,Ni,a.inertiaSpin,"_lastInertiaTiltMovement"),N(a,a.enableLook,a.lookEventTypes,Li)}var Gi=new v["a"],Yi=new r["a"];function Xi(a){a._adjustedHeightForTerrain=!0;var i=a._scene,t=i.mode,e=i.globe;if(Object(l["a"])(e)&&t!==M["a"].SCENE2D&&t!==M["a"].MORPHING){var n,r,s=i.camera,c=e.ellipsoid,m=i.mapProjection;v["a"].equals(s.transform,v["a"].IDENTITY)||(n=v["a"].clone(s.transform,Gi),r=o["a"].magnitude(s.position),s._setTransform(v["a"].IDENTITY));var d=Yi;t===M["a"].SCENE3D?c.cartesianToCartographic(s.position,d):m.unproject(s.position,d);var _=!1;if(d.height<a._minimumCollisionTerrainHeight){var g=e.getHeight(d);Object(l["a"])(g)&&(g+=a.minimumZoomDistance,d.height<g&&(d.height=g,t===M["a"].SCENE3D?c.cartographicToCartesian(d,s.position):m.project(d,s.position),_=!0))}Object(l["a"])(n)&&(s._setTransform(n),_&&(o["a"].normalize(s.position,s.position),o["a"].negate(s.position,s.direction),o["a"].multiplyByScalar(s.position,Math.max(r,a.minimumZoomDistance),s.position),o["a"].normalize(s.direction,s.direction),o["a"].cross(s.direction,s.up,s.right),o["a"].cross(s.right,s.direction,s.up)))}}var Ji=new o["a"],Qi=new o["a"];I.prototype.update=function(){var a=this._scene.camera;v["a"].equals(a.transform,v["a"].IDENTITY)?(this._globe=this._scene.globe,this._ellipsoid=Object(l["a"])(this._globe)?this._globe.ellipsoid:this._scene.mapProjection.ellipsoid):(this._globe=void 0,this._ellipsoid=m["a"].UNIT_SPHERE),this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight*this._scene.terrainExaggeration,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight*this._scene.terrainExaggeration,this._minimumTrackBallHeight=this.minimumTrackBallHeight*this._scene.terrainExaggeration;var i=this._ellipsoid.maximumRadius;this._rotateFactor=1/i,this._rotateRateRangeAdjustment=i,this._adjustedHeightForTerrain=!1;var t=o["a"].clone(a.positionWC,Ji),e=o["a"].clone(a.directionWC,Qi),n=this._scene,r=n.mode;if(r===M["a"].SCENE2D?pa(this):r===M["a"].COLUMBUS_VIEW?(this._horizontalRotationAxis=o["a"].UNIT_Z,Ka(this)):r===M["a"].SCENE3D&&(this._horizontalRotationAxis=void 0,Vi(this)),this.enableCollisionDetection&&!this._adjustedHeightForTerrain){var s=!o["a"].equals(t,a.positionWC)||!o["a"].equals(e,a.directionWC);s&&Xi(this)}this._aggregator.reset()},I.prototype.isDestroyed=function(){return!1},I.prototype.destroy=function(){return this._tweens.removeAll(),this._aggregator=this._aggregator&&this._aggregator.destroy(),Object(c["a"])(this)},i["a"]=I}}]);