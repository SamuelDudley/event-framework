(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Cesium~435fd353"],{"59d5":function(a,t,i){"use strict";var e=i("670c"),o=i("be18"),n=i("a561"),r=i("bef8"),s=i("535a"),l=i("2f63"),c=i("7d62"),m=i("c52f"),d=i("8dd9d"),_=i("5410"),g=i("c2aa"),u=i("c8ed"),v=i("93da"),h=i("df07"),p=i("52f0"),P=i("713f"),f=i("188e"),T=i("0260"),y=i("2ac3"),b=i("f806"),w=i("691b"),R=i("8909"),E=i("482f"),M=i("a307"),x=i("0c80"),O=i("619f");function I(a){this.enableInputs=!0,this.enableTranslate=!0,this.enableZoom=!0,this.enableRotate=!0,this.enableTilt=!0,this.enableLook=!0,this.inertiaSpin=.9,this.inertiaTranslate=.9,this.inertiaZoom=.8,this.maximumMovementRatio=.1,this.bounceAnimationTime=3,this.minimumZoomDistance=1,this.maximumZoomDistance=Number.POSITIVE_INFINITY,this.translateEventTypes=R["a"].LEFT_DRAG,this.zoomEventTypes=[R["a"].RIGHT_DRAG,R["a"].WHEEL,R["a"].PINCH],this.rotateEventTypes=R["a"].LEFT_DRAG,this.tiltEventTypes=[R["a"].MIDDLE_DRAG,R["a"].PINCH,{eventType:R["a"].LEFT_DRAG,modifier:u["a"].CTRL},{eventType:R["a"].RIGHT_DRAG,modifier:u["a"].CTRL}],this.lookEventTypes={eventType:R["a"].LEFT_DRAG,modifier:u["a"].SHIFT},this.minimumPickingTerrainHeight=15e4,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight,this.minimumCollisionTerrainHeight=15e3,this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight,this.minimumTrackBallHeight=75e5,this._minimumTrackBallHeight=this.minimumTrackBallHeight,this.enableCollisionDetection=!0,this._scene=a,this._globe=void 0,this._ellipsoid=void 0,this._aggregator=new w["a"](a.canvas),this._lastInertiaSpinMovement=void 0,this._lastInertiaZoomMovement=void 0,this._lastInertiaTranslateMovement=void 0,this._lastInertiaTiltMovement=void 0,this._tweens=new O["a"],this._tween=void 0,this._horizontalRotationAxis=void 0,this._tiltCenterMousePosition=new e["a"](-1,-1),this._tiltCenter=new o["a"],this._rotateMousePosition=new e["a"](-1,-1),this._rotateStartPosition=new o["a"],this._strafeStartPosition=new o["a"],this._zoomMouseStart=new e["a"](-1,-1),this._zoomWorldPosition=new o["a"],this._useZoomWorldPosition=!1,this._tiltCVOffMap=!1,this._looking=!1,this._rotating=!1,this._strafing=!1,this._zoomingOnVector=!1,this._rotatingZoom=!1;var t=a.mapProjection;this._maxCoord=t.project(new r["a"](Math.PI,v["a"].PI_OVER_TWO)),this._zoomFactor=5,this._rotateFactor=void 0,this._rotateRateRangeAdjustment=void 0,this._maximumRotateRate=1.77,this._minimumRotateRate=2e-4,this._minimumZoomRate=20,this._maximumZoomRate=5906376272e3}function C(a,t){if(a<0)return 0;var i=25*(1-t);return Math.exp(-i*a)}function z(a){return e["a"].equalsEpsilon(a.startPosition,a.endPosition,v["a"].EPSILON14)}var S=.4;function j(a,t,i,o,n,r,s){var c=r[s];Object(l["a"])(c)||(c=r[s]={startPosition:new e["a"],endPosition:new e["a"],motion:new e["a"],active:!1});var m=a.getButtonPressTime(t,i),d=a.getButtonReleaseTime(t,i),_=m&&d&&(d.getTime()-m.getTime())/1e3,g=new Date,u=d&&(g.getTime()-d.getTime())/1e3;if(m&&d&&_<S){var v=C(u,o);if(c.active)c.startPosition=e["a"].clone(c.endPosition,c.startPosition),c.endPosition=e["a"].multiplyByScalar(c.motion,v,c.endPosition),c.endPosition=e["a"].add(c.startPosition,c.endPosition,c.endPosition),c.motion=e["a"].clone(e["a"].ZERO,c.motion);else{var h=a.getLastMovement(t,i);if(!Object(l["a"])(h)||z(h))return;c.motion.x=.5*(h.endPosition.x-h.startPosition.x),c.motion.y=.5*(h.endPosition.y-h.startPosition.y),c.startPosition=e["a"].clone(h.startPosition,c.startPosition),c.endPosition=e["a"].multiplyByScalar(c.motion,v,c.endPosition),c.endPosition=e["a"].add(c.startPosition,c.endPosition,c.endPosition),c.active=!0}if(isNaN(c.endPosition.x)||isNaN(c.endPosition.y)||e["a"].distance(c.startPosition,c.endPosition)<.5)return void(c.active=!1);if(!a.isButtonDown(t,i)){var p=a.getStartMousePosition(t,i);n(r,p,c)}}else c.active=!1}var k=[];function N(a,t,i,e,o,n){if(Object(l["a"])(i)){var r=a._aggregator;Object(g["a"])(i)||(k[0]=i,i=k);for(var s=i.length,c=0;c<s;++c){var m=i[c],d=Object(l["a"])(m.eventType)?m.eventType:m,_=m.modifier,u=r.isMoving(d,_)&&r.getMovement(d,_),v=r.getStartMousePosition(d,_);a.enableInputs&&t&&(u?e(a,v,u):o<1&&j(r,d,_,o,e,a,n))}}}var A=new y["a"],H=new o["a"],W=new e["a"],Z=new o["a"],B=new e["a"],U=new o["a"],F=new o["a"],L=new o["a"],D=new o["a"],q=new o["a"],V=new o["a"],G=new o["a"],Y=new o["a"],X=new o["a"],J=new o["a"],Q=new o["a"],K=new o["a"],$=new o["a"],aa=new o["a"],ta=new o["a"],ia=new o["a"],ea=new o["a"],oa=new o["a"],na={orientation:new d["a"]};function ra(a,t,i,n,r,s){var c=1;Object(l["a"])(s)&&(c=v["a"].clamp(Math.abs(s),.25,1));var m=a.minimumZoomDistance*c,d=a.maximumZoomDistance,_=r-m,g=n*_;g=v["a"].clamp(g,a._minimumZoomRate,a._maximumZoomRate);var u=i.endPosition.y-i.startPosition.y,h=u/a._scene.canvas.clientHeight;h=Math.min(h,a.maximumMovementRatio);var p=g*h;if(!(p>0&&Math.abs(r-m)<1)&&!(p<0&&Math.abs(r-d)<1)){r-p<m?p=r-m-1:r-p>d&&(p=r-d);var f=a._scene,T=f.camera,y=f.mode,b=na.orientation;if(b.heading=T.heading,b.pitch=T.pitch,b.roll=T.roll,T.frustum instanceof P["a"])Math.abs(p)>0&&(T.zoomIn(p),T._adjustOrthographicFrustum());else{var w,R=e["a"].equals(t,a._zoomMouseStart),E=a._zoomingOnVector,O=a._rotatingZoom;if(R||(a._zoomMouseStart=e["a"].clone(t,a._zoomMouseStart),Object(l["a"])(a._globe)&&(y===M["a"].SCENE2D?(w=T.getPickRay(t,A).origin,w=o["a"].fromElements(w.y,w.z,w.x)):w=Ta(a,t,H)),Object(l["a"])(w)?(a._useZoomWorldPosition=!0,a._zoomWorldPosition=o["a"].clone(w,a._zoomWorldPosition)):a._useZoomWorldPosition=!1,E=a._zoomingOnVector=!1,O=a._rotatingZoom=!1),a._useZoomWorldPosition){var I=y===M["a"].COLUMBUS_VIEW;if(T.positionCartographic.height<2e6&&(O=!0),!R||O){if(y===M["a"].SCENE2D){var C=a._zoomWorldPosition,z=T.position;if(!o["a"].equals(C,z)&&T.positionCartographic.height<2*a._maxCoord.x){var S=T.position.x,j=o["a"].subtract(C,z,Z);o["a"].normalize(j,j);var k=o["a"].distance(C,z)*p/(.5*T.getMagnitude());T.move(j,.5*k),(T.position.x<0&&S>0||T.position.x>0&&S<0)&&(w=T.getPickRay(t,A).origin,w=o["a"].fromElements(w.y,w.z,w.x),a._zoomWorldPosition=o["a"].clone(w,a._zoomWorldPosition))}}else if(y===M["a"].SCENE3D){var N=o["a"].normalize(T.position,q);if(T.positionCartographic.height<3e3&&Math.abs(o["a"].dot(T.direction,N))<.6)I=!0;else{var ra=f.canvas,sa=B;sa.x=ra.clientWidth/2,sa.y=ra.clientHeight/2;var la=Ta(a,sa,U);if(Object(l["a"])(la)&&T.positionCartographic.height<1e6){var ca=G;o["a"].clone(T.position,ca);var ma=a._zoomWorldPosition,da=V;if(da=o["a"].normalize(ma,da),o["a"].dot(da,N)<0)return;var _a=ta,ga=J;o["a"].clone(T.direction,ga),o["a"].add(ca,o["a"].multiplyByScalar(ga,1e3,ia),_a);var ua=Q,va=K;o["a"].subtract(ma,ca,ua),o["a"].normalize(ua,va);var ha=o["a"].dot(N,va);if(ha>=0)return void(a._zoomMouseStart.x=-1);var pa=Math.acos(-ha),Pa=o["a"].magnitude(ca),fa=o["a"].magnitude(ma),ya=Pa-p,ba=o["a"].magnitude(ua),wa=Math.asin(v["a"].clamp(ba/fa*Math.sin(pa),-1,1)),Ra=Math.asin(v["a"].clamp(ya/fa*Math.sin(pa),-1,1)),Ea=wa-Ra+pa,Ma=Y;o["a"].normalize(ca,Ma);var xa=X;xa=o["a"].cross(va,Ma,xa),xa=o["a"].normalize(xa,xa),o["a"].normalize(o["a"].cross(Ma,xa,ia),ga),o["a"].multiplyByScalar(o["a"].normalize(_a,ia),o["a"].magnitude(_a)-p,_a),o["a"].normalize(ca,ca),o["a"].multiplyByScalar(ca,ya,ca);var Oa=$;o["a"].multiplyByScalar(o["a"].add(o["a"].multiplyByScalar(Ma,Math.cos(Ea)-1,ea),o["a"].multiplyByScalar(ga,Math.sin(Ea),oa),ia),ya,Oa),o["a"].add(ca,Oa,ca),o["a"].normalize(_a,Ma),o["a"].normalize(o["a"].cross(Ma,xa,ia),ga);var Ia=aa;return o["a"].multiplyByScalar(o["a"].add(o["a"].multiplyByScalar(Ma,Math.cos(Ea)-1,ea),o["a"].multiplyByScalar(ga,Math.sin(Ea),oa),ia),o["a"].magnitude(_a),Ia),o["a"].add(_a,Ia,_a),o["a"].clone(ca,T.position),o["a"].normalize(o["a"].subtract(_a,ca,ia),T.direction),o["a"].clone(T.direction,T.direction),o["a"].cross(T.direction,T.up,T.right),o["a"].cross(T.right,T.direction,T.up),void T.setView(na)}if(Object(l["a"])(la)){var Ca=o["a"].normalize(la,F),za=o["a"].normalize(a._zoomWorldPosition,L),Sa=o["a"].dot(za,Ca);if(Sa>0&&Sa<1){var ja=v["a"].acosClamped(Sa),ka=o["a"].cross(za,Ca,D),Na=Math.abs(ja)>v["a"].toRadians(20)?.75*T.positionCartographic.height:T.positionCartographic.height-p,Aa=p/Na;T.rotate(ka,ja*Aa)}}else I=!0}}a._rotatingZoom=!I}if(!R&&I||E){var Ha,Wa=x["a"].wgs84ToWindowCoordinates(f,a._zoomWorldPosition,W);Ha=y!==M["a"].COLUMBUS_VIEW&&e["a"].equals(t,a._zoomMouseStart)&&Object(l["a"])(Wa)?T.getPickRay(Wa,A):T.getPickRay(t,A);var Za=Ha.direction;y!==M["a"].COLUMBUS_VIEW&&y!==M["a"].SCENE2D||o["a"].fromElements(Za.y,Za.z,Za.x,Za),T.move(Za,p),a._zoomingOnVector=!0}else T.zoomIn(p);T.setView(na)}else T.zoomIn(p)}}}var sa=new y["a"],la=new y["a"],ca=new o["a"];function ma(a,t,i){var e=a._scene,n=e.camera,r=n.getPickRay(i.startPosition,sa).origin,s=n.getPickRay(i.endPosition,la).origin;r=o["a"].fromElements(r.y,r.z,r.x,r),s=o["a"].fromElements(s.y,s.z,s.x,s);var l=o["a"].subtract(r,s,ca),c=o["a"].magnitude(l);c>0&&(o["a"].normalize(l,l),n.move(l,c))}function da(a,t,i){Object(l["a"])(i.distance)&&(i=i.distance);var e=a._scene,o=e.camera;ra(a,t,i,a._zoomFactor,o.getMagnitude())}var _a=new e["a"],ga=new e["a"];function ua(a,t,i){if(Object(l["a"])(i.angleAndHeight))va(a,t,i.angleAndHeight);else{var o=a._scene,n=o.camera,r=o.canvas,s=r.clientWidth,c=r.clientHeight,m=_a;m.x=2/s*i.startPosition.x-1,m.y=2/c*(c-i.startPosition.y)-1,m=e["a"].normalize(m,m);var d=ga;d.x=2/s*i.endPosition.x-1,d.y=2/c*(c-i.endPosition.y)-1,d=e["a"].normalize(d,d);var _=v["a"].acosClamped(m.x);m.y<0&&(_=v["a"].TWO_PI-_);var g=v["a"].acosClamped(d.x);d.y<0&&(g=v["a"].TWO_PI-g);var u=g-_;n.twistRight(u)}}function va(a,t,i){var e=a._rotateFactor*a._rotateRateRangeAdjustment;e>a._maximumRotateRate&&(e=a._maximumRotateRate),e<a._minimumRotateRate&&(e=a._minimumRotateRate);var o=a._scene,n=o.camera,r=o.canvas,s=(i.endPosition.x-i.startPosition.x)/r.clientWidth;s=Math.min(s,a.maximumMovementRatio);var l=e*s*Math.PI*4;n.twistRight(l)}function ha(a){var t=a._scene.mapMode2D===E["a"].ROTATE;p["a"].equals(p["a"].IDENTITY,a._scene.camera.transform)?(N(a,a.enableTranslate,a.translateEventTypes,ma,a.inertiaTranslate,"_lastInertiaTranslateMovement"),N(a,a.enableZoom,a.zoomEventTypes,da,a.inertiaZoom,"_lastInertiaZoomMovement"),t&&N(a,a.enableRotate,a.tiltEventTypes,ua,a.inertiaSpin,"_lastInertiaTiltMovement")):(N(a,a.enableZoom,a.zoomEventTypes,da,a.inertiaZoom,"_lastInertiaZoomMovement"),t&&N(a,a.enableRotate,a.translateEventTypes,ua,a.inertiaSpin,"_lastInertiaSpinMovement"))}var pa=new y["a"],Pa=new o["a"],fa=new o["a"];function Ta(a,t,i){var e=a._scene,n=a._globe,r=e.camera;if(Object(l["a"])(n)){var s;e.pickPositionSupported&&(s=e.pickPositionWorldCoordinates(t,Pa));var c=r.getPickRay(t,pa),m=n.pickWorldCoordinates(c,e,fa),d=Object(l["a"])(s)?o["a"].distance(s,r.positionWC):Number.POSITIVE_INFINITY,_=Object(l["a"])(m)?o["a"].distance(m,r.positionWC):Number.POSITIVE_INFINITY;return d<_?o["a"].clone(s,i):o["a"].clone(m,i)}}var ya=new y["a"],ba=new y["a"],wa=new o["a"],Ra=new o["a"],Ea=new o["a"],Ma=new o["a"],xa=new f["a"](o["a"].UNIT_X,0),Oa=new e["a"],Ia=new e["a"];function Ca(a,t,i){if(o["a"].equals(t,a._translateMousePosition)||(a._looking=!1),o["a"].equals(t,a._strafeMousePosition)||(a._strafing=!1),a._looking)qt(a,t,i);else if(a._strafing)ot(a,t,i);else{var n,r=a._scene,s=r.camera,c=e["a"].clone(i.startPosition,Oa),m=e["a"].clone(i.endPosition,Ia),d=s.getPickRay(c,ya),g=o["a"].clone(o["a"].ZERO,Ma),u=o["a"].UNIT_X;if(s.position.z<a._minimumPickingTerrainHeight&&(n=Ta(a,c,wa),Object(l["a"])(n)&&(g.x=n.x)),g.x>s.position.z&&Object(l["a"])(n))return o["a"].clone(n,a._strafeStartPosition),a._strafing=!0,ot(a,t,i),void(a._strafeMousePosition=e["a"].clone(t,a._strafeMousePosition));var h=f["a"].fromPointNormal(g,u,xa);d=s.getPickRay(c,ya);var p=_["a"].rayPlane(d,h,wa),P=s.getPickRay(m,ba),T=_["a"].rayPlane(P,h,Ra);if(!Object(l["a"])(p)||!Object(l["a"])(T))return a._looking=!0,qt(a,t,i),void e["a"].clone(t,a._translateMousePosition);var y=o["a"].subtract(p,T,Ea),b=y.x;y.x=y.y,y.y=y.z,y.z=b;var w=o["a"].magnitude(y);w>v["a"].EPSILON6&&(o["a"].normalize(y,y),s.move(y,w))}}var za=new e["a"],Sa=new y["a"],ja=new o["a"],ka=new o["a"],Na=new p["a"],Aa=new p["a"],Ha=new o["a"],Wa=new f["a"](o["a"].UNIT_X,0),Za=new o["a"],Ba=new r["a"],Ua=new p["a"],Fa=new T["a"],La=new h["a"],Da=new o["a"];function qa(a,t,i){if(Object(l["a"])(i.angleAndHeight)&&(i=i.angleAndHeight),e["a"].equals(t,a._tiltCenterMousePosition)||(a._tiltCVOffMap=!1,a._looking=!1),a._looking)qt(a,t,i);else{var o=a._scene,n=o.camera,r=a._maxCoord,s=Math.abs(n.position.x)-r.x<0&&Math.abs(n.position.y)-r.y<0;a._tiltCVOffMap||!s||n.position.z>a._minimumPickingTerrainHeight?(a._tiltCVOffMap=!0,Va(a,t,i)):Ga(a,t,i)}}function Va(a,t,i){var n=a._scene,r=n.camera,s=n.canvas,c=za;c.x=s.clientWidth/2,c.y=s.clientHeight/2;var d,_=r.getPickRay(c,Sa),g=o["a"].UNIT_X,u=_.origin,h=_.direction,P=o["a"].dot(g,h);if(Math.abs(P)>v["a"].EPSILON6&&(d=-o["a"].dot(g,u)/P),!Object(l["a"])(d)||d<=0)return a._looking=!0,qt(a,t,i),void e["a"].clone(t,a._tiltCenterMousePosition);var f=o["a"].multiplyByScalar(h,d,ja);o["a"].add(u,f,f);var T=n.mapProjection,y=T.ellipsoid;o["a"].fromElements(f.y,f.z,f.x,f);var w=T.unproject(f,Ba);y.cartographicToCartesian(w,f);var R=b["a"].eastNorthUpToFixedFrame(f,y,Na),E=a._globe,M=a._ellipsoid;a._globe=void 0,a._ellipsoid=m["a"].UNIT_SPHERE,a._rotateFactor=1,a._rotateRateRangeAdjustment=1;var x=p["a"].clone(r.transform,Ua);r._setTransform(R),dt(a,t,i,o["a"].UNIT_Z),r._setTransform(x),a._globe=E,a._ellipsoid=M;var O=M.maximumRadius;a._rotateFactor=1/O,a._rotateRateRangeAdjustment=O}function Ga(a,t,i){var n,r,s=a._scene,c=s.camera,d=o["a"].UNIT_X;if(e["a"].equals(t,a._tiltCenterMousePosition))n=o["a"].clone(a._tiltCenter,ja);else{if(c.position.z<a._minimumPickingTerrainHeight&&(n=Ta(a,t,ja)),!Object(l["a"])(n)){r=c.getPickRay(t,Sa);var g,u=r.origin,P=r.direction,y=o["a"].dot(d,P);if(Math.abs(y)>v["a"].EPSILON6&&(g=-o["a"].dot(d,u)/y),!Object(l["a"])(g)||g<=0)return a._looking=!0,qt(a,t,i),void e["a"].clone(t,a._tiltCenterMousePosition);n=o["a"].multiplyByScalar(P,g,ja),o["a"].add(u,n,n)}e["a"].clone(t,a._tiltCenterMousePosition),o["a"].clone(n,a._tiltCenter)}var w=s.canvas,R=za;R.x=w.clientWidth/2,R.y=a._tiltCenterMousePosition.y,r=c.getPickRay(R,Sa);var E=o["a"].clone(o["a"].ZERO,Ha);E.x=n.x;var M=f["a"].fromPointNormal(E,d,Wa),x=_["a"].rayPlane(r,M,ka),O=c._projection,I=O.ellipsoid;o["a"].fromElements(n.y,n.z,n.x,n);var C=O.unproject(n,Ba);I.cartographicToCartesian(C,n);var z,S=b["a"].eastNorthUpToFixedFrame(n,I,Na);Object(l["a"])(x)?(o["a"].fromElements(x.y,x.z,x.x,x),C=O.unproject(x,Ba),I.cartographicToCartesian(C,x),z=b["a"].eastNorthUpToFixedFrame(x,I,Aa)):z=S;var j=a._globe,k=a._ellipsoid;a._globe=void 0,a._ellipsoid=m["a"].UNIT_SPHERE,a._rotateFactor=1,a._rotateRateRangeAdjustment=1;var N=o["a"].UNIT_Z,A=p["a"].clone(c.transform,Ua);c._setTransform(S);var H=o["a"].cross(o["a"].UNIT_Z,o["a"].normalize(c.position,Za),Za),W=o["a"].dot(c.right,H);if(dt(a,t,i,N,!1,!0),c._setTransform(z),W<0){i.startPosition.y>i.endPosition.y&&(N=void 0);var Z=c.constrainedAxis;c.constrainedAxis=void 0,dt(a,t,i,N,!0,!1),c.constrainedAxis=Z}else dt(a,t,i,N,!0,!1);if(Object(l["a"])(c.constrainedAxis)){var B=o["a"].cross(c.direction,c.constrainedAxis,Da);o["a"].equalsEpsilon(B,o["a"].ZERO,v["a"].EPSILON6)||(o["a"].dot(B,c.right)<0&&o["a"].negate(B,B),o["a"].cross(B,c.direction,c.up),o["a"].cross(c.direction,c.up,c.right),o["a"].normalize(c.up,c.up),o["a"].normalize(c.right,c.right))}c._setTransform(A),a._globe=j,a._ellipsoid=k;var U=k.maximumRadius;a._rotateFactor=1/U,a._rotateRateRangeAdjustment=U;var F=o["a"].clone(c.positionWC,Za);if(c._adjustHeightForTerrain(),!o["a"].equals(c.positionWC,F)){c._setTransform(z),c.worldToCameraCoordinatesPoint(F,F);var L=o["a"].magnitudeSquared(F);o["a"].magnitudeSquared(c.position)>L&&(o["a"].normalize(c.position,c.position),o["a"].multiplyByScalar(c.position,Math.sqrt(L),c.position));var D=o["a"].angleBetween(F,c.position),q=o["a"].cross(F,c.position,F);o["a"].normalize(q,q);var V=T["a"].fromAxisAngle(q,D,Fa),G=h["a"].fromQuaternion(V,La);h["a"].multiplyByVector(G,c.direction,c.direction),h["a"].multiplyByVector(G,c.up,c.up),o["a"].cross(c.direction,c.up,c.right),o["a"].cross(c.right,c.direction,c.up),c._setTransform(A)}}var Ya=new e["a"],Xa=new y["a"],Ja=new o["a"];function Qa(a,t,i){Object(l["a"])(i.distance)&&(i=i.distance);var e=a._scene,n=e.camera,r=e.canvas,s=Ya;s.x=r.clientWidth/2,s.y=r.clientHeight/2;var c,m,d=n.getPickRay(s,Xa);if(n.position.z<a._minimumPickingTerrainHeight&&(c=Ta(a,s,Ja)),Object(l["a"])(c))m=o["a"].distance(d.origin,c);else{var _=o["a"].UNIT_X,g=d.origin,u=d.direction;m=-o["a"].dot(_,g)/o["a"].dot(_,u)}ra(a,t,i,a._zoomFactor,m)}function Ka(a){var t=a._scene,i=t.camera;if(p["a"].equals(p["a"].IDENTITY,i.transform)){var e=a._tweens;if(a._aggregator.anyButtonDown&&e.removeAll(),N(a,a.enableTilt,a.tiltEventTypes,qa,a.inertiaSpin,"_lastInertiaTiltMovement"),N(a,a.enableTranslate,a.translateEventTypes,Ca,a.inertiaTranslate,"_lastInertiaTranslateMovement"),N(a,a.enableZoom,a.zoomEventTypes,Qa,a.inertiaZoom,"_lastInertiaZoomMovement"),N(a,a.enableLook,a.lookEventTypes,qt),!a._aggregator.anyButtonDown&&(!Object(l["a"])(a._lastInertiaZoomMovement)||!a._lastInertiaZoomMovement.active)&&(!Object(l["a"])(a._lastInertiaTranslateMovement)||!a._lastInertiaTranslateMovement.active)&&!e.contains(a._tween)){var o=i.createCorrectPositionTween(a.bounceAnimationTime);Object(l["a"])(o)&&(a._tween=e.add(o))}e.update()}else N(a,a.enableRotate,a.rotateEventTypes,dt,a.inertiaSpin,"_lastInertiaSpinMovement"),N(a,a.enableZoom,a.zoomEventTypes,wt,a.inertiaZoom,"_lastInertiaZoomMovement")}var $a=new y["a"],at=new f["a"](o["a"].UNIT_X,0),tt=new o["a"],it=new o["a"],et=new o["a"];function ot(a,t,i){var e=a._scene,n=e.camera,r=Ta(a,i.startPosition,et);if(Object(l["a"])(r)){var s=i.endPosition,c=n.getPickRay(s,$a),m=o["a"].clone(n.direction,it);e.mode===M["a"].COLUMBUS_VIEW&&o["a"].fromElements(m.z,m.x,m.y,m);var d=f["a"].fromPointNormal(r,m,at),g=_["a"].rayPlane(c,d,tt);Object(l["a"])(g)&&(m=o["a"].subtract(r,g,m),e.mode===M["a"].COLUMBUS_VIEW&&o["a"].fromElements(m.y,m.z,m.x,m),o["a"].add(n.position,m,n.position))}}var nt=new o["a"],rt=new r["a"],st=new o["a"],lt=new m["a"],ct=new o["a"];function mt(a,t,i){var n=a._scene,r=n.camera;if(p["a"].equals(r.transform,p["a"].IDENTITY)){var s,c,d,_,g=a._ellipsoid.geodeticSurfaceNormal(r.position,ct),u=a._ellipsoid.cartesianToCartographic(r.positionWC,rt).height,v=a._globe,h=!1;if(Object(l["a"])(v)&&u<a._minimumPickingTerrainHeight&&(_=Ta(a,i.startPosition,et),Object(l["a"])(_))){var P=r.getPickRay(i.startPosition,pa),f=a._ellipsoid.geodeticSurfaceNormal(_);h=Math.abs(o["a"].dot(P.direction,f))<.05,h&&!a._looking&&(a._rotating=!1,a._strafing=!0)}e["a"].equals(t,a._rotateMousePosition)?a._looking?qt(a,t,i,g):a._rotating?dt(a,t,i):a._strafing?(o["a"].clone(_,a._strafeStartPosition),ot(a,t,i)):(s=o["a"].magnitude(a._rotateStartPosition),c=st,c.x=c.y=c.z=s,d=m["a"].fromCartesian3(c,lt),Tt(a,t,i,d)):(a._looking=!1,a._rotating=!1,a._strafing=!1,Object(l["a"])(v)&&u<a._minimumPickingTerrainHeight?Object(l["a"])(_)?o["a"].magnitude(r.position)<o["a"].magnitude(_)?(o["a"].clone(_,a._strafeStartPosition),a._strafing=!0,ot(a,t,i)):(s=o["a"].magnitude(_),c=st,c.x=c.y=c.z=s,d=m["a"].fromCartesian3(c,lt),Tt(a,t,i,d),o["a"].clone(_,a._rotateStartPosition)):(a._looking=!0,qt(a,t,i,g)):Object(l["a"])(r.pickEllipsoid(i.startPosition,a._ellipsoid,nt))?(Tt(a,t,i,a._ellipsoid),o["a"].clone(nt,a._rotateStartPosition)):u>a._minimumTrackBallHeight?(a._rotating=!0,dt(a,t,i)):(a._looking=!0,qt(a,t,i,g)),e["a"].clone(t,a._rotateMousePosition))}else dt(a,t,i)}function dt(a,t,i,e,n,r){n=Object(s["a"])(n,!1),r=Object(s["a"])(r,!1);var c=a._scene,m=c.camera,d=c.canvas,_=m.constrainedAxis;Object(l["a"])(e)&&(m.constrainedAxis=e);var g=o["a"].magnitude(m.position),u=a._rotateFactor*(g-a._rotateRateRangeAdjustment);u>a._maximumRotateRate&&(u=a._maximumRotateRate),u<a._minimumRotateRate&&(u=a._minimumRotateRate);var v=(i.startPosition.x-i.endPosition.x)/d.clientWidth,h=(i.startPosition.y-i.endPosition.y)/d.clientHeight;v=Math.min(v,a.maximumMovementRatio),h=Math.min(h,a.maximumMovementRatio);var p=u*v*Math.PI*2,P=u*h*Math.PI;n||m.rotateRight(p),r||m.rotateUp(P),m.constrainedAxis=_}var _t=n["a"].clone(n["a"].UNIT_W),gt=n["a"].clone(n["a"].UNIT_W),ut=new o["a"],vt=new o["a"],ht=new o["a"],pt=new o["a"],Pt=new e["a"],ft=new e["a"];function Tt(a,t,i,n){var r=a._scene,s=r.camera,c=e["a"].clone(i.startPosition,Pt),m=e["a"].clone(i.endPosition,ft),d=s.pickEllipsoid(c,n,_t),_=s.pickEllipsoid(m,n,gt);if(!Object(l["a"])(d)||!Object(l["a"])(_))return a._rotating=!0,void dt(a,t,i);if(d=s.worldToCameraCoordinates(d,d),_=s.worldToCameraCoordinates(_,_),Object(l["a"])(s.constrainedAxis)){var g=s.constrainedAxis,u=o["a"].mostOrthogonalAxis(g,ut);o["a"].cross(u,g,u),o["a"].normalize(u,u);var h=o["a"].cross(g,u,vt),p=o["a"].magnitude(d),P=o["a"].dot(g,d),f=Math.acos(P/p),T=o["a"].multiplyByScalar(g,P,ht);o["a"].subtract(d,T,T),o["a"].normalize(T,T);var y=o["a"].magnitude(_),b=o["a"].dot(g,_),w=Math.acos(b/y),R=o["a"].multiplyByScalar(g,b,pt);o["a"].subtract(_,R,R),o["a"].normalize(R,R);var E=Math.acos(o["a"].dot(T,u));o["a"].dot(T,h)<0&&(E=v["a"].TWO_PI-E);var M=Math.acos(o["a"].dot(R,u));o["a"].dot(R,h)<0&&(M=v["a"].TWO_PI-M);var x,O=E-M;x=o["a"].equalsEpsilon(g,s.position,v["a"].EPSILON2)?s.right:o["a"].cross(g,s.position,ut);var I,C=o["a"].cross(g,x,ut),z=o["a"].dot(C,o["a"].subtract(d,g,vt)),S=o["a"].dot(C,o["a"].subtract(_,g,vt));I=z>0&&S>0?w-f:z>0&&S<=0?o["a"].dot(s.position,g)>0?-f-w:f+w:f-w,s.rotateRight(O),s.rotateUp(I)}else{o["a"].normalize(d,d),o["a"].normalize(_,_);var j=o["a"].dot(d,_),k=o["a"].cross(d,_,ut);if(j<1&&!o["a"].equalsEpsilon(k,o["a"].ZERO,v["a"].EPSILON14)){var N=Math.acos(j);s.rotate(k,N)}}}var yt=new o["a"],bt=new r["a"];function wt(a,t,i){Object(l["a"])(i.distance)&&(i=i.distance);var e=a._ellipsoid,n=a._scene,r=n.camera,s=n.canvas,c=Ya;c.x=s.clientWidth/2,c.y=s.clientHeight/2;var m,d,_=r.getPickRay(c,Xa),g=e.cartesianToCartographic(r.position,bt).height;g<a._minimumPickingTerrainHeight&&(m=Ta(a,c,Ja)),d=Object(l["a"])(m)?o["a"].distance(_.origin,m):g;var u=o["a"].normalize(r.position,yt);ra(a,t,i,a._zoomFactor,d,o["a"].dot(u,r.direction))}var Rt=new e["a"],Et=new y["a"],Mt=new o["a"],xt=new o["a"],Ot=new p["a"],It=new p["a"],Ct=new p["a"],zt=new T["a"],St=new h["a"],jt=new r["a"],kt=new o["a"];function Nt(a,t,i){var o=a._scene,n=o.camera;if(p["a"].equals(n.transform,p["a"].IDENTITY))if(Object(l["a"])(i.angleAndHeight)&&(i=i.angleAndHeight),e["a"].equals(t,a._tiltCenterMousePosition)||(a._tiltOnEllipsoid=!1,a._looking=!1),a._looking){var r=a._ellipsoid.geodeticSurfaceNormal(n.position,kt);qt(a,t,i,r)}else{var s=a._ellipsoid,c=s.cartesianToCartographic(n.position,jt);a._tiltOnEllipsoid||c.height>a._minimumCollisionTerrainHeight?(a._tiltOnEllipsoid=!0,Ht(a,t,i)):Wt(a,t,i)}}var At=new r["a"];function Ht(a,t,i){var n=a._ellipsoid,r=a._scene,s=r.camera,c=.25*a.minimumZoomDistance,d=n.cartesianToCartographic(s.positionWC,At).height;if(!(d-c-1<v["a"].EPSILON3&&i.endPosition.y-i.startPosition.y<0)){var g=r.canvas,u=Rt;u.x=g.clientWidth/2,u.y=g.clientHeight/2;var h,P=s.getPickRay(u,Et),f=_["a"].rayEllipsoid(P,n);if(Object(l["a"])(f))h=y["a"].getPoint(P,f.start,Mt);else{if(!(d>a._minimumTrackBallHeight)){a._looking=!0;var T=a._ellipsoid.geodeticSurfaceNormal(s.position,kt);return qt(a,t,i,T),void e["a"].clone(t,a._tiltCenterMousePosition)}var w=_["a"].grazingAltitudeLocation(P,n);if(!Object(l["a"])(w))return;var R=n.cartesianToCartographic(w,jt);R.height=0,h=n.cartographicToCartesian(R,Mt)}var E=b["a"].eastNorthUpToFixedFrame(h,n,Ot),M=a._globe,x=a._ellipsoid;a._globe=void 0,a._ellipsoid=m["a"].UNIT_SPHERE,a._rotateFactor=1,a._rotateRateRangeAdjustment=1;var O=p["a"].clone(s.transform,Ct);s._setTransform(E),dt(a,t,i,o["a"].UNIT_Z),s._setTransform(O),a._globe=M,a._ellipsoid=x;var I=x.maximumRadius;a._rotateFactor=1/I,a._rotateRateRangeAdjustment=I}}function Wt(a,t,i){var n,r,s,c=a._ellipsoid,d=a._scene,g=d.camera;if(e["a"].equals(t,a._tiltCenterMousePosition))n=o["a"].clone(a._tiltCenter,Mt);else{if(n=Ta(a,t,Mt),!Object(l["a"])(n)){if(r=g.getPickRay(t,Et),s=_["a"].rayEllipsoid(r,c),!Object(l["a"])(s)){var u=c.cartesianToCartographic(g.position,jt);if(u.height<=a._minimumTrackBallHeight){a._looking=!0;var P=a._ellipsoid.geodeticSurfaceNormal(g.position,kt);qt(a,t,i,P),e["a"].clone(t,a._tiltCenterMousePosition)}return}n=y["a"].getPoint(r,s.start,Mt)}e["a"].clone(t,a._tiltCenterMousePosition),o["a"].clone(n,a._tiltCenter)}var f=d.canvas,w=Rt;w.x=f.clientWidth/2,w.y=a._tiltCenterMousePosition.y,r=g.getPickRay(w,Et);var R=o["a"].magnitude(n),E=o["a"].fromElements(R,R,R,st),M=m["a"].fromCartesian3(E,lt);if(s=_["a"].rayEllipsoid(r,M),Object(l["a"])(s)){var x=o["a"].magnitude(r.origin)>R?s.start:s.stop,O=y["a"].getPoint(r,x,xt),I=b["a"].eastNorthUpToFixedFrame(n,c,Ot),C=b["a"].eastNorthUpToFixedFrame(O,M,It),z=a._globe,S=a._ellipsoid;a._globe=void 0,a._ellipsoid=m["a"].UNIT_SPHERE,a._rotateFactor=1,a._rotateRateRangeAdjustment=1;var j=o["a"].UNIT_Z,k=p["a"].clone(g.transform,Ct);g._setTransform(I);var N=o["a"].cross(O,g.positionWC,Da),A=o["a"].dot(g.rightWC,N);if(dt(a,t,i,j,!1,!0),g._setTransform(C),A<0){i.startPosition.y>i.endPosition.y&&(j=void 0);var H=g.constrainedAxis;g.constrainedAxis=void 0,dt(a,t,i,j,!0,!1),g.constrainedAxis=H}else dt(a,t,i,j,!0,!1);if(Object(l["a"])(g.constrainedAxis)){var W=o["a"].cross(g.direction,g.constrainedAxis,Da);o["a"].equalsEpsilon(W,o["a"].ZERO,v["a"].EPSILON6)||(o["a"].dot(W,g.right)<0&&o["a"].negate(W,W),o["a"].cross(W,g.direction,g.up),o["a"].cross(g.direction,g.up,g.right),o["a"].normalize(g.up,g.up),o["a"].normalize(g.right,g.right))}g._setTransform(k),a._globe=z,a._ellipsoid=S;var Z=S.maximumRadius;a._rotateFactor=1/Z,a._rotateRateRangeAdjustment=Z;var B=o["a"].clone(g.positionWC,Da);if(g._adjustHeightForTerrain(),!o["a"].equals(g.positionWC,B)){g._setTransform(C),g.worldToCameraCoordinatesPoint(B,B);var U=o["a"].magnitudeSquared(B);o["a"].magnitudeSquared(g.position)>U&&(o["a"].normalize(g.position,g.position),o["a"].multiplyByScalar(g.position,Math.sqrt(U),g.position));var F=o["a"].angleBetween(B,g.position),L=o["a"].cross(B,g.position,B);o["a"].normalize(L,L);var D=T["a"].fromAxisAngle(L,F,zt),q=h["a"].fromQuaternion(D,St);h["a"].multiplyByVector(q,g.direction,g.direction),h["a"].multiplyByVector(q,g.up,g.up),o["a"].cross(g.direction,g.up,g.right),o["a"].cross(g.right,g.direction,g.up),g._setTransform(k)}}}var Zt=new e["a"],Bt=new e["a"],Ut=new y["a"],Ft=new y["a"],Lt=new o["a"],Dt=new o["a"];function qt(a,t,i,e){var n=a._scene,r=n.camera,c=Zt;c.x=i.startPosition.x,c.y=0;var m=Bt;m.x=i.endPosition.x,m.y=0;var d,_,g=r.getPickRay(c,Ut),u=r.getPickRay(m,Ft),h=0;r.frustum instanceof P["a"]?(d=g.origin,_=u.origin,o["a"].add(r.direction,d,d),o["a"].add(r.direction,_,_),o["a"].subtract(d,r.position,d),o["a"].subtract(_,r.position,_),o["a"].normalize(d,d),o["a"].normalize(_,_)):(d=g.direction,_=u.direction);var p=o["a"].dot(d,_);p<1&&(h=Math.acos(p)),h=i.startPosition.x>i.endPosition.x?-h:h;var f=a._horizontalRotationAxis;if(Object(l["a"])(e)?r.look(e,-h):Object(l["a"])(f)?r.look(f,-h):r.lookLeft(h),c.x=0,c.y=i.startPosition.y,m.x=0,m.y=i.endPosition.y,g=r.getPickRay(c,Ut),u=r.getPickRay(m,Ft),h=0,r.frustum instanceof P["a"]?(d=g.origin,_=u.origin,o["a"].add(r.direction,d,d),o["a"].add(r.direction,_,_),o["a"].subtract(d,r.position,d),o["a"].subtract(_,r.position,_),o["a"].normalize(d,d),o["a"].normalize(_,_)):(d=g.direction,_=u.direction),p=o["a"].dot(d,_),p<1&&(h=Math.acos(p)),h=i.startPosition.y>i.endPosition.y?-h:h,e=Object(s["a"])(e,f),Object(l["a"])(e)){var T=r.direction,y=o["a"].negate(e,Lt),b=o["a"].equalsEpsilon(T,e,v["a"].EPSILON2),w=o["a"].equalsEpsilon(T,y,v["a"].EPSILON2);if(b||w)(b&&h<0||w&&h>0)&&r.look(r.right,-h);else{p=o["a"].dot(T,e);var R=v["a"].acosClamped(p);h>0&&h>R&&(h=R-v["a"].EPSILON4),p=o["a"].dot(T,y),R=v["a"].acosClamped(p),h<0&&-h>R&&(h=-R+v["a"].EPSILON4);var E=o["a"].cross(e,T,Dt);r.look(E,h)}}else r.lookUp(h)}function Vt(a){N(a,a.enableRotate,a.rotateEventTypes,mt,a.inertiaSpin,"_lastInertiaSpinMovement"),N(a,a.enableZoom,a.zoomEventTypes,wt,a.inertiaZoom,"_lastInertiaZoomMovement"),N(a,a.enableTilt,a.tiltEventTypes,Nt,a.inertiaSpin,"_lastInertiaTiltMovement"),N(a,a.enableLook,a.lookEventTypes,qt)}I.prototype.update=function(){p["a"].equals(this._scene.camera.transform,p["a"].IDENTITY)?(this._globe=this._scene.globe,this._ellipsoid=Object(l["a"])(this._globe)?this._globe.ellipsoid:this._scene.mapProjection.ellipsoid):(this._globe=void 0,this._ellipsoid=m["a"].UNIT_SPHERE),this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight*this._scene.terrainExaggeration,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight*this._scene.terrainExaggeration,this._minimumTrackBallHeight=this.minimumTrackBallHeight*this._scene.terrainExaggeration;var a=this._ellipsoid.maximumRadius;this._rotateFactor=1/a,this._rotateRateRangeAdjustment=a;var t=this._scene,i=t.mode;i===M["a"].SCENE2D?ha(this):i===M["a"].COLUMBUS_VIEW?(this._horizontalRotationAxis=o["a"].UNIT_Z,Ka(this)):i===M["a"].SCENE3D&&(this._horizontalRotationAxis=void 0,Vt(this)),this._aggregator.reset()},I.prototype.isDestroyed=function(){return!1},I.prototype.destroy=function(){return this._tweens.removeAll(),this._aggregator=this._aggregator&&this._aggregator.destroy(),Object(c["a"])(this)},t["a"]=I}}]);